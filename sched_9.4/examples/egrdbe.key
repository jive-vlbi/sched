!  Example of a control file using the new RDBE and MARK5C
!  wideband digital backend and recorder.
!
!  The example is based on the RDBE fringe test of Dec 3 2010
!  with 5 stations:  LA, PT, HN, MK, BR
!
!  The version of the RDBE firmware available at the time 
!  had a fixed arrangement of basebands.  Two 512 MHz wide
!  IFs (opposite polarizations) between 512 and 1024 MHz are
!  polyphase filtered into 16 X 32MHz subbands (basebands) 
!  each.  Every other one of those is quantized again to 2 
!  bit samples and recorded, for a total 2 Gbps recording 
!  rate.
!
!  For the test, the old VLBA DAR and Mark5A were run in
!  parallel with the RDBE/MARK5C system.  For that situation,
!  SCHED must be run twice.  Once is to produce the control
!  files for the old system and for correlation of the data
!  from that system.  The second run is to produce the 
!  control file for the new system and for correlation of the
!  data from the new system.  SCHED does not have the 
!  ability to produce all the files at once because many 
!  variables that are reused need different values.
!
!  Setup files are here for both VLBA/Mark5A recordings and 
!  RDBE/Mark5C recordings.
!  
!  To select which type to use, look for pairs of lines 
!  starting with "!MARK5A" or "!MARK5B" in the schedule section.  
!  Those lines are followed by a copy of the active line in
!  this file.  Changing the active line will switch the type.
!  If parallel observations are to be made, use the MARK5A
!  lines for observing, but make both types (especially the
!  VEX file) for correlation.  If the active lines are
!  removed leaving only the commented lines, a script of the 
!  following sort can be used to easily produce the type of 
!  files wanted (It removes one or the other set of comments):

!  #! /bin/csh
!  # Shortcut for runsch for this directory.
!  ~cwalker/bin/runsch ../td009a.key MARK5C

!  where runsch is:

!  #! /bin/csh
!  /bin/rm temp.key
!  /bin/cp $1 .
!  echo Running $1:t with \!$2 replaced by blanks.
!  echo Modified key file is in temp.key
!  sed   's:\!'$2'::'  <$1:t >temp.key
!  sched < temp.key

! ==========================================================
! =================  Cover Information  ====================
! ==========================================================
!  Schedule written by Craig Walker

 version = 1
 expt    = 'Internal RDBE fringe test'
 expcode = egrdbe  !  expcode = td009a

 piname   = 'Craig Walker'    
 address1 = 'National Radio Astronomy Observatory'  
 address2 = 'P. O. Box O'                           
 address3 = 'Socorro, New Mexico, 87801'
 address4 = ' U.S.A. '
 phone    = '575 835 7247 '    
 obsphone = '575 835 7247 '     
 email    = cwalker@nrao.edu  
 fax      = '575 835 7027 '   
 obsmode  = '6cm 128-4-2 '
 obstype  = VLBA
 note1    = ' ' 
! ==========================================================
! ==============  Correlator Information  ==================
! ==========================================================
 
correl   = Socorro
coravg   = 2
corchan  = 16
cornant  = 2
corpol   = on
corwtfn  = uniform
corsrcs  = standard
cortape  = FTP
corship1 = 'Craig Walker'
corship2 = 'P. O. Box O'
corship3 = 'Socorro NM 87801'

! ==========================================================
! ==================  Program control  =====================
! ==========================================================
!    Normally SCHED will not overwrite preexisting files. 
!    If you want this protection, comment this following line.
 overwrit

 sumitem  = el1, early

! ==========================================================
! ======= Standard Source and Station Catalogs  ============
! ==========================================================
!  These are sched defaults so they are not really needed.

srcfile  = $SCHED/catalogs/sources.vlba
srcfile2  = $SCHED/catalogs/sources.pointing
freqfile = $SCHED/catalogs/freq.dat

!  stafile down with scans.

! Add a blank sky source to test noise levels, spurious correlation etc.
srccat /
   source='BLANKSKY' equinox='J2000'
     RA=16:42:58.8099550 DEC=  40:48:36.993945  CALCODE=' ' 
     REMARKS='Blank sky one degree from 3C345'
   /
endcat/
! ==========================================================
! =======================  Setup files  ====================
! ==========================================================
!
!   The first setups are for parallel Mark5A recording.  
!   They are for 128 Mbps with frequencies matched to some 
!   of the RDBE channels.

!  Mark5A at 6cm
setini = trdbem5a.6cm /
  band = '6cm'  bits=2  nchan=4 pol=dual bbfilt=8 
  synth   = 15.9, 4.1, 15.9
  firstlo = 4100.0  
  freqref = 4916.00  
  freqoff = 0, 0, -64.0, -64.0
  pcal = '5MHz'
  netside = L /
endset /  

!  Mark5A High range at 4cm
setini = trdbem5a.4cm /
  band = '4cm'  bits=2  nchan=4 pol=dual bbfilt=8 
  synth   = 7.6, 15.9, 15.9
  firstlo = 7600.0  
  freqref = 8416.00  
  freqoff = 0, 0, -64.0, -64.0
  pcal = '5MHz'
  netside = L /
endset /  

!  Mark5A for sx
setini = trdbem5a.sx /
  fe      = '13cm', '4cm', '13cm', '4cm'
  synth   = 7.6, 3.1, 15.9
  band    = 'sx'  bits=2  nchan=4 bbfilt=8 
  firstlo = 7600.0, 3100.0, 7600.0, 3100.0
  freqref = 8416.00, 2284, 8416.00, 2284
  ifchan  = B, A, B, A
  freqoff = 0, 0, -64.0, -64.0
  pcal = 'off'
  pol     = R, R, R, R
  netside = L, U, L, U /
endset /  


! 1cm - for masers.
setini = trdbem5a.1cm /
  pcal = '5MHz'
  band = '1cm'  bits=2  nchan=4 pol=dual bbfilt=8 
  netside = 'L'
  freqref = 22316.00,  22316.00,  22238.63,  22238.63
 /
endset /  


!  RDBE  Setups:
!  The bbsyn values must be N*32 + 16 for N between 17 and 31
!  For the initial version, every other 32 MHz band is selected
!  and that is what it shown below.  But the choice of which
!  32 MHz bands to use is arbitrary.

!  RDBE  6cm
setini = trdbe.6cm /
  dbe      = 'rdbe_pfb'        !  Use the RDBE with the PFB personality
  format   = 'mark5b'          !  Specify format.
  firstlo  = 4100.0
  fe(1)    = '6cm'
  fe(3)    = '6cm'
  synth    = 15.9, 4.1, 15.9
  nchan    = 16   
  bbfilt   = 32.0  
  bits     = 2
  sideband = L,L,L,L, L,L,L,L, L,L,L,L, L,L,L,L
  netside  = L
  ifchan   = A,C,A,C, A,C,A,C, A,C,A,C, A,C,A,C
  pol      = R,L,R,L, R,L,R,L, R,L,R,L, R,L,R,L
  bbc      = 1,2,3,4, 5,6,7,8, 9,10,11,12, 13,14,15,16
  bbsyn    = 1008.0, 1008.0, 944.0,  944.0, 880.0,  880.0, 816.0,  816.0,
              752.0,  752.0, 688.0,  688.0, 624.0,  624.0, 560.0,  560.0
  pcal     = '5MHz' ! Helps make bands identifiable
    / 
endset /

!  RDBE  High range at 4cm.
!  This shows only the required parameters.  Sched figures out the rest.

setini = trdbea.4cm /
  dbe      = 'rdbe_pfb'
  band     = '4cm'
  nchan    = 16   
  bbfilt   = 32.0  
  bits     = 2
  sideband = L
  netside  = L
  pol      = dual
  firstlo  = 7600.0
  bbsyn    = 1008.0, 1008.0, 944.0,  944.0, 880.0,  880.0, 816.0,  816.0,
              752.0,  752.0, 688.0,  688.0, 624.0,  624.0, 560.0,  560.0
  pcal     = '5MHz' ! Helps make bands identifiable
    / 
endset /

!  Low range at 4cm.  
setini = trdbeb.4cm /
  firstlo  = 7600.0  nchan = 16    bbfilt = 32.0  
  bits     = 2        sideband = L  netside  = L  pol = dual
  bbsyn    = 1008.0, 1008.0, 944.0, 944.0, 880.0, 880.0, 816.0,  816.0,
              752.0,  752.0, 688.0,  688.0, 624.0,  624.0, 560.0,  560.0
  pcal     = '5MHz' ! Helps make bands identifiable
    / 
endset /

!  S/X
setini = trdbe.sx /
  pcal     = 'off'      !  for the cross talk test
  firstlo  = 7600.0, 3100.0, 7600.0, 3100.0, 7600.0, 3100.0, 7600.0, 3100.0, 
             7600.0, 3100.0, 7600.0, 3100.0, 7600.0, 3100.0, 7600.0, 3100.0
  fe      = '13cm', '4cm', '13cm', '4cm'
  synth    = 7.6, 3.1, 15.9
  nchan    = 16   
  bbfilt   = 32.0  
  bits     = 2
  sideband = L,L,L,L, L,L,L,L, L,L,L,L, L,L,L,L
  netside  = L,U,L,U, L,U,L,U, L,U,L,U, L,U,L,U
  ifchan   = B,A,B,A, B,A,B,A, B,A,B,A, B,A,B,A
  pol      = R,R,R,R, R,R,R,R, R,R,R,R, R,R,R,R
  bbc      = 1,2,3,4, 5,6,7,8, 9,10,11,12, 13,14,15,16
  bbsyn    = 1008.0, 1008.0, 944.0, 944.0, 880.0, 880.0, 816.0, 816.0,
              752.0,  752.0, 688.0, 688.0, 624.0, 624.0, 560.0, 560.0
  pcal     = '5MHz' ! Helps make bands identifiable
    / 
endset /

!  1cm
setini = trdbe.1cm /
  format   = 'mark5b'
  firstlo  = 21500.0
  fe(2)    = '1cm'
  fe(4)    = '1cm'
  synth    = 8.9, 15.9, 12.6
  nchan    = 16   
  bbfilt   = 32.0  
  bits     = 2
  sideband = L,L,L,L, L,L,L,L, L,L,L,L, L,L,L,L
  netside  = L
  ifchan   = B,D,B,D, B,D,B,D, B,D,B,D, B,D,B,D
  pol      = R,L,R,L, R,L,R,L, R,L,R,L, R,L,R,L
  bbc      = 1,2,3,4, 5,6,7,8, 9,10,11,12, 13,14,15,16
  bbsyn    = 1008.0, 1008.0, 944.0,  944.0, 880.0,  880.0, 816.0,  816.0,
              752.0,  752.0, 688.0,  688.0, 624.0,  624.0, 560.0,  560.0
  pcal     = '5MHz' ! Helps make bands identifiable
    / 
endset /

! ==========================================================
! =================  Spectral line info        =============
! ==========================================================
!  Not used this time.

lineinit /
!  Set up for 8 channels with the line in 5 and 6
 lineset ='H2O'    
 restfreq=22227.08, 22227.08,
          22235.08, 22235.08 /
endlines /
! ==========================================================
! =================  Initial Scan Information  =============
! ==========================================================

year     = 2010
month    = 12
day      = 3
start    = 15:30:00

! ==========================================================
! ========================  The Scans  =====================
! ==========================================================
!          Interferometer schedules
!          See comments near setup files for how to switch from
!          a Mark5A to a Mark5C schedule.

stations = VLBA_HN, VLBA_LA, VLBA_PT, VLBA_BR, VLBA_MK

! This requires SCHED 9.4 or greater.
stafile  = $SCHED/catalogs/stations_RDBE_US.dat

group=18 rep=2

dwell = 4:40  gap =  20

!MARK5A setup = trdbem5a.4cm
!MARK5C setup = trdbeb.4cm
setup = trdbeb.4cm
source = '3C279' /
source = '3C279' /
source = '3C279' /
source = '3C279' /
source = '3C279' /
source = '3C279' /

!MARK5A setup = trdbem5a.6cm
!MARK5C setup = trdbe.6cm
setup = trdbe.6cm
source = '3C279' /

!MARK5A setup = trdbem5a.sx
!MARK5C setup = trdbe.sx
setup = trdbe.sx
source = '3C279' /
source = '3C279' /

!MARK5A setup = trdbem5a.4cm
!MARK5C setup = trdbeb.4cm
setup = trdbeb.4cm
source = 'M84' /
source = 'M84' /
source = 'M84' /
source = 'M84' /
source = 'M84' /
source = 'M84' /

!MARK5A setup = trdbem5a.6cm
!MARK5C setup = trdbe.6cm
setup = trdbe.6cm
source = 'M84' /

!MARK5A setup = trdbem5a.sx
!MARK5C setup = trdbe.sx
setup = trdbe.sx
source = 'M84' /
source = 'M84' /

! end loop

!MARK5A setup = trdbem5a.4cm
!MARK5C setup = trdbeb.4cm
setup = trdbeb.4cm

source = '3C345' dwell = 25:00 /
source = 'BLANKSKY' dwell = 5:00 /
source = '3C345' dwell = 25:00 /
source = 'BLANKSKY' dwell = 5:00 /
source = '3C345' dwell = 25:00 /
