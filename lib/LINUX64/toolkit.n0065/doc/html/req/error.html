<HTML>
<HEAD>
<TITLE> Error Handling in SPICELIB </TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">

<A NAME="top"></A>

<TABLE STYLE="text-align: left; margin-left: auto; margin-right: auto; width: 800px;" BORDER="0" CELLPADDING="5" CELLSPACING="2">
<TBODY>
<TR>
  <TD STYLE="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
  <DIV ALIGN="right">
    <SMALL><SMALL><A HREF="index.html">Index Page</A></SMALL></SMALL>
  </DIV>
  <B>Error Handling in SPICELIB</B> </TD>
</TR>
<TR>
  <TD STYLE="vertical-align: top;">

<H2> Table of Contents
</H2>

<PRE>
   <A HREF="#Error Handling in SPICELIB">Error Handling in SPICELIB</A>
      <A HREF="#Abstract">Abstract</A>
   <A HREF="#Introduction">Introduction</A>
   <A HREF="#Using SPICELIB Error Handling">Using SPICELIB Error Handling</A>
      <A HREF="#The First Thing You Should Know">The First Thing You Should Know</A>
      <A HREF="#What SPICELIB Does About Errors, Automatically">What SPICELIB Does About Errors, Automatically</A>
      <A HREF="#Changing What SPICELIB Does About Errors">Changing What SPICELIB Does About Errors</A>
      <A HREF="#Choosing Where the Error Messages Are Sent">Choosing Where the Error Messages Are Sent</A>
      <A HREF="#Choosing Which Error Messages to Write">Choosing Which Error Messages to Write</A>
         <A HREF="#Example 1">Example 1</A>
         <A HREF="#Example 2">Example 2</A>
         <A HREF="#Example 3">Example 3</A>
         <A HREF="#Example 4">Example 4</A>
         <A HREF="#Example 5">Example 5</A>
      <A HREF="#Choosing the Error Response Action">Choosing the Error Response Action</A>
      <A HREF="#Handling SPICELIB Errors in Your Own Program">Handling SPICELIB Errors in Your Own Program</A>
      <A HREF="#Testing the Error Status">Testing the Error Status</A>
      <A HREF="#Retrieving Error Messages">Retrieving Error Messages</A>
         <A HREF="#Getting the short message">Getting the short message</A>
         <A HREF="#Getting the long message">Getting the long message</A>
         <A HREF="#Getting the explanation for the short message">Getting the explanation for the short message</A>
         <A HREF="#Getting the traceback">Getting the traceback</A>
      <A HREF="#Resetting the Error Status">Resetting the Error Status</A>
      <A HREF="#Handling Errors Detected in Your Own Program">Handling Errors Detected in Your Own Program</A>
      <A HREF="#Signaling Errors">Signaling Errors</A>
      <A HREF="#Setting the Long Error Message">Setting the Long Error Message</A>
      <A HREF="#Using the RETURN Action and the SPICELIB Function, RETURN">Using the RETURN Action and the SPICELIB Function, RETURN</A>
      <A HREF="#Maintaining Traceback Information -- Checking In and Checking Out">Maintaining Traceback Information -- Checking In and Checking Out</A>
      <A HREF="#Clean Coding Using FAILED">Clean Coding Using FAILED</A>
         <A HREF="#Example 10">Example 1</A>
         <A HREF="#Example 20">Example 2</A>
      <A HREF="#Finding Out What the Current Error Handling Settings Are">Finding Out What the Current Error Handling Settings Are</A>
   <A HREF="#Concepts and Definitions">Concepts and Definitions</A>
      <A HREF="#About Errors">About Errors</A>
      <A HREF="#About Error Messages">About Error Messages</A>
         <A HREF="#The short error message">The short error message</A>
         <A HREF="#The explanation of the short error message">The explanation of the short error message</A>
         <A HREF="#The long error message">The long error message</A>
         <A HREF="#The traceback">The traceback</A>
         <A HREF="#The default message">The default message</A>
      <A HREF="#About Error Response Actions">About Error Response Actions</A>
   <A HREF="#Advanced Programming with Error Handling">Advanced Programming with Error Handling</A>
      <A HREF="#Using the SPICELIB Functions FAILED and RETURN">Using the SPICELIB Functions FAILED and RETURN</A>
      <A HREF="#Using the SPICELIB routines CHKIN and CHKOUT">Using the SPICELIB routines CHKIN and CHKOUT</A>
      <A HREF="#Using Multiple Settings of the Automatic Error Handling Features">Using Multiple Settings of the Automatic Error Handling Features</A>

</PRE>

<HR SIZE=3 NOSHADE>

<BR><BR>
<A NAME="Error Handling in SPICELIB"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Error Handling in SPICELIB
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
   Last revised on 2006 NOV 22 by N.J. Bachman.
<P>
 
<BR><BR>
<A NAME="Abstract"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Abstract
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   This Required Reading document details the use of SPICELIB error
   handling facilities.
<P>
 
<BR><BR>
<A NAME="Introduction"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Introduction
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
   Most of this information in this document is OPTIONAL reading, not
   ``required'' reading. To get started using SPICELIB quickly, it suffices
   to read up through the section titled ``The First Thing You Should
   Know.''
<P>
 
   About the organization of this Required Reading document:
<P>
 
   The second chapter describes ``Using SPICELIB Error Handling.'' We begin
   with brief descriptions of the error handling features, and many
   examples of their use.
<P>
 
   The third chapter describes ``Definitions and Concepts.'' This chapter
   provides a more detailed and complete discussion of the concepts used in
   describing the SPICELIB error handling mechanism, but generally does not
   give examples. Here we define what we mean by ``errors,'' describe error
   messages and their use, and describe the possible error processing
   ``actions'' -- ways of responding to error conditions.
<P>
 
   The fourth chapter describes ``Advanced Programming With Error
   Handling''; that chapter discusses extension of the error reporting
   scheme to your own application code.
<P>
 
   The document covers the following topics:
<P>
 
<UL>
<TT>--</TT> How to make your program test whether a SPICELIB routine has detected an
error, and how to find out what kind of error it was.
<BR><BR></UL>
<UL>
<TT>--</TT> How to direct SPICELIB software to continue running after an error has
occurred, rather than stopping.
<BR><BR></UL>
<UL>
<TT>--</TT> How to select the messages you want to output when an error is detected.
<BR><BR></UL>
<UL>
<TT>--</TT> How to get a log of errors detected by your own application code.
<BR><BR></UL>
<UL>
<TT>--</TT> How to direct SPICELIB software to send error messages to a file.
<BR><BR></UL>
<UL>
<TT>--</TT> How to get a traceback of your call chain when an error occurs in your own
code.
<BR><BR></UL>
   Error handling topics beyond the scope of this document:
<P>
 
<UL>
<TT>--</TT> Information about specific errors detected by SPICELIB.
<BR><BR></UL>
<UL>
<TT>--</TT> How to take corrective action when an error is detected.
<BR><BR></UL>
<UL>
<TT>--</TT> How to debug programs that use SPICELIB.
<BR><BR></UL>
<UL>
<TT>--</TT> How to determine whether to treat a condition arising in your own code as
an error.
<BR><BR></UL>
<UL>
<TT>--</TT> How to write code that performs the ``minimum possible'' amount of error
checking.
<BR><BR></UL>
   Before starting our discussion of how to use the SPICELIB error handling
   facilities, let's briefly answer the question, ``Why perform error
   handling at all?'' Here are a few reasons:
<P>
 
<UL>
<TT>--</TT> It makes your program MUCH easier to debug. Most run-time diagnostics only
tell you about low-level types of errors such as arithmetic overflow,
attempts to divide by zero, or attempts to write protected memory
locations. These run-time errors may occur in very different locations from
the original coding mistakes causing them, so the original mistakes are
hard to find. SPICELIB error handling helps bound the section of code where
a coding error is located, greatly simplifying the search for it.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Also, a good deal of understanding of a program without error handling is
often required to fix problems, since problems are diagnosed in low-level
terms, not conceptually: it's like the difference between being told that
the current through a certain wire in your television is zero, instead of
being told that your set isn't plugged in. Understand many mistakes may not
cause run-time diagnostics to be produced.
<BR><BR></UL>
<UL>
<TT>--</TT> Error handling makes your program much more robust. Your program can
respond to errors and continue execution in many cases, with SPICELIB error
handling.
<BR><BR></UL>
<UL>
<TT>--</TT> It makes user-friendliness possible. When errors occur, your program can
retain control and present the problem to the user as you choose. Contrast
this to an abort with a run-time error message.
<BR><BR></UL>
<UL>
<TT>--</TT> It makes error handling portable and uniform across systems. SPICELIB error
handling is accomplished using standard FORTRAN. Different systems do not
handle run time errors in the same way.
<BR><BR></UL>
<BR><BR>
<A NAME="Using SPICELIB Error Handling"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Using SPICELIB Error Handling
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
   This chapter tells you how to use most of the features of the SPICELIB
   error handling mechanism. Many examples are given, but details are saved
   for the next chapter ``Concepts and Definitions.''
<P>
 
   The material in this chapter covers three areas:
<P>
 
<UL>
<TT>--</TT> Controlling SPICELIB's automatic error handling features
<BR><BR></UL>
<UL>
<TT>--</TT> How to enable your own application to handle errors detected by SPICELIB
code
<BR><BR></UL>
<UL>
<TT>--</TT> How to use SPICELIB error handling to respond to errors detected by YOUR
OWN code
<BR><BR></UL>
<BR><BR>
<A NAME="The First Thing You Should Know"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> The First Thing You Should Know
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   The first thing to know about SPICELIB error handling is, you don't HAVE
   to do anything to use it. As a default, when a SPICELIB routine detects
   an error, SPICELIB will print error messages to the default output
   device (the screen, on most systems), and then STOP.
<P>
 
   This capability is built into SPICELIB software; you get it
   automatically when you link your program with SPICELIB. No additional
   action of any kind is needed to make it work.
<P>
 
   If this behavior is adequate for your application, you don't need to
   read the rest of this document.
<P>
 
<BR><BR>
<A NAME="What SPICELIB Does About Errors, Automatically"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> What SPICELIB Does About Errors, Automatically
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   When a SPICELIB routine detects an error (we call this ``signaling'' an
   error), the SPICELIB error handling mechanism will write a set of
   descriptive error messages to the default output device, which is the
   terminal screen on most systems. The messages are:
<P>
 
<UL>
<TT>--</TT> A short, descriptive message.
<BR><BR></UL>
<UL>
<TT>--</TT> An expanded form of the short message.
<BR><BR></UL>
<UL>
<TT>--</TT> Optionally, a long message, possibly containing data.
<BR><BR></UL>
<UL>
<TT>--</TT> A ``traceback,'' showing the sequence of calls leading to the routine that
detected the error.
<BR><BR></UL>
<UL>
<TT>--</TT> A default message, informing the user that the error handling behavior is
adjustable.
<BR><BR></UL>
   After writing these messages, the error handling mechanism will halt
   execution of the program.
<P>
 
   See the section ``About Error Messages'' below for details.
<P>
 
<BR><BR>
<A NAME="Changing What SPICELIB Does About Errors"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Changing What SPICELIB Does About Errors
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   You can change the set of error messages written when an error occurs.
   You can re-direct the output to a file, or suppress it. You can choose
   to have your program continue after an detecting an error rather than
   stopping.
<P>
 
<BR><BR>
<A NAME="Choosing Where the Error Messages Are Sent"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Choosing Where the Error Messages Are Sent
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   Suppose you want to have any error messages written to a file, rather
   than to the default output device (the screen, on most systems). You can
   do this by calling the SPICELIB routine, ERRDEV. The first argument
   should be 'SET'. The second should be the file specification.
<P>
 
   For example, to have error messages go to the file, ERROR.DAT, you could
   use the following code:
<P>
 
<PRE>
   C
   C     Set the error output device for SPICELIB
   C     error messages to the file ERROR.DAT:
   C
         CALL ERRDEV ( 'SET', 'ERROR.DAT' )
</PRE>
   This call should precede calls to other SPICELIB routines, except <a href="../spicelib/erract.html">ERRACT</a>
   and <a href="../spicelib/errprt.html">ERRPRT</a>. If your program has an initialization portion, this call
   should go there.
<P>
 
<BR><BR>
<A NAME="Choosing Which Error Messages to Write"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Choosing Which Error Messages to Write
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   By default, when an error is detected by a SPICELIB routine, up to five
   different types of error messages are written. You can tell SPICELIB's
   error handling mechanism to write any combination, including ``all'' and
   ``none'' of these messages.
<P>
 
   Change the set of written messages via a call to the SPICELIB routine,
   <a href="../spicelib/errprt.html">ERRPRT</a>.
<P>
 
   The first argument should be 'SET'.
<P>
 
   The second argument is a list of message types that you want to ADD to
   the set of messages that currently are selected to be output when an
   error occurs.
<P>
 
   The keywords which may be used in the list:
<P>
 
<PRE>
   SHORT
   LONG
   EXPLAIN
   TRACEBACK
   DEFAULT
   ALL         ( write all messages )
   NONE        ( write no messages  )
</PRE>
   The list of message choices is read from left to right, with each word
   ADDING to the previous set of messages (except for the word NONE, which
   subtracts all of the messages from your selection).
<P>
 
   Some examples may help clarify this.
<P>
 
<BR><BR>
<A NAME="Example 1"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 1
</H3><P><BR><BR>
   Suppose that currently, the short message has been selected for output.
   To ADD the long message, make the call:
<P>
 
<PRE>
   C
   C     Add the long message to the set selected for output
   C     when an error occurs:
   C
         CALL <a href="../spicelib/errprt.html">ERRPRT</a> ( 'SET', 'LONG' )
</PRE>
   Now the short and long messages will be output if SPICELIB detects an
   error.
<P>
 
<BR><BR>
<A NAME="Example 2"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 2
</H3><P><BR><BR>
   What if you want JUST the long message? Put the word NONE at the
   beginning of the list; this cancels the previous selection:
<P>
 
<PRE>
   C
   C     Just output the long message
   C     when an error occurs:
   C
         CALL <a href="../spicelib/errprt.html">ERRPRT</a> (  'SET',   'NONE, LONG'  )
</PRE>
<BR><BR>
<A NAME="Example 3"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 3
</H3><P><BR><BR>
   What if you want just the traceback and long message? Put the word NONE
   at the beginning of the list; this cancels the previous selection:
<P>
 
<PRE>
   C
   C     Just output the long message and traceback
   C     on error:
   C
         CALL <a href="../spicelib/errprt.html">ERRPRT</a> (  'SET',   'NONE, TRACEBACK, LONG'  )
</PRE>
<BR><BR>
<A NAME="Example 4"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 4
</H3><P><BR><BR>
   How about no messages?
<P>
 
<PRE>
   C
   C     Don't output ANY SPICELIB error messages
   C     on error:
   C
         CALL <a href="../spicelib/errprt.html">ERRPRT</a> (  'SET',   'NONE'  )
</PRE>
<BR><BR>
<A NAME="Example 5"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 5
</H3><P><BR><BR>
   All messages?
<P>
 
<PRE>
   C
   C     Output ALL SPICELIB error messages
   C     when an error occurs:
   C
         CALL <a href="../spicelib/errprt.html">ERRPRT</a> (  'SET',   'ALL'  )
</PRE>
   See the section ``About Error Messages'' below for details.
<P>
 
<BR><BR>
<A NAME="Choosing the Error Response Action"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Choosing the Error Response Action
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   SPICELIB's default response to error detection includes halting the
   program. What if you don't want that?
<P>
 
   SPICELIB's error handling mechanism allows you to choose one of several
   different error response ``actions.'' In almost all cases, the only
   reasonable alternative to the default action is RETURN. Briefly, the
   full set of choices consists of:
<P>
 
<DL><DT>
<B>
 DEFAULT
</B><BR><BR>
<DD>
 The action you start with, automatically. This is the same as ``abort''
(below), except that all of the error messages, including the
``default'' message, are written.<BR>
</DL>
<DL><DT>
<B>
 ABORT
</B><BR><BR>
<DD>
 Print messages and halts the program. With this action, you can select
the error messages that are written.<BR>
</DL>
<DL><DT>
<B>
 REPORT
</B><BR><BR>
<DD>
 Write messages and CONTINUE EXECUTION.<BR>
</DL>
   This action may be useful for debugging. Caution: Once an error has
   occurred, your program may not execute as expected.
<P>
 
<DL><DT>
<B>
 RETURN
</B><BR><BR>
<DD>
 Write messages, AFTER WHICH ALL SPICELIB ROUTINES THAT DETECT ERRORS OR
CALL OTHER ROUTINES WILL RETURN IMMEDIATELY UPON ENTRY.<BR>
</DL>
   This is the action to use if you want to perform error handling for
   SPICELIB errors in your own code.
<P>
 
<DL><DT>
<B>
 IGNORE
</B><BR><BR>
<DD>
 DO NOTHING in response to errors. No error messages will be output; the
SPICELIB status functions RETURN and <a href="../spicelib/failed.html">FAILED</a> will not indicate that an
error has occurred.<BR>
</DL>
   These choices are mutually exclusive; only one action can be in effect
   at a given time.
<P>
 
   You use <a href="../spicelib/erract.html">ERRACT</a> to set the error response action. The first argument
   should be 'SET'. The second argument should be one of the above choices.
   For example:
<P>
 
<PRE>
   C
   C     Set the CSPICE error response action
   C     to 'RETURN':
   C
         CALL <a href="../spicelib/erract.html">ERRACT</a> (  'SET',   'RETURN'  )
</PRE>
<BR><BR>
<A NAME="Handling SPICELIB Errors in Your Own Program"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Handling SPICELIB Errors in Your Own Program
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   So far we've talked about how to control automatic reporting of errors
   detected in SPICELIB routines.
<P>
 
   The automatic error reporting feature is meant to produce human-
   readable error diagnostic information. However, you may also wish to
   have your program respond to SPICELIB errors.
<P>
 
   To do this, you will need to know about three more basic functions:
   testing and resetting the SPICELIB error status, and retrieving SPICELIB
   error messages.
<P>
 
<BR><BR>
<A NAME="Testing the Error Status"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Testing the Error Status
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   You use the SPICELIB function, <a href="../spicelib/failed.html">FAILED</a>, to tell if any SPICELIB routine
   has detected an error. <a href="../spicelib/failed.html">FAILED</a> is a function which returns a boolean. It
   takes the `true' value, if any SPICELIB routine has detected an error.
<P>
 
   For example, suppose you call the SPICELIB routine, RDTEXT, to read a
   line of text from a file. You want your program to test whether an error
   occurred on the read. You can write:
<P>
 
<PRE>
   C
   C     Read a line from USERFILE.TXT; check for
   C     errors:
   C
         CALL RDTEXT ( 'USERFILE.TXT', LINE, EOF )
 
         IF (  <a href="../spicelib/failed.html">FAILED</a>()  )  THEN
 
   C        LINE is not valid, so quit:
 
            RETURN
 
         END IF
</PRE>
   If you're used to routines that have error arguments, you might note
   that the code is similar to what you would write if <a href="../spicelib/failed.html">FAILED</a> were an
   output argument for RDTEXT, instead of a function.
<P>
 
   However, there are a number of advantages to the SPICELIB method, one of
   which is that if you don't wish to write any error handling code to
   handle SPICELIB errors, you don't have to, and you'll still get helpful
   error messages automatically. Also, if you use SPICELIB error handling
   in your own code, you don't need error arguments, which makes for
   simpler code.
<P>
 
<BR><BR>
<A NAME="Retrieving Error Messages"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Retrieving Error Messages
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   SPICELIB provides routines to retrieve the error messages generated
   whenever a SPICELIB routine detects an error.
<P>
 
   This feature is useful for two reasons. First, if you want your program
   to take different actions depending on what error occurred, it gives
   your program a way to find out. Second, if you want to generate your own
   error reports instead of using those generated by SPICELIB, you need to
   be able to retrieve the information SPICELIB has generated about the
   error.
<P>
 
<BR><BR>
<A NAME="Getting the short message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Getting the short message
</H3><P><BR><BR>
   Because of its brief format, the short message is the one to use in your
   code in any logical tests you might want to do.
<P>
 
   To retrieve the short error message, call <a href="../spicelib/getmsg.html">GETMSG</a> or <a href="../spicelib/getsms.html">GETSMS</a>. For example:
<P>
 
<PRE>
   C
   C     Call PROMPT to prompt the user for the name of file to
   C     read from.  Read a line from it. Check for errors:
   C
         CALL PROMPT ( 'Enter file name &gt; ', FILE )
         CALL GETFIL ( FILE )
 
         DO WHILE ( FILE .NE. ' ' )
 
            CALL RDTEXT ( FILE, LINE, EOF )
 
            IF ( <a href="../spicelib/failed.html">FAILED</a>() ) THEN
   C
   C           An error occurred.
   C           Find out what the short message was:
   C
               CALL <a href="../spicelib/getmsg.html">GETMSG</a> ( 'SHORT', SHRTMS )
 
               IF (   ( SHRTMS .EQ. 'SPICE(NOFREELOGICALUNIT)')
        .         .OR.( SHRTMS .EQ. 'SPICE(TOOMANYFILESOPEN)' ) ) THEN
   C
   C              We won't succeed in reading any file.
   C              So, quit.
   C
                  RETURN
 
               ELSE
   C
   C              Get name of a different file:
   C
                  CALL PROMPT ( 'Enter file name &gt; ', FILE )
 
               END IF
 
            END IF
 
         END DO
</PRE>
<BR><BR>
<A NAME="Getting the long message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Getting the long message
</H3><P><BR><BR>
   The long error message and traceback aren't useful for program logic,
   but you may want them if you're going to produce error reports in your
   own format.
<P>
 
   To get the long error message, call <a href="../spicelib/getmsg.html">GETMSG</a> or <a href="../spicelib/getlms.html">GETLMS</a>. For example,
<P>
 
<PRE>
         CALL RDTEXT ( FILE, LINE, EOF )
 
         IF ( <a href="../spicelib/failed.html">FAILED</a>() ) THEN
   C
   C        Get long message and output it using USROUT
   C        (not a SPICELIB routine)
   C
            CALL <a href="../spicelib/getmsg.html">GETMSG</a> ( 'LONG', LONGMS )
            CALL USROUT ( LONGMS )
 
         END IF
</PRE>
   The argument supplied to <a href="../spicelib/getmsg.html">GETMSG</a> should be declared CHARACTER*1840.
<P>
 
<BR><BR>
<A NAME="Getting the explanation for the short message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Getting the explanation for the short message
</H3><P><BR><BR>
   The SPICELIB routine <a href="../spicelib/expln.html">EXPLN</a> can obtain a line of text explaining each
   SPICELIB short error message. This text is an expansion of the short
   error message, since the short message is frequently abbreviated.
<P>
 
   Here's an example:
<P>
 
<PRE>
   C
   C     After this call, EXPL will take the value:
   C
   C     'Invalid Radius--Equatorial or Polar Radius is Zero'
   C
         CALL <a href="../spicelib/expln.html">EXPLN</a> ( 'SPICE(ZERORADIUS)', EXPL )
 
         CALL <a href="../spicelib/tostdo.html">TOSTDO</a> ( <a href="../spicelib/expln.html">EXPLN</a> )
</PRE>
<BR><BR>
<A NAME="Getting the traceback"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Getting the traceback
</H3><P><BR><BR>
   Two ways of getting the traceback are provided in SPICELIB:
<P>
 
<UL>
<TT>--</TT> You can call the routine QCKTRC which returns a character string containing
a traceback. Specifically, the string contains a list of module names,
separated by arrows. The first name in the string is the name of the
highest level module in the active call chain that has ``checked in.''
<BR><BR></UL>
   Example: Suppose MAIN has called SUBA, which in turn has called SUBB.
   The following code is in SUBB:
<P>
 
<PRE>
   C
   C     Get traceback.  After the call to QCKTRC,
   C     <a href="../spicelib/trace.html">TRACE</a> should have the value,
   C
   C     'MAIN --&gt; SUBA --&gt; SUBB'
   C
         CALL QCKTRC ( <a href="../spicelib/trace.html">TRACE</a> )
 
         CALL <a href="../spicelib/stdio.html">STDIO</a>( <a href="../spicelib/trace.html">TRACE</a> )
</PRE>
<UL>
<TT>--</TT> You can find out how many routines are in SPICELIB's traceback
representation by calling TRCDEP (``traceback depth''), and then extract
any given name from the traceback representation by calling TRCNAM.
<BR><BR></UL>
   For example, you could print out the names of all of the modules in the
   active call chain with the following code:
<P>
 
<PRE>
    CALL TRCDEP ( DEPTH )
 
    DO I = 1, DEPTH
 
       CALL TRCNAM ( I, NAME )
 
       CALL <a href="../spicelib/stdio.html">STDIO</a>( NAME )
 
    END DO
</PRE>
<BR><BR>
<A NAME="Resetting the Error Status"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Resetting the Error Status
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   If your program encounters a recoverable error, you may wish to have it
   report the error and continue processing.
<P>
 
   An example would be the case where you have an interactive program that
   prompts the user for the name of a file to read. Your program uses the
   SPICELIB function RDTEXT to read the file. If the file isn't found,
   RDTEXT signals an error. The inability to locate the file need not stop
   the program; your program could just display a message saying the file
   wasn't found and ask for another file name.
<P>
 
   The problem here is that the SPICELIB functions <a href="../spicelib/failed.html">FAILED</a> and RETURN will
   return the `true' value after RDTEXT signals the error, so any code
   whose logic depends on the value of those functions will behave as if an
   error has occurred, even though the error was recoverable. To solve this
   problem, SPICELIB provides the routine, <a href="../spicelib/reset.html">RESET</a>, which ``resets'' the
   error handling mechanism, so that it acts as if no error had occurred.
   Calling <a href="../spicelib/reset.html">RESET</a> has the following effects:
<P>
 
<UL>
<TT>--</TT> The SPICELIB function <a href="../spicelib/failed.html">FAILED</a> will return the `false' value until another
error is signaled.
<BR><BR></UL>
<UL>
<TT>--</TT> The SPICELIB function RETURN will return the `false' value until another
error is signaled.
<BR><BR></UL>
<UL>
<TT>--</TT> <a href="../spicelib/getmsg.html">GETMSG</a>, GETSMS, and <a href="../spicelib/getlms.html">GETLMS</a> will return blank strings.
<BR><BR></UL>
<UL>
<TT>--</TT> The traceback routines will show a traceback of the current active call
chain, not the active call chain at the time of the last error.
<BR><BR></UL>
   When your program detects a recoverable error, it should fetch the error
   messages, call <a href="../spicelib/reset.html">RESET</a>, then complete its response to the error. The
   diagnostic messages must be fetched before <a href="../spicelib/reset.html">RESET</a> is called. RESET should
   be called before other SPICE routines are called, because these routines
   may return upon entry while an error condition exists.
<P>
 
<BR><BR>
<A NAME="Handling Errors Detected in Your Own Program"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Handling Errors Detected in Your Own Program
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   When you use SPICELIB, you can use the error handling mechanism to
   respond to errors detected by your own code, as well as by SPICELIB
   code.
<P>
 
   Some of the capabilities that you get with SPICELIB are:
<P>
 
<UL>
<TT>--</TT> You can signal errors and have your error messages output to a chosen
device, without writing code to do the output.
<BR><BR></UL>
<UL>
<TT>--</TT> You can get a traceback of your own call chain, which can be retrieved at
any time, not just when an error occurs.
<BR><BR></UL>
<UL>
<TT>--</TT> You can control how your program behaves when it encounters an error, just
as when SPICELIB encounters one.
<BR><BR></UL>
<UL>
<TT>--</TT> You can use <a href="../spicelib/failed.html">FAILED</a> as a global status indicator, not just for SPICELIB
code.
<BR><BR></UL>
<UL>
<TT>--</TT> You can use RETURN to prevent your routines from executing when an error
condition exists, thereby obviating the need to test <a href="../spicelib/failed.html">FAILED</a> after each call
to a subroutine.
<BR><BR></UL>
   In the following sections we explain:
<P>
 
<UL>
<TT>--</TT> How to ``signal'' (indicate) an error condition
<BR><BR></UL>
<UL>
<TT>--</TT> How to create error messages
<BR><BR></UL>
<UL>
<TT>--</TT> How to use the RETURN error response action and the SPICELIB function
RETURN to help your program handle recoverable errors
<BR><BR></UL>
<UL>
<TT>--</TT> How to use the SPICELIB routines CHKIN and CHKOUT to create a traceback of
your own subroutine calls
<BR><BR></UL>
<UL>
<TT>--</TT> How to code using <a href="../spicelib/failed.html">FAILED</a> so as to reduce the amount of error checking you
need in your code
<BR><BR></UL>
<UL>
<TT>--</TT> How to retrieve the settings of the error output device, error response
action, and error message selection
<BR><BR></UL>
<BR><BR>
<A NAME="Signaling Errors"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Signaling Errors
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   A routine calls <a href="../spicelib/sigerr.html">SIGERR</a> to signal an error condition to the SPICELIB
   error mechanism.
<P>
 
   When <a href="../spicelib/sigerr.html">SIGERR</a> is called, all of the types of error messages that have been
   selected for automatic output are written out, and SPICELIB takes
   whatever additional actions are required by the current setting of the
   error response ``action.''
<P>
 
   <a href="../spicelib/sigerr.html">SIGERR</a> takes one input argument, a short (25 character maximum) error
   message. This message will be output if the ``short message'' has been
   selected for output. It is strongly recommended that your code supply a
   descriptive (at least non-blank) error message when it calls <a href="../spicelib/sigerr.html">SIGERR</a>.
<P>
 
   The short message, if used, indicates the type of error which occurred,
   so the program can respond appropriately.
<P>
 
   A capability exists to set a long, human-readable, error message. The
   next section discusses setting the long message.
<P>
 
   Here's an example in which the routine, <a href="../spicelib/dacosh.html">DACOSH</a>, signals an error.
<P>
 
<PRE>
   C
   C  <a href="../spicelib/dacosh.html">DACOSH</a> computes an arc hyperbolic cosine of X; X must
   C  be greater than or equal to 1 to be in the domain of
   C  <a href="../spicelib/dacosh.html">DACOSH</a>.
   C
   C  Check that X &gt;= 1.
   C
 
         IF ( X .LT. 1.D0 ) THEN
 
            CALL <a href="../spicelib/setmsg.html">SETMSG</a> ( '<a href="../spicelib/dacosh.html">DACOSH</a>: Invalid argument, ' //
        .                 'X is less than one.' )
 
            CALL <a href="../spicelib/sigerr.html">SIGERR</a> ( 'SPICE(INVALIDARGUMENT)' )
 
            RETURN
 
         END IF
</PRE>
   You may note a call to the routine <a href="../spicelib/setmsg.html">SETMSG</a> precedes the call to <a href="../spicelib/sigerr.html">SIGERR</a> as
   <a href="../spicelib/setmsg.html">SETMSG</a> sets the long error message. SETMSG is discussed in the next
   section, but we'll note here that if you wish to call <a href="../spicelib/setmsg.html">SETMSG</a>, it should
   be called BEFORE calling <a href="../spicelib/sigerr.html">SIGERR</a>, since SIGERR causes the current long
   error message to be output.
<P>
 
<BR><BR>
<A NAME="Setting the Long Error Message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Setting the Long Error Message
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   The long error message is intended to inform the human reader about an
   error that has occurred.
<P>
 
   You may supply a character string of length up to 1840 characters as the
   input argument to <a href="../spicelib/setmsg.html">SETMSG</a>. Strictly speaking, the long message is
   optional, but it's recommended that you call <a href="../spicelib/setmsg.html">SETMSG</a> before every call to
   <a href="../spicelib/sigerr.html">SIGERR</a>, supplying a blank string if you don't wish to set a long
   message.
<P>
 
   As an example, the calls to <a href="../spicelib/setmsg.html">SETMSG</a> and <a href="../spicelib/sigerr.html">SIGERR</a> from the example in the
   last section are repeated here:
<P>
 
<PRE>
    CALL <a href="../spicelib/setmsg.html">SETMSG</a> ( '<a href="../spicelib/dacosh.html">DACOSH</a>: Invalid argument, ' //
   .                 'X is less than one.' )
 
 
    CALL <a href="../spicelib/sigerr.html">SIGERR</a> ( 'SPICE(INVALIDARGUMENT)' )
</PRE>
   Frequently, one would like to insert variable strings into a long
   message. In the above example, it might be nice to convert X, a double
   precision number, to a character string and put it in the error message.
   SPICELIB provides the routine, <a href="../spicelib/errdp.html">ERRDP</a>, for just this purpose.
<P>
 
   <a href="../spicelib/errdp.html">ERRDP</a> takes two arguments. The first is a character string to appear in
   the long error message. It marks the place where the result of the
   conversion is to be placed in the long error message.
<P>
 
   The second argument is the value to be converted to a character string.
   The resulting string is substituted for the first occurrence of the
   first argument found in the long message.
<P>
 
   Here's the previous example, re-written using <a href="../spicelib/errdp.html">ERRDP</a>.
<P>
 
<PRE>
   C
   C        Set long error message, with a MARKER where
   C        the value of X will go.  Our marker is '#'.
   C
            CALL <a href="../spicelib/setmsg.html">SETMSG</a> ( '<a href="../spicelib/dacosh.html">DACOSH</a>: Invalid argument, ' //
        .                 'X is less than one.  The '  //
        .                 'value is #.'   )
 
   C
   C        Convert X to characters, and insert the result
   C        in the long message where the # is now:
   C
            CALL <a href="../spicelib/errdp.html">ERRDP</a>  ( '#',  X )
 
   C
   C        If X happened to be -5.5D0, for example,
   C        the long message would now be:
   C
   C        '<a href="../spicelib/dacosh.html">DACOSH</a>: Invalid argument, X is less than one. '
   C        'The value is -5.5D0.'
   C
 
   C
   C         Signal the error:
   C
             CALL <a href="../spicelib/sigerr.html">SIGERR</a> ( 'SPICE(INVALIDARGUMENT)' )
</PRE>
   In addition to <a href="../spicelib/errdp.html">ERRDP</a>, ERRINT and <a href="../spicelib/errch.html">ERRCH</a> are provided for inserting
   integers and character strings into the long message.
<P>
 
<BR><BR>
<A NAME="Using the RETURN Action and the SPICELIB Function, RETURN"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Using the RETURN Action and the SPICELIB Function, RETURN
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   If you want your program to do any error handling in addition to
   SPICELIB's automatic error handling, you probably would like to prevent
   your program from crashing as a result of an error, since this
   unfortunate event may prevent control from ever being given to your
   error handling code.
<P>
 
   SPICELIB solves this problem with the boolean function RETURN, and the
   RETURN error response action.
<P>
 
   The first two lines of executable code of every SPICELIB routine that
   can detect errors, or that calls another routine, are:
<P>
 
<PRE>
   IF ( RETURN() ) THEN
      RETURN
   END IF
</PRE>
   When the error action is RETURN and an error has been signaled, RETURN
   takes the `true' value. So every SPICELIB routine that can detect
   errors, or that calls another routine, returns without doing anything.
   This greatly reduces the chance of an error causing a program crash.
<P>
 
   You can use the function RETURN in your own code to achieve the same
   effect.
<P>
 
   RETURN always takes the `false' value if the error action is not RETURN.
<P>
 
   See the next section to find out what the rest of the IF block should
   be.
<P>
 
<BR><BR>
<A NAME="Maintaining Traceback Information -- Checking In and Checking Out"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Maintaining Traceback Information -- Checking In and Checking Out
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   SPICELIB can give you a ``picture'' of your call chain at the time an
   error is signaled, and at any time before. We call this a ``traceback.''
   A traceback is provided in the default selection of error messages. When
   an error is signaled, a traceback helps you find out what calls were
   made before the call to the routine which detected an error.
<P>
 
   As an example, suppose the following figure shows the calling hierarchy
   for a program, and that currently, subroutine ``E'' is executing, after
   being called by ``C.''
<P>
 
<PRE>
 
        MAIN
      /  |  \
     B   C   D
    / \ /|   |
   E   F E   H
 
</PRE>
   The active call chain would consist of ``MAIN,'' ``C,'' and ``E.'' The
   traceback message, if retrieved at this point, would be:
<P>
 
<PRE>
   MAIN --&gt; C --&gt; E
</PRE>
   To make your own code participate in the traceback scheme, every routine
   in your program (except those that call nothing else and don't detect
   errors) should ``check in'' on entry and ``check out'' on exit. These
   actions tell the error handling mechanism whether your routine is in the
   active call chain or not.
<P>
 
   To check in, call CHKIN, supplying the name of your routine. To check
   out, call CHKOUT, also supplying the name of your routine. The call to
   CHKIN should come immediately after each entry into your code. A call to
   CHKOUT should precede each exit made after checking in. For example:
<P>
 
<PRE>
   C
   C     Here's a skeleton of code for a mock routine, SUBA:
   C
   C     Executable code follows
   C
   C
         IF ( RETURN() ) THEN
 
   C        No check out here, since we haven't checked in.
 
            RETURN
         ELSE
            CALL CHKIN ( 'SUBA' )
         END IF
 
               .
               .
               .
 
         IF ( X .LT. 1 ) THEN
   C        First exit following check in:
            CALL CHKOUT ( 'SUBA' )
            RETURN
          END IF
               .
               .
               .
 
   C     Normal exit:
         CALL CHKOUT ( 'SUBA' )
         RETURN
         END
</PRE>
   The traceback storage can accommodate a stack depth of 100 routines; the
   maximum length of each stored name is 32 characters.
<P>
 
<BR><BR>
<A NAME="Clean Coding Using FAILED"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Clean Coding Using <a href="../spicelib/failed.html">FAILED</a>
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   When you set the action to RETURN, all SPICELIB routines that can detect
   errors simply RETURN UPON ENTRY. So, they can't cause a run-time error.
   Therefore, you may safely call a number of SPICELIB routines
   consecutively, and just test <a href="../spicelib/failed.html">FAILED</a> after the last call in the sequence.
<P>
 
<BR><BR>
<A NAME="Example 10"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 1
</H3><P><BR><BR>
<PRE>
   C
   C     Read a line from USERFILE1.TXT, USERFILE2.TXT,
   C     and USERFILE3.TXT; check for errors:
   C
 
         CALL RDTEXT ( 'USERFILE1.TXT', LINE1, EOF )
         CALL RDTEXT ( 'USERFILE2.TXT', LINE2, EOF )
         CALL RDTEXT ( 'USERFILE3.TXT', LINE3, EOF )
 
         IF (  <a href="../spicelib/failed.html">FAILED</a>()  )  THEN
 
   C        Not all of LINE1, LINE2, LINE3 are valid, so quit:
 
            CALL CHKOUT ( 'MYSUB' )
            RETURN
 
         END IF
</PRE>
<BR><BR>
<A NAME="Example 20"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> Example 2
</H3><P><BR><BR>
<PRE>
   C
   C     In the following code, <a href="../spicelib/copyc.html">COPYC</a> is used to copy the result
   C     of the union of two sets (ordered cells) from a temporary
   C     working set back into one of the original sets.
   C
         CALL <a href="../spicelib/unionc.html">UNIONC</a> ( BODIES, PLANETS, TEMP )
         CALL <a href="../spicelib/copyc.html">COPYC</a>  ( TEMP,   BODIES        )
 
         IF ( <a href="../spicelib/failed.html">FAILED</a>() ) THEN
 
            CALL CHKOUT ( 'MYSUB' )
            RETURN
 
         END IF
 
   C
   C     If the size of the temporary cell is greater than the size
   C     of the original set, <a href="../spicelib/failed.html">FAILED</a> should be checked to be
   C     sure that no overflow occurred. If BODIES is at least as
   C     large as TEMP, no such check is necessary.
   C
</PRE>
   You can also use this coding technique with calls to your own routines,
   if your use the function RETURN.
<P>
 
<BR><BR>
<A NAME="Finding Out What the Current Error Handling Settings Are"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Finding Out What the Current Error Handling Settings Are
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   Below we explain how to set the error output device, the selection of
   error messages to output, and the error response action. You can
   retrieve the current settings of these items by calling the same
   routines you used to choose the settings, supplying the value ``GET'' as
   the first argument, instead of 'SET'.
<P>
 
   For example, you find out which device error output is sent to:
<P>
 
<PRE>
         CALL ERRDEV ( 'GET', DEVICE )
 
   C
   C     DEVICE now contains the name of the output device.
   C
</PRE>
   To find out what the current error response action is:
<P>
 
<PRE>
         CALL <a href="../spicelib/erract.html">ERRACT</a> ( 'GET', ACTION )
 
   C
   C     ACTION now contains the current error response action.
   C
</PRE>
   To find out what the current error message selection is:
<P>
 
<PRE>
         CALL <a href="../spicelib/errprt.html">ERRPRT</a> ( 'GET', LIST )
 
   C
   C     LIST now contains the last list of messages that
   C     was input by a call to <a href="../spicelib/errprt.html">ERRPRT</a>.  If no call was made,
   C     LIST has the value 'DEFAULT'.
   C
</PRE>
<BR><BR>
<A NAME="Concepts and Definitions"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Concepts and Definitions
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
<BR><BR>
<A NAME="About Errors"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> About Errors
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   What do we mean by ``errors''? In general, we mean ``asking routines to
   do something they can't do.'' Examples include supplying invalid values
   of input arguments to a subroutine, exceeding program limits such as the
   maximum number of files open simultaneously, or trying to read from a
   file that doesn't exist.
<P>
 
   When an error is detected because a routine has been used improperly,
   information about the context of the error is desirable. It's useful to
   know in which routine the error was detected, what the call chain was at
   the time of the error, and what the inputs to the routine that detected
   the error were. The SPICELIB error handling mechanism is designed to
   provide this type of information.
<P>
 
   On the other hand, when it's the program's job to determine the
   correctness of data, information about the program is not what is wanted
   when an error occurs. In this case, information about the data is what's
   needed. SPICELIB's automatic error handling is not appropriate for
   dealing with this type of error. However, it is possible to shut off the
   automatic error handling, using the IGNORE error action, and use
   non-SPICELIB code to handle these errors.
<P>
 
   In general, SPICELIB's automatic error handling is most useful for
   diagnosing programming errors.
<P>
 
   The only errors that the SPICELIB error handling mechanism deals with
   are DETECTABLE ones. SPICELIB can test whether a calling routine has
   supplied an argument that's in the domain of a function, but it can't
   tell if the calling routine has the order of the arguments in a calling
   sequence reversed. By coincidence, an error may be detected in that
   case, but the diagnosis will point to the error in an indirect way, at
   best. And if an application uses a faulty algorithm, but nonetheless
   uses the SPICELIB routines correctly, SPICELIB can't tell you about it.
<P>
 
   Some detectable errors exist which SPICELIB does not detect. While
   attempted division-by-zero errors are prevented, floating overflow is
   generally not prevented (because doing so is too inefficient).
<P>
 
   When a SPICELIB routine detects an error, it may mean the routine is
   being used improperly. One of the most likely causes is an interface
   error: inputs may be supplied to the routine that it can't handle, or
   there may be an error in the coding of the call to the routine itself.
   It's a good idea to thoroughly understand the descriptions of inputs and
   outputs given in the module headers of each SPICELIB routine called by
   one's application.
<P>
 
   Some other possible causes of errors may be: bugs in application
   software, bugs in SPICELIB software, or bad inputs to the application
   program. Errors can also occur due to problems with the program's
   environment. For example, an attempt to open a file could fail because
   the application program didn't have the privileges necessary to perform
   the open, or on some systems, because the file was in use by another
   user.
<P>
 
<BR><BR>
<A NAME="About Error Messages"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> About Error Messages
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   SPICELIB uses error messages to inform both the application program
   using SPICELIB, and the user, about what type of error has occurred and
   where in the program it occurred.
<P>
 
   SPICELIB provides routines for setting and retrieving error messages.
   When a routine detects an error, it may ``set,'' or store, error
   messages, which then can be retrieved and examined by other routines.
<P>
 
   There are five types of error messages:
<P>
 
<UL>
<TT>--</TT> The short error message.
<BR><BR></UL>
<UL>
<TT>--</TT> The explanation of the short error message.
<BR><BR></UL>
<UL>
<TT>--</TT> The long error message.
<BR><BR></UL>
<UL>
<TT>--</TT> Traceback.
<BR><BR></UL>
<UL>
<TT>--</TT> The default message.
<BR><BR></UL>
<BR><BR>
<A NAME="The short error message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> The short error message
</H3><P><BR><BR>
   This message is a character string containing a very terse, usually
   abbreviated, description of the problem. The message is a character
   string of length not more than 25 characters. It always has the form:
<P>
 
<PRE>
    SPICE(...)
</PRE>
   where the message text goes between the parentheses. An example is:
<P>
 
<PRE>
    SPICE(FILEOPENFAILED)
</PRE>
   The text is always composed of upper case letters and numbers.
<P>
 
   Short error messages used in SPICELIB are CONSTANT, since they are
   intended to be used in code. That is, they don't contain any data which
   varies with the specific instance of the error they indicate.
<P>
 
   Because of the brief format of the short error messages, it is practical
   to use them in a test to determine which type of error has occurred.
<P>
 
   For example:
<P>
 
<PRE>
         CALL RDTEXT ( FILE, LINE, EOF )
 
         IF ( <a href="../spicelib/failed.html">FAILED</a>() ) THEN
   C
   C        An error occurred.
   C        Find out what the short message was:
   C
            CALL <a href="../spicelib/getmsg.html">GETMSG</a> ( 'SHORT', SHRTMS )
 
            IF (    ( SHRTMS .EQ. 'SPICE(NOFREELOGICALUNIT)' )
        .      .OR. ( SHRTMS .EQ. 'SPICE(TOOMANYFILESOPEN)'  ) ) THEN
   C
   C           We won't succeed in reading any file. So, quit.
   C
               RETURN
 
            ELSE
 
              .
              .
              .
</PRE>
   If you use the SPICELIB error mechanism to respond to errors detected in
   your own code, you may wish to use your own short error messages. The
   SPICELIB error handling mechanism doesn't make use of the actual content
   of the messages, so you may use any values that are practical. It may be
   of use to make up your own prefix (analogous to SPICELIB's ``SPICE'' ),
   to identify the errors as detected by your own code. Recall the
   25-character limit; excess characters will be truncated.
<P>
 
   We recommend that you do NOT use blank short error messages. While the
   error handling mechanism allows it, the short error messages would no
   longer be useful for enabling code to determine the type of error that
   has occurred.
<P>
 
   The short message is ``set'' by supplying it as an input argument to the
   SPICELIB routine <a href="../spicelib/sigerr.html">SIGERR</a>. It is retrieved by calling <a href="../spicelib/getmsg.html">GETMSG</a> or <a href="../spicelib/getsms.html">GETSMS</a>.
<P>
 
<BR><BR>
<A NAME="The explanation of the short error message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> The explanation of the short error message
</H3><P><BR><BR>
   An 80-character expansion of the short message exists for a subset of
   SPICELIB's short messages. Each explanation message is constant. While
   the short message is meant to be used in code, the explanation is
   supposed to be easily interpreted by the human reader.
<P>
 
   SPICELIB provides the routine <a href="../spicelib/expln.html">EXPLN</a> to map short error messages to their
   explanations.
<P>
 
   Currently, there is no provision to extend the mapping to user-defined
   short messages.
<P>
 
   In future versions of SPICELIB, more space may be allocated for
   explanations. However, <a href="../spicelib/expln.html">EXPLN</a> will continue to return the first
   80-character line of the explanation text in that case.
<P>
 
   Here's an example of a short message and the corresponding explanation:
<P>
 
<PRE>
   Short message: 'SPICE(ZERORADIUS)'
 
   Explanation:   'Invalid Radius--Equatorial or Polar Radius is Zero'
</PRE>
<BR><BR>
<A NAME="The long error message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> The long error message
</H3><P><BR><BR>
   This message may be up to 1840 characters long. The SPICELIB error
   handling mechanism makes no use of its contents. Its purpose is to
   provide human-readable information about errors.
<P>
 
   Long error messages generated by SPICELIB routines often contain data
   relevant to the specific error they describe. Here's an example of a
   long error message generated by a misspelled body name provided as an
   input to the SPICELIB routine <a href="../spicelib/spkezr.html">SPKEZR</a>:
<P>
 
<PRE>
   The observer, 'earthh', is not a recognized name for an
   ephemeris object. The cause of this problem may be that
   you need an updated version of the SPICE toolkit. Alternatively
   you may call <a href="../spicelib/spkez.html">SPKEZ</a> directly if you know the SPICE ID codes
   for both 'moon' and 'earthh'
</PRE>
   The long message is ``set'' by supplying it as an input argument to the
   SPICELIB routine <a href="../spicelib/setmsg.html">SETMSG</a>. It may be retrieved by calling <a href="../spicelib/getmsg.html">GETMSG</a> or
   <a href="../spicelib/getlms.html">GETLMS</a>.
<P>
 
   The routines, <a href="../spicelib/errdp.html">ERRDP</a>, ERRINT, and <a href="../spicelib/errch.html">ERRCH</a> provide the capability to insert
   data into the long message. Their respective purposes are to insert
   DOUBLE PRECISION, INTEGER, and CHARACTER data into the long message.
   They (except <a href="../spicelib/errch.html">ERRCH</a>) convert the input data to a character string, and
   insert it in the current long message at a location indicated by a
   user-specified marker.
<P>
 
   We strongly recommend that you DO NOT write code that tests for
   particular values of SPICELIB long error messages; this is a very
   error-prone practice.
<P>
 
<BR><BR>
<A NAME="The traceback"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> The traceback
</H3><P><BR><BR>
   The purpose of this message is to represent the active call chain, that
   is, the set of subroutines in your program that have been called and
   have not yet returned. The traceback will always show the SPICELIB
   routines in the active call chain.
<P>
 
   You can have your own code participate in the SPICELIB traceback scheme,
   so that the traceback will represent the entire active call chain.
<P>
 
   Knowledge of the active call chain can be a valuable debugging aid,
   because it helps you determine where in your program an error occurred.
   For example, if your program calls subroutine SUBX from ten different
   subroutines, it's not enough to know that SUBX detected an error; you
   want to know which subroutine made the offending call to SUBX. The
   traceback contains that information. Another example: suppose a SPICELIB
   routine in your program detects an error, but your own code does not
   call that routine. You need to know which call, made by your own code to
   a SPICELIB routine, eventually resulted in the call to the routine that
   detected the error. The traceback shows you this.
<P>
 
   The SPICELIB error handling mechanism automatically keeps track of which
   SPICELIB routines are in the active call chain. In order for the
   SPICELIB error handling mechanism to represent the entire active call
   chain, including non-SPICELIB routines, it is necessary for each routine
   to tell the error handling mechanism: 1) when it has been called and 2)
   when it is about to return. In SPICELIB documentation, these two
   operations are called ``checking in'' and ``checking out.'' The set of
   routines that have checked in but have not yet checked out constitute
   the portion of the active call chain that the SPICELIB error handling
   mechanism can represent.
<P>
 
   SPICELIB provides the two routines CHKIN and CHKOUT for this purpose;
   CHKIN for checking in, and CHKOUT for checking out. CHKIN and CHKOUT
   take one input argument: the name of the calling routine.
<P>
 
   The traceback message has the form of a list of subroutine names,
   delimited by arrows. The first name in the list is the highest-level
   routine in the portion of the active call chain that is known to the
   SPICELIB error handling mechanism.
<P>
 
   As an example, suppose the following figure shows the calling hierarchy
   for a program, and that currently, subroutine ``E'' is executing, after
   being called by ``C.''
<P>
 
<PRE>
 
        MAIN
      /  |  \
     B   C   D
    / \ /|   |
   E   F E   H
 
</PRE>
   The active call chain would consist of ``MAIN,'' ``C,'' and ``E.'' The
   traceback message, if retrieved at this point, would be:
<P>
 
<PRE>
   MAIN --&gt; C --&gt; E
</PRE>
   The particular traceback information made available by SPICELIB is
   dependent on the error action and on whether an error has occurred. In
   general, the routines QCKTRC, TRCDEP, and TRCNAM return information
   about the current active call chain. But when the error response action
   is RETURN, and an error occurs, the error handling mechanism captures a
   ``frozen'' copy of the traceback; from this point on, the trace
   information provided by the above routines will be based on the frozen
   copy. The purpose of this behavior is to make the traceback that existed
   at the time the error occurred available to the application program.
   Changing the error action to a value other than RETURN, or resetting the
   error status, will cause the traceback routines QCKTRC, TRCDEP, and
   TRCNAM to return data based on the current traceback again.
<P>
 
   The overhead of checking in and checking out may be prohibitive for some
   routines. An intermediate position between not using CHKIN and CHKOUT
   and using them in every routine is to use them only in routines that
   call other routines, or that detect errors. Routines which do neither
   would never appear in a traceback anyway. Note that absence of error
   detection in a routine is not sufficient grounds for exclusion from
   checking in and checking out, since a routine called by the routine in
   question could detect an error, and then the caller should appear in the
   traceback.
<P>
 
   It is important to note that ONLY routines which have checked in can
   possibly have their names appear in the traceback. So the traceback will
   not be accurate if any routines in the active call chain have not
   ``checked in,'' when a traceback message is produced.
<P>
 
   The traceback mechanism requires any ``checked-in'' routine to check out
   before exit.
<P>
 
<BR><BR>
<A NAME="The default message"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H3> The default message
</H3><P><BR><BR>
   This message is output when an error occurs, and the error response
   action is DEFAULT. It informs the user that the behavior of SPICELIB
   error handling is user-tailorable, and it refers the user to this
   document.
<P>
 
<BR><BR>
<A NAME="About Error Response Actions"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> About Error Response Actions
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   The term ``error response action'' refers to the action that the
   SPICELIB error handling mechanism takes automatically when an error is
   signaled. SPICELIB provides the routine <a href="../spicelib/erract.html">ERRACT</a> to enable you to select
   the error response action.
<P>
 
   There are five different error response actions, each appropriate to a
   different type of programming situation:
<P>
 
<DL><DT>
<B>
 DEFAULT
</B><BR><BR>
<DD>
 This is what you get if you don't choose an error response action. When
the error action is DEFAULT, and an error is signaled, the SPICELIB
error handling mechanism outputs all of the available types of error
messages to the error output device, and then stops program execution.<BR>
</DL>
   The default action is probably acceptable as a response to detection of
   program bugs. However, if you wish to allow your own program to respond
   to errors, you must choose one of REPORT, RETURN, or IGNORE as the error
   response action.
<P>
 
<DL><DT>
<B>
 ABORT
</B><BR><BR>
<DD>
 This action is the same as the default, except that the set of error
messages is selectable. This action is useful for running programs in
batch mode, to prevent them from continuing execution after
encountering an error. The ABORT action is also useful if your program
does not perform any error handling itself.<BR>
</DL>
<DL><DT>
<B>
 REPORT
</B><BR><BR>
<DD>
 This action can be useful for debugging. With the REPORT action, the
SPICELIB error handling mechanism outputs error messages when an error
is signaled, but doesn't stop your program. So, more information can be
gained from a single run of your program than with the ABORT action.
Using the SPICELIB routine ERRDEV, you can direct the error messages
output by the SPICELIB error handling mechanism to a file, thus
creating a log of your errors.<BR>
</DL>
   However, the function <a href="../spicelib/failed.html">FAILED</a> will indicate an error condition after an
   error has been signaled. Therefore, any program logic that depends on
   the value returned by <a href="../spicelib/failed.html">FAILED</a> may be affected by an error. You can use
   the SPICELIB routine <a href="../spicelib/reset.html">RESET</a> to set the error status to ``no error,'' so
   that your program will attempt to follow a normal thread of execution,
   after an error is signaled.
<P>
 
<DL><DT>
<B>
 RETURN
</B><BR><BR>
<DD>
 The RETURN action's intend use is in situations where you want your
program to recover from errors detected by SPICELIB (or by your own
code). Like the REPORT action, the RETURN action also includes writing
error messages to the chosen output device. But with the RETURN action,
the SPICELIB function RETURN takes the `true' value when an error is
signaled. Any routine that tests the function RETURN on entry, and that
returns immediately if RETURN takes the `true' value, will not crash in
this case. All SPICELIB routines that can detect errors, or that call
other routines, do test RETURN on entry and return if the `true' value.
This behavior maximizes the chance that SPICELIB routines will return
control to the application program using them, in the event of an
error.<BR>
</DL>
   It is also possible to use the function RETURN in the same way in your
   own routines. We note here that use of RETURN mode allows you to call
   multiple SPICELIB routines consecutively, without testing the error
   status until after the last call. This can greatly enhance the
   readability of your code, and increase its efficiency, as well.
<P>
 
   Returning control to the non SPICELIB portion of the program allows for
   a response to the error condition. The nature of the response is
   application-dependent. However, in the case that the error does not
   preclude further successful operation of the program, it is necessary to
   instruct the SPICELIB error handling mechanism that normal operation is
   desired, after the error has been responded to. The SPICELIB function
   <a href="../spicelib/reset.html">RESET</a> is provided for this purpose. Calling RESET blanks out all stored
   error messages, and causes the functions <a href="../spicelib/failed.html">FAILED</a> and RETURN to take the
   `false' value.
<P>
 
<DL><DT>
<B>
 IGNORE
</B><BR><BR>
<DD>
 This action is provided to allow you to completely ``shut off''
SPICELIB's automatic error handling. When this action is selected, and
any routine signals an error, no action is taken by the SPICELIB error
handling mechanism. The error messages cannot be updated by <a href="../spicelib/sigerr.html">SIGERR</a> and
<a href="../spicelib/setmsg.html">SETMSG</a>, and RETURN and <a href="../spicelib/failed.html">FAILED</a> will not change their values.<BR>
</DL>
   This action may be useful in the case where you know exactly which
   errors will be detected by SPICELIB routines, and you know that no
   response is required.
<P>
 
   Note that the IGNORE action is not appropriate for the case where you
   wish to suppress automatic output of SPICELIB error messages, and to
   handle SPICELIB errors in your own code. To do that, use the RETURN
   error action and set the selection of error messages to 'NONE', using
   <a href="../spicelib/errprt.html">ERRPRT</a>.
<P>
 
<BR><BR>
<A NAME="Advanced Programming with Error Handling"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H1> Advanced Programming with Error Handling
</H1><HR SIZE=3 NOSHADE><P><BR><BR><BR>
   This chapter discusses some further error handling topics.
<P>
 
<BR><BR>
<A NAME="Using the SPICELIB Functions FAILED and RETURN"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Using the SPICELIB Functions <a href="../spicelib/failed.html">FAILED</a> and RETURN
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   First, note that the SPICELIB function RETURN takes the `false' value
   unless the error response action is RETURN, so all of the following
   discussion assumes that the error action has been set to RETURN.
<P>
 
   Which routines should use the function RETURN, and where?
<P>
 
   The ``which?'' question is somewhat tricky: there's a trade-off between
   speed and resistance to program crashes. It takes time (not much) to
   test RETURN, and in a very short routine, such as one that computes a
   dot product, the execution time can be increased by a substantial factor
   if RETURN is tested. In most routines, the percentage increase in
   execution time is small.
<P>
 
   So, if you don't want to test RETURN in every routine, how do you
   decide? The SPICELIB answer to this question is, test RETURN in routines
   that call other routines or detect errors (SPICELIB routines that are
   specifically intended to perform error handling are exempt from testing
   RETURN). If a routine calls another routine already, it's unlikely that
   testing RETURN will slow its execution intolerably. Similarly for
   routines that test for error conditions.
<P>
 
   Our final answer is still a hedge: the proper use of RETURN depends on
   your speed and reliability requirements. The SPICELIB method may be a
   good zero-order approximation to what's optimal.
<P>
 
   NOTE: You must be very careful about using RETURN in application code
   that DOES error handling, otherwise your error handling code itself may
   not function when an error is signaled.
<P>
 
   The ``where?'' question also eludes a straightforward answer. The idea
   behind the RETURN action is to ensure that control is returned to
   whatever part of your program handles errors, when an error is signaled.
   According to this idea, once an error has been signaled, you have to do
   something about the error before you can finish the job. So, routines
   that do use RETURN ought to test it at the very beginning of their
   executable code; there's no reason for them to proceed further until the
   error condition has been acted upon.
<P>
 
   What about using the function RETURN in other parts of the code, for
   instance following calls to SPICELIB routines? The same speed vs crash
   resistance trade-off applies, but there is another consideration: RETURN
   has an effect only when the error action is RETURN. So, in cases where
   an error condition makes it likely that a portion of code won't work,
   it's usually better to test the function <a href="../spicelib/failed.html">FAILED</a>, rather than RETURN,
   since a program crash is usually undesirable, even when using the REPORT
   action for debugging. But if you do want to retain the option of
   executing the code when an error has already occurred, use RETURN.
<P>
 
   We repeat here that the SPICELIB function <a href="../spicelib/failed.html">FAILED</a> indicates whether an
   error has been signaled, regardless of the error response action. It can
   be used to avoid executing any code that may cause a run-time error if
   an error has already occurred. Note that testing <a href="../spicelib/failed.html">FAILED</a> instead of
   RETURN means that whether the error response action is RETURN or REPORT
   doesn't affect the program logic in question; the logic depends on
   whether or not an error has been signaled.
<P>
 
<BR><BR>
<A NAME="Using the SPICELIB routines CHKIN and CHKOUT"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Using the SPICELIB routines CHKIN and CHKOUT
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   The simplest approach to the use of these routines is to use them in
   every routine you write. But as with the case of RETURN, your routines
   will be slightly slower if they call CHKIN and CHKOUT, and for very
   short routines, the percentage difference may be great.
<P>
 
   The SPICELIB approach is to call CHKIN and CHKOUT in routines which call
   other routines or which can detect errors. This way, every routine that
   can possibly be in the active call chain at the time an error is
   detected can appear in the traceback message.
<P>
 
   As mentioned in the previous section, these routines are less likely to
   suffer a large percentage increase in execution time as a result of
   making extra calls.
<P>
 
   We note that some routines that do make external references but do not
   signal errors may have no routines capable of signaling errors below
   them in the calling hierarchy; these routines won't appear in a
   traceback. Why should they call CHKIN and CHKOUT? They should do so for
   maintenance reasons, specifically, if any routine below them in the
   calling hierarchy is changed so as to be able to detect an error, the
   higher level routines don't need to be changed.
<P>
 
<BR><BR>
<A NAME="Using Multiple Settings of the Automatic Error Handling Features"></A>
<p align="right"><a href="#top"><small>Top</small></a></p>
<H2> Using Multiple Settings of the Automatic Error Handling Features
</H2><HR ALIGN="LEFT" WIDTH=50% ><P><BR><BR>
   In the second chapter, we suggested that you choose the error output
   device, error response action, and selection of error messages, during
   program initialization and leave them unchanged for the duration of the
   program run. This is probably a good procedure to stick to for
   inexperienced users. However, it's possible and reasonable to do some
   fancier things with these settings, in some cases:
<P>
 
<UL>
<TT>--</TT> Resetting the output device. This isn't particularly fancy; you may simply
want to write error messages from different parts of your program to
different devices. ERRDEV may be called from anywhere in your program, as
many times as your wish. Note that the error response action should not be
DEFAULT or ABORT, for in this case the first error signaled terminates
execution.
<BR><BR></UL>
<UL>
<TT>--</TT> Resetting the error message selection. Nothing to it, just call <a href="../spicelib/errprt.html">ERRPRT</a> any
time. Again, note that the error response action should not be DEFAULT or
ABORT, for in this case the first error signaled terminates execution.
<BR><BR></UL>
<UL>
<TT>--</TT> Resetting the error response action. <a href="../spicelib/erract.html">ERRACT</a> can also be called at any time.
However, it is important to be aware of the special effects of these error
response action ``transitions.'' Specifically:
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> When making a transition to a new action, the value of <a href="../spicelib/failed.html">FAILED</a> does not
change. If <a href="../spicelib/failed.html">FAILED</a> has the `true' value, and you set the action to IGNORE,
any NEW errors that are signaled will be ignored, but <a href="../spicelib/failed.html">FAILED</a> will remain
`true'.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> The value of the function RETURN depends on <a href="../spicelib/failed.html">FAILED</a> and the current action.
Specifically, RETURN has the `true' value if and only if <a href="../spicelib/failed.html">FAILED</a> has the
`true' value and the action is RETURN. Therefore, note that if <a href="../spicelib/failed.html">FAILED</a> has
the `true' value and you change the action to RETURN, the function RETURN
will now have the `true' value, regardless of its previous value. Setting
the action to something other than RETURN will cause RETURN to take the
`false' value, regardless of its previous value.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Changing the error action doesn't affect the stored short and long error
messages, if any. If there are stored messages, they will still be
available if the action is changed to IGNORE.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> The traceback routines return information about the ``frozen'' traceback if
and only if RETURN has the `true' value. So the rule about which traceback
you get is the same as the rule for the value of RETURN.
<BR><BR></UL>
<UL>
<TT>&#32;&#32;</TT> Changing the action to ABORT or DEFAULT doesn't automatically abort your
program if <a href="../spicelib/failed.html">FAILED</a> has the `true' value; an error must be signaled while the
action is one of these values to achieve an abort.
<BR><BR></UL>
<UL>
<TT>--</TT> Temporary resetting of the error handling selections. What if you want to
set the error action to ABORT or IGNORE while a certain section of code
executes, and then set it back to its original value? Easy: call <a href="../spicelib/erract.html">ERRACT</a>
with the ``GET'' option to get the current error action. Save this value,
call <a href="../spicelib/erract.html">ERRACT</a> with the ``SET'' option to set the new value, and finally set
the action back to the saved value.
<BR><BR></UL>
   For example:
<P>
 
<PRE>
   C
   C     All errors in the following section of code are
   C     fatal.  Temporarily set the error action to
   C     'ABORT'; restore old action after end of code
   C     section.
   C
 
         CALL <a href="../spicelib/erract.html">ERRACT</a> ( 'GET', SAVACT  )
 
         CALL <a href="../spicelib/erract.html">ERRACT</a> ( 'SET', 'ABORT' )
 
 
    { Section of code in which errors are fatal starts here }
 
                          .
                          .
                          .
 
 
    { Section of code in which errors are fatal ends here }
 
 
   C
   C     Restore old error action:
   C
         CALL <a href="../spicelib/erract.html">ERRACT</a> ( 'SET', SAVACT )
</PRE>
   Changes to the error output device or error message selection can be
   made in the same way; both ERRDEV and <a href="../spicelib/errprt.html">ERRPRT</a> accept the values ``GET''
   and ``SET'' for their first argument.
<P>
 

</TD>
</TR>
</TBODY>
</TABLE>

</BODY>

</HTML>
