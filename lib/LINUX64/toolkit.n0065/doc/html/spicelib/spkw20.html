
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>spkw20</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>spkw20</b> </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">

<small><div align="center">
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div></small>
       <br>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
            <small>
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Examples">Examples<br></a>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
             </small>
            </td>
          </tr>
        </tbody>
</table>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
 SPKW20 ( SPK, write segment, type 20 )

      SUBROUTINE SPKW20 (  HANDLE,  BODY,    CENTER,  FRAME,
     .                     FIRST,   LAST,    SEGID,   INTLEN,
     .                     N,       POLYDG,  CDATA,   DSCALE,
     .                     TSCALE,  INITJD,  INITFR          )
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Write a type 20 segment to an SPK file.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/daf.html">DAF</a>
     <a href="../req/naif_ids.html">NAIF_IDS</a>
     <a href="../req/time.html">TIME</a>
     <a href="../req/spk.html">SPK</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     EPHEMERIS
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
    
      IMPLICIT NONE
      INCLUDE 'spk20.inc'

      INTEGER               HANDLE
      INTEGER               BODY
      INTEGER               CENTER
      CHARACTER*(*)         FRAME
      DOUBLE PRECISION      FIRST
      DOUBLE PRECISION      LAST
      CHARACTER*(*)         SEGID
      DOUBLE PRECISION      INTLEN
      INTEGER               N
      INTEGER               POLYDG
      DOUBLE PRECISION      CDATA  ( * )
      DOUBLE PRECISION      DSCALE
      DOUBLE PRECISION      TSCALE
      DOUBLE PRECISION      INITJD
      DOUBLE PRECISION      INITFR
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
   Variable  I/O  Description
     --------  ---  --------------------------------------------------
     HANDLE     I   Handle of SPK file open for writing.
     BODY       I   NAIF code for ephemeris object.
     CENTER     I   NAIF code for the center of motion of the body.
     FRAME      I   Reference frame name.
     FIRST      I   Start time of interval covered by segment.
     LAST       I   End time of interval covered by segment.
     SEGID      I   Segment identifier.
     INTLEN     I   Length of time covered by logical record (days).
     N          I   Number of logical records in segment.
     POLYDG     I   Chebyshev polynomial degree.
     CDATA      I   Array of Chebyshev coefficients and positions.
     DSCALE     I   Distance scale of data.
     TSCALE     I   Time scale of data.
     INITJD     I   Integer part of begin time (TDB Julian date) of
                    first record.
     INITFR     I   Fractional part of begin time (TDB Julian date) of
                    first record.
     MAXDEG     P   Maximum allowed degree of Chebyshev expansions.
     TOLSCL     P   Tolerance scale for coverage bound checking.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     HANDLE         is the DAF handle of an SPK file to which a type 20
                    segment is to be added.  The SPK file must be open
                    for writing.

     BODY           is the NAIF integer code for an ephemeris object
                    whose state relative to another body is described
                    by the segment to be created.

     CENTER         is the NAIF integer code for the center of motion
                    of the object identified by BODY.

     FRAME          is the NAIF name for a reference frame relative to
                    which the state information for BODY is specified.

     FIRST,
     LAST           are the start and stop times of the time interval
                    over which the segment defines the state of the
                    object identified by BODY.

     SEGID          is a segment identifier. An SPK segment identifier
                    may contain up to 40 characters.

     INTLEN         is the length of time, in TDB Julian days, covered
                    by each set of Chebyshev polynomial coefficients
                    (each logical record).

     N              is the number of logical records to be stored in
                    the segment. There is one logical record for each
                    time period. Each logical record contains three
                    sets of Chebyshev coefficients---one for each
                    coordinate---and three position vector components.

     POLYDG         is the degree of each set of Chebyshev
                    polynomials, i.e. the number of Chebyshev
                    coefficients per coordinate minus one. POLYDG must
                    be less than or equal to the parameter MAXDEG.

     CDATA          is an array containing all the sets of Chebyshev
                    polynomial coefficients and position components to
                    be placed in the new segment of the SPK file.
                    There are three sets of coefficients and position
                    components for each time interval covered by the
                    segment.

                    The coefficients and position components are
                    stored in CDATA in order as follows:

                       the (POLYDG + 1) coefficients for the first
                       coordinate of the first logical record,
                       followed by the X component of position at the
                       first interval midpoint. The first coefficient
                       is that of the constant term of the expansion.

                       the coefficients for the second coordinate,
                       followed by the Y component of position at the
                       first interval midpoint.

                       the coefficients for the third coordinate,
                       followed by the Z component of position at the
                       first interval midpoint.

                       the coefficients for the first coordinate for
                       the second logical record, followed by the X
                       component of position at the second interval
                       midpoint.

                       and so on.

                    The logical data records are stored contiguously:
                
                       +----------+
                       | Record 1 | 
                       +----------+
                       | Record 2 | 
                       +----------+
                           ...
                       +----------+
                       | Record N | 
                       +----------+

                    The contents of an individual record are:
                                        
                       +--------------------------------------+
                       | Coeff set for X velocity component   |
                       +--------------------------------------+
                       | X position component                 |
                       +--------------------------------------+
                       | Coeff set for Y velocity component   |
                       +--------------------------------------+
                       | Y position component                 |
                       +--------------------------------------+
                       | Coeff set for Z velocity component   |
                       +--------------------------------------+
                       | Z position component                 |
                       +--------------------------------------+

                   Each coefficient set has the structure:

                       +--------------------------------------+
                       | Coefficient of T_0                   |
                       +--------------------------------------+
                       | Coefficient of T_1                   |
                       +--------------------------------------+
                                         ...
                       +--------------------------------------+
                       | Coefficient of T_POLYDG              |
                       +--------------------------------------+

                    Where T_n represents the Chebyshev polynomial
                    of the first kind of degree n.


     DSCALE, 
     TSCALE         are, respectively, the distance scale of the input
                    position and velocity data in km, and the time
                    scale of the input velocity data in TDB seconds.

                    For example, if the input distance data have units
                    of astronomical units (AU), DSCALE should be set
                    to the number of km in one AU. If the input
                    velocity data have time units of Julian days, then
                    TSCALE should be set to the number of seconds per
                    Julian day (86400).


     INITJD         is the integer part of the Julian ephemeris date
                    of initial epoch of the first record. INITJD may
                    be less than, equal to, or greater than the
                    initial epoch.

     INITFR         is the fractional part of the Julian ephemeris date
                    of initial epoch of the first record. INITFR has
                    units of Julian days. INITFR has magnitude
                    strictly less than 1 day. The sum

                       INITJD + INITFR 

                    equals the Julian ephemeris date of the initial
                    epoch of the first record.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     None. This routine writes data to an SPK file.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     The parameters described in this section are declared in the 
     Fortran INCLUDE file spk20.inc


     MAXDEG         is the maximum allowed degree of the input
                    Chebyshev expansions.


     TOLSCL         is a tolerance scale factor (also called a
                    &quot;relative tolerance&quot;) used for time coverage
                    bound checking. TOLSCL is unitless. TOLSCL
                    produces a tolerance value via the formula

                       TOL = TOLSCL * MAX( ABS(FIRST), ABS(LAST) )

                    where FIRST and LAST are the coverage time bounds
                    of a type 20 segment, expressed as seconds past
                    J2000 TDB.

                    The resulting parameter TOL is used as a tolerance
                    for comparing the input segment descriptor time 
                    bounds to the first and last epoch covered by the
                    sequence of time intervals defined by the inputs

                       INITJD
                       INITFR
                       INTLEN
                       N
                        
                    See the Exceptions section below for a description
                    of the error check using this tolerance.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  If the number of sets of coefficients is not positive
         SPICE(INVALIDCOUNT) is signaled.

     2)  If the interval length is not positive, SPICE(INTLENNOTPOS)
         is signaled.

     3)  If the name of the reference frame is not recognized,
         SPICE(INVALIDREFFRAME) is signaled.

     4)  If segment stop time is not greater than or equal to 
         the begin time, SPICE(BADDESCRTIMES) is signaled.

     5)  If the start time of the first record exceeds the descriptor
         begin time by more than a computed tolerance, or if the end
         time of the last record precedes the descriptor end time by
         more than a computed tolerance, the error SPICE(COVERAGEGAP)
         is signaled. See the Parameters section above for a
         description of the tolerance.

     6)  If the input degree POLYDG is less than 0 or greater than
         MAXDEG, the error SPICE(INVALIDDEGREE) is signaled.

     7)  If the last non-blank character of SEGID occurs past index
         40, or if SEGID contains any nonprintable characters, the
         error will be diagnosed by a routine in the call tree of this
         routine.

     8)  If either the distance or time scale is non-positive, the
         error SPICE(NONPOSITIVESCALE) will be signaled.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     A new type 20 SPK segment is written to the SPK file attached
     to HANDLE.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine writes an SPK type 20 data segment to the designated
     SPK file, according to the format described in the SPK Required
     Reading.

     Each segment can contain data for only one target, central body,
     and reference frame. The Chebyshev polynomial degree and length
     of time covered by each logical record are also fixed. However,
     an arbitrary number of logical records of Chebyshev polynomial
     coefficients can be written in each segment.  Minimizing the
     number of segments in an SPK file will help optimize how the
     SPICE system accesses the file.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     Suppose that you have in an array CDATA sets of Chebyshev
     polynomial coefficients and position vectors representing the
     state of the moon (NAIF ID = 301), relative to the Earth-moon
     barycenter (NAIF ID = 3), in the J2000 reference frame, and you
     want to put these into a type 20 segment in an existing SPK file.
     The following code could be used to add one new type 20 segment.
     To add multiple segments, put the call to <b>SPKW20</b> in a loop.

     C
     C      First open the SPK file and get a handle for it.
     C
            CALL <a href="dafopw.html">DAFOPW</a> ( SPKNAM, HANDLE )

     C
     C      Create a segment identifier.
     C
            SEGID = 'MY_SAMPLE_SPK_TYPE_20_SEGMENT'

     C
     C      Note that the interval length INTLEN has units
     C      of Julian days. The start time of the first record
     C      is expressed using two inputs: integer and fractional
     C      portions of the Julian ephemeris date of the start 
     C      time.
     C
     C      Write the segment. 
     C
            CALL <b>SPKW20</b> ( HANDLE, 301,    3,      'J2000',
          .               FIRST,  LAST,   SEGID,  INTLEN,
          .               N,      POLYDG, CDATA,  DSCALE,
          .               TSCALE, INITJD, INITFR           )

     C
     C      Close the file.
     C
            CALL <a href="dafcls.html">DAFCLS</a> ( HANDLE )
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman (JPL)
     K.S. Zukor   (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.0.0, 17-JAN-2017 (NJB) (KSZ)</PRE>
<h4>Link to routine SPKW20 source file <a href='../../../src/spicelib/spkw20.f'>spkw20.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Tue Jul 15 14:25:10 2014</pre>

</body>
</html>

