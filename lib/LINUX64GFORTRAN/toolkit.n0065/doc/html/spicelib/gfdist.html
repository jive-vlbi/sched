
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>gfdist</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>gfdist</b> </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">

<small><div align="center">
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div></small>
       <br>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
            <small>
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Examples">Examples<br></a>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
             </small>
            </td>
          </tr>
        </tbody>
</table>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
 GFDIST ( GF, distance search )

      SUBROUTINE GFDIST ( TARGET, ABCORR, OBSRVR, RELATE,
     .                    REFVAL, ADJUST, STEP,   CNFINE,
     .                    MW,     NW,     WORK,   RESULT  )
      IMPLICIT NONE
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Determine time intervals over which a specified constraint on
     observer-target distance is met.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/gf.html">GF</a>
     <a href="../req/naif_ids.html">NAIF_IDS</a>
     <a href="../req/spk.html">SPK</a>
     <a href="../req/time.html">TIME</a>
     <a href="../req/windows.html">WINDOWS</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     EVENT
     GEOMETRY
     EPHEMERIS
     SEARCH
     WINDOW
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
      INCLUDE               'gf.inc'
      INCLUDE               'zzholdd.inc'

      INTEGER               LBCELL
      PARAMETER           ( LBCELL = -5 )

      CHARACTER*(*)         TARGET
      CHARACTER*(*)         ABCORR
      CHARACTER*(*)         OBSRVR
      CHARACTER*(*)         RELATE
      DOUBLE PRECISION      REFVAL
      DOUBLE PRECISION      ADJUST
      DOUBLE PRECISION      STEP
      DOUBLE PRECISION      CNFINE ( LBCELL : * )
      INTEGER               MW
      INTEGER               NW
      DOUBLE PRECISION      WORK   ( LBCELL : MW, NW )
      DOUBLE PRECISION      RESULT ( LBCELL : * )
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     Variable  I/O  Description
     --------  ---  --------------------------------------------------
     LBCELL     P   SPICE Cell lower bound.
     CNVTOL     P   Convergence tolerance
     NWDIST     P   Number of workspace windows for distance search.
     TARGET     I   Name of the target body.
     ABCORR     I   Aberration correction flag.
     OBSRVR     I   Name of the observing body.
     RELATE     I   Relational operator.
     REFVAL     I   Reference value.
     ADJUST     I   Adjustment value for absolute extrema searches.
     STEP       I   Step size used for locating extrema and roots.
     CNFINE     I   SPICE window to which the search is confined.
     MW         I   Workspace window size.
     NW         I   Workspace window count.
     WORK      I-O   Array of workspace windows.
     RESULT    I-O   SPICE window containing results.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     TARGET      is the name of a target body. Optionally, you may
                 supply the integer ID code for the object as an
                 integer string.  For example both 'MOON' and '301'
                 are legitimate strings that indicate the moon is the
                 target body.

                 The target and observer define a position vector which
                 points from the observer to the target; the length of
                 this vector is the &quot;distance&quot; that serves as the
                 subject of the search performed by this routine.

                 Case and leading or trailing blanks are not
                 significant in the string TARGET.


     ABCORR      indicates the aberration corrections to be applied to
                 the observer-target position vector to account for
                 one-way light time and stellar aberration.

                 Any aberration correction accepted by the SPICE
                 routine <a href="spkezr.html">SPKEZR</a> is accepted here. See the header
                 of <a href="spkezr.html">SPKEZR</a> for a detailed description of the
                 aberration correction options. For convenience,
                 the options are listed below:

                    'NONE'     Apply no correction.

                    'LT'       &quot;Reception&quot; case:  correct for
                               one-way light time using a Newtonian
                               formulation.

                    'LT+S'     &quot;Reception&quot; case:  correct for
                               one-way light time and stellar
                               aberration using a Newtonian
                               formulation.

                    'CN'       &quot;Reception&quot; case:  converged
                               Newtonian light time correction.

                    'CN+S'     &quot;Reception&quot; case:  converged
                               Newtonian light time and stellar
                               aberration corrections.

                    'XLT'      &quot;Transmission&quot; case:  correct for
                               one-way light time using a Newtonian
                               formulation.

                    'XLT+S'    &quot;Transmission&quot; case:  correct for
                               one-way light time and stellar
                               aberration using a Newtonian
                               formulation.

                    'XCN'      &quot;Transmission&quot; case:  converged
                               Newtonian light time correction.

                    'XCN+S'    &quot;Transmission&quot; case:  converged
                               Newtonian light time and stellar
                               aberration corrections.

                 Case and leading or trailing blanks are not
                 significant in the string ABCORR.


     OBSRVR      is the name of an observing body.  Optionally, you
                 may supply the ID code of the object as an integer
                 string. For example, both 'EARTH' and '399' are
                 legitimate strings to supply to indicate the
                 observer is Earth.

                 Case and leading or trailing blanks are not
                 significant in the string OBSRVR.


     RELATE      is a relational operator used to define a constraint
                 on the observer-target distance. The result window
                 found by this routine indicates the time intervals
                 where the constraint is satisfied. Supported values
                 of RELATE and corresponding meanings are shown below:

                    '&gt;'      Distance is greater than the reference
                             value REFVAL.

                    '='      Distance is equal to the reference
                             value REFVAL.

                    '&lt;'      Distance is less than the reference
                             value REFVAL.


                   'ABSMAX'  Distance is at an absolute maximum.

                   'ABSMIN'  Distance is at an absolute  minimum.

                   'LOCMAX'  Distance is at a local maximum.

                   'LOCMIN'  Distance is at a local minimum.

                The caller may indicate that the region of interest is
                the set of time intervals where the distance is within
                a specified offset relative to an absolute extremum.
                The argument ADJUST (described below) is used to
                specify this offset.

                Local extrema are considered to exist only in the
                interiors of the intervals comprising the confinement
                window:  a local extremum cannot exist at a boundary
                point of the confinement window.

                Case and leading or trailing blanks are not
                significant in the string RELATE.


     REFVAL     is the reference value used together with the argument
                RELATE to define an equality or inequality to be
                satisfied by the distance between the specified target
                and observer. See the discussion of RELATE above for
                further information.

                The units of REFVAL are km.


     ADJUST     is a parameter used to modify searches for absolute
                extrema: when RELATE is set to ABSMAX or ABSMIN and
                ADJUST is set to a positive value, <b>GFDIST</b>
                will find times when the observer-target distance is
                within ADJUST km of the specified extreme value.

                If ADJUST is non-zero and a search for an absolute
                minimum AMIN is performed, the result window contains
                time intervals when the observer-target distance has
                values between AMIN and AMIN + ADJUST.

                If the search is for an absolute maximum AMAX, the
                corresponding range is  between AMAX - ADJUST and
                AMAX.

                ADJUST is not used for searches for local extrema,
                equality or inequality conditions.


     STEP       is the step size to be used in the search. STEP must
                be shorter than any maximal time interval on which the
                specified distance function is monotone increasing or
                decreasing. That is, if the confinement window is
                partitioned into alternating intervals on which the
                distance function is either monotone increasing or
                decreasing, STEP must be shorter than any of these
                intervals.

                However, STEP must not be *too* short, or the search
                will take an unreasonable amount of time.

                The choice of STEP affects the completeness but not
                the precision of solutions found by this routine; the
                precision is controlled by the convergence tolerance.
                See the discussion of the parameter CNVTOL for
                details.

                STEP has units of TDB seconds.


     CNFINE     is a SPICE window that confines the time period over
                which the specified search is conducted. CNFINE may
                consist of a single interval or a collection of
                intervals.

                The endpoints of the time intervals comprising CNFINE
                are interpreted as seconds past J2000 TDB.

                See the Examples section below for a code example
                that shows how to create a confinement window.

                CNFINE must be initialized by the caller via the
                SPICELIB routine <a href="ssized.html">SSIZED</a>.


     MW         is a parameter specifying the length of the SPICE
                windows in the workspace array WORK (see description
                below) used by this routine.

                MW should be set to a number at least twice as large
                as the maximum number of intervals required by any
                workspace window. In many cases, it's not necessary to
                compute an accurate estimate of how many intervals are
                needed; rather, the user can pick a size considerably
                larger than what's really required.

                However, since excessively large arrays can prevent
                applications from compiling, linking, or running
                properly, sometimes MW must be set according to
                the actual workspace requirement. A rule of thumb
                for the number of intervals NINTVLS needed is

                    NINTVLS  =  2*N  +  ( M / STEP )

                where

                    N     is the number of intervals in the confinement
                          window

                    M     is the measure of the confinement window, in
                          units of seconds

                    STEP  is the search step size in seconds

                MW should then be set to

                    2 * NINTVLS


     NW         is a parameter specifying the number of SPICE windows
                in the workspace array WORK (see description below)
                used by this routine. NW should be set to the
                parameter NWDIST; this parameter is declared in the
                include file gf.inc. (The reason this dimension is
                an input argument is that this allows run-time
                error checking to be performed.)


     WORK       is an array used to store workspace windows. This
                array should be declared by the caller as shown:

                   INCLUDE 'gf.inc'
                      ...

                   DOUBLE PRECISION    WORK ( LBCELL : MW, NWDIST )

                where MW is a constant declared by the caller and
                NWDIST is a constant defined in the SPICELIB INCLUDE
                file gf.inc. See the discussion of MW above.

                WORK need not be initialized by the caller.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     WORK       is the input workspace array, modified by this
                routine. The caller should re-initialize this array
                before attempting to use it for any other purpose.


     RESULT     is the window of intervals, contained within the
                confinement window CNFINE, on which the specified
                constraint is satisfied.

                The endpoints of the time intervals comprising RESULT
                are interpreted as seconds past J2000 TDB.

                If RESULT is non-empty on input, its contents
                will be discarded before <b>GFDIST</b> conducts its
                search.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     LBCELL     is the lower bound for SPICE Cell arrays.

     CNVTOL     is the convergence tolerance used for finding
                endpoints of the intervals comprising the result
                window. CNVTOL is also used for finding intermediate
                results; in particular, CNVTOL is used for finding the
                windows on which the specified distance is increasing
                or decreasing. CNVTOL is used to determine when binary
                searches for roots should terminate: when a root is
                bracketed within an interval of length CNVTOL; the
                root is considered to have been found.

                The accuracy, as opposed to precision, of roots found
                by this routine depends on the accuracy of the input
                data. In most cases, the accuracy of solutions will be
                inferior to their precision.

     NWDIST     is the number of workspace windows required by
                this routine.

     See INCLUDE file gf.inc for declarations and descriptions of
     parameters used throughout the GF system.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  In order for this routine to produce correct results,
         the step size must be appropriate for the problem at hand.
         Step sizes that are too large may cause this routine to miss
         roots; step sizes that are too small may cause this routine
         to run unacceptably slowly and in some cases, find spurious
         roots.

         This routine does not diagnose invalid step sizes, except
         that if the step size is non-positive, the error
         SPICE(INVALIDSTEP) is signaled.

     2)  Due to numerical errors, in particular,

            - Truncation error in time values
            - Finite tolerance value
            - Errors in computed geometric quantities

         it is *normal* for the condition of interest to not always be
         satisfied near the endpoints of the intervals comprising the
         result window.

         The result window may need to be contracted slightly by the
         caller to achieve desired results. The SPICE window routine
         <a href="wncond.html">WNCOND</a> can be used to contract the result window.

     3)  If an error (typically cell overflow) occurs while performing
         window arithmetic, the error will be diagnosed by a routine
         in the call tree of this routine.

     4)  If the relational operator RELATE is not recognized, an
         error is signaled by a routine in the call tree of this
         routine.

     5)  If the aberration correction specifier contains an
         unrecognized value, an error is signaled by a routine in the
         call tree of this routine

     6)  If ADJUST is negative, an error is signaled by a routine in
         the call tree of this routine.

     7)  If either of the input body names do not map to NAIF ID
         codes, an error is signaled by a routine in the call tree of
         this routine.

     8)  If required ephemerides or other kernel data are not
         available, an error is signaled by a routine in the call tree
         of this routine.

     9)  If the window size MW is less than 2, the error
         SPICE(INVALIDDIMENSION) will be signaled.

     10) If the window count NW is less than NWDIST, the error
         SPICE(INVALIDDIMENSION) will be signaled.

     11) If the output SPICE window RESULT has insufficient capacity
         to contain the number of intervals on which the specified
         distance condition is met, the error will be diagnosed
         by a routine in the call tree of this routine. If the result
         window has size less than 2, the error SPICE(INVALIDDIMENSION)
         will be signaled by this routine.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     Appropriate kernels must be loaded by the calling program before
     this routine is called.

     The following data are required:

        - SPK data: ephemeris data for target and observer for the
          time period defined by the confinement window must be
          loaded. If aberration corrections are used, the states of
          target and observer relative to the solar system barycenter
          must be calculable from the available ephemeris data.
          Typically ephemeris data are made available by loading one
          or more SPK files via <a href="furnsh.html">FURNSH</a>.

        - If non-inertial reference frames are used, then PCK
          files, frame kernels, C-kernels, and SCLK kernels may be
          needed.

     Kernel data are normally loaded once per program run, NOT every
     time this routine is called.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine determines a set of one or more time intervals
     within the confinement window when the distance between the
     specified target and observer satisfies a caller-specified
     constraint. The resulting set of intervals is returned as a SPICE
     window.

     Below we discuss in greater detail aspects of this routine's
     solution process that are relevant to correct and efficient
     use of this routine in user applications.


     The Search Process
     ==================

     Regardless of the type of constraint selected by the caller, this
     routine starts the search for solutions by determining the time
     periods, within the confinement window, over which the
     distance function is monotone increasing and monotone
     decreasing. Each of these time periods is represented by a SPICE
     window. Having found these windows, all of the range rate
     function's local extrema within the confinement window are known.
     Absolute extrema then can be found very easily.

     Within any interval of these &quot;monotone&quot; windows, there will be at
     most one solution of any equality constraint. Since the boundary
     of the solution set for any inequality constraint is contained in
     the union of

        - the set of points where an equality constraint is met
        - the boundary points of the confinement window

     the solutions of both equality and inequality constraints can be
     found easily once the monotone windows have been found.


     Step Size
     =========

     The monotone windows (described above) are found via a two-step
     search process. Each interval of the confinement window is
     searched as follows: first, the input step size is the time
     separation at which the sign of the rate of change of distance
     (&quot;range rate&quot;) is sampled. Starting at the left endpoint of the
     interval, samples will be taken at each step. If a change of sign
     is found, a root has been bracketed; at that point, the time at
     which the range rate is zero can be found by a refinement
     process, for example, via binary search.

     Note that the optimal choice of step size depends on the lengths
     of the intervals over which the distance function is monotone:
     the step size should be shorter than the shortest of these
     intervals (within the confinement window).

     The optimal step size is *not* necessarily related to the lengths
     of the intervals comprising the result window. For example, if
     the shortest monotone interval has length 10 days, and if the
     shortest result window interval has length 5 minutes, a step size
     of 9.9 days is still adequate to find all of the intervals in the
     result window. In situations like this, the technique of using
     monotone windows yields a dramatic efficiency improvement over a
     state-based search that simply tests at each step whether the
     specified constraint is satisfied. The latter type of search can
     miss solution intervals if the step size is longer than the
     shortest solution interval.

     Having some knowledge of the relative geometry of the target and
     observer can be a valuable aid in picking a reasonable step size.
     In general, the user can compensate for lack of such knowledge by
     picking a very short step size; the cost is increased computation
     time.

     Note that the step size is not related to the precision with which
     the endpoints of the intervals of the result window are computed.
     That precision level is controlled by the convergence tolerance.


     Convergence Tolerance
     =====================

     As described above, the root-finding process used by this routine
     involves first bracketing roots and then using a search process
     to locate them. &quot;Roots&quot; include times when extrema are attained
     and times when the distance function is equal to a reference
     value or adjusted extremum. All endpoints of the intervals
     comprising the result window are either endpoints of intervals of
     the confinement window or roots.

     Once a root has been bracketed, a refinement process is used to
     narrow down the time interval within which the root must lie.
     This refinement process terminates when the location of the root
     has been determined to within an error margin called the
     &quot;convergence tolerance.&quot; The default convergence tolerance
     used by this routine is set by the parameter CNVTOL (defined
     in gf.inc).

     The value of CNVTOL is set to a &quot;tight&quot; value so that the
     tolerance doesn't become the limiting factor in the accuracy of
     solutions found by this routine. In general the accuracy of input
     data will be the limiting factor.

     The user may change the convergence tolerance from the default
     CNVTOL value by calling the routine <a href="gfstol.html">GFSTOL</a>, e.g.

        CALL <a href="gfstol.html">GFSTOL</a>( tolerance value )

     Call <a href="gfstol.html">GFSTOL</a> prior to calling this routine. All subsequent
     searches will use the updated tolerance value.

     Setting the tolerance tighter than CNVTOL is unlikely to be
     useful, since the results are unlikely to be more accurate.
     Making the tolerance looser will speed up searches somewhat,
     since a few convergence steps will be omitted. However, in most
     cases, the step size is likely to have a much greater effect
     on processing time than would the convergence tolerance.


     The Confinement Window
     ======================

     The simplest use of the confinement window is to specify a time
     interval within which a solution is sought. However, the
     confinement window can, in some cases, be used to make searches
     more efficient. Sometimes it's possible to do an efficient search
     to reduce the size of the time period over which a relatively
     slow search of interest must be performed. See the &quot;CASCADE&quot;
     example program in gf.req for a demonstration.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for these examples may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine
     specific arithmetic implementation.


     1) Find times during the first three months of the year 2007 when
        the geometric Earth-Moon distance is greater than 400000 km.
        Display the start and stop times of the time intervals over
        which this constraint is met, along with the Earth-Moon
        distance at each interval endpoint.

        We expect the Earth-Moon distance to be an oscillatory
        function with extrema roughly two weeks apart. Using
        a step size of one day guarantees that the GF system
        won't fail to find any distance extrema. (Recall that a
        search for distance extrema is an intermediate step
        in the GF search process.)

        Use the meta-kernel shown below to load the required SPICE
        kernels.


           KPL/MK

           File name: <a href= "standard.html">standard.tm</a>

           This meta-kernel is intended to support operation of SPICE
           example programs. The kernels shown here should not be
           assumed to contain adequate or correct versions of data
           required by SPICE-based user applications.

           In order for an application to use this meta-kernel, the
           kernels referenced here must be present in the user's
           current working directory.

           The names and contents of the kernels referenced
           by this meta-kernel are as follows:

              File name                     Contents
              ---------                     --------
              de421.bsp                     Planetary ephemeris
              pck00008.tpc                  Planet orientation and
                                            radii
              naif0009.tls                  Leapseconds


           \begindata

              KERNELS_TO_LOAD = ( 'de421.bsp',
                                  'pck00008.tpc',
                                  'naif0009.tls'  )

           \begintext

           End of meta-kernel



        Example code begins here.


           PROGRAM EX1
           IMPLICIT NONE
     C
     C     Include GF parameter declarations:
     C
           INCLUDE 'gf.inc'
     C
     C     SPICELIB functions
     C
           DOUBLE PRECISION      <a href="spd.html">SPD</a>
           DOUBLE PRECISION      <a href="vnorm.html">VNORM</a>
           INTEGER               <a href="wncard.html">WNCARD</a>
     C
     C     Local parameters
     C
           INTEGER               LBCELL
           PARAMETER           ( LBCELL = -5 )
     C
     C     Use the parameter MAXWIN for both
     C     the result window size and the workspace
     C     size.
     C
           INTEGER               MAXWIN
           PARAMETER           ( MAXWIN = 20000 )
     C
     C     Length of output time string:
     C
           INTEGER               TIMLEN
           PARAMETER           ( TIMLEN = 26 )
     C
     C     Local variables
     C
           CHARACTER*(TIMLEN)    TIMSTR

           DOUBLE PRECISION      ADJUST
           DOUBLE PRECISION      CNFINE ( LBCELL : 2 )
           DOUBLE PRECISION      DIST
           DOUBLE PRECISION      ET0
           DOUBLE PRECISION      ET1
           DOUBLE PRECISION      FINISH
           DOUBLE PRECISION      LT
           DOUBLE PRECISION      POS    ( 3 )
           DOUBLE PRECISION      REFVAL
           DOUBLE PRECISION      RESULT ( LBCELL : MAXWIN )
           DOUBLE PRECISION      START
           DOUBLE PRECISION      STEP
           DOUBLE PRECISION      WORK   ( LBCELL : MAXWIN, NWDIST )

           INTEGER               I

     C
     C     Load kernels.
     C
           CALL <a href="furnsh.html">FURNSH</a> ( '<a href= "standard.html">standard.tm</a>' )
     C
     C     Initialize windows.
     C
           CALL <a href="ssized.html">SSIZED</a> ( MAXWIN, RESULT )
           CALL <a href="ssized.html">SSIZED</a> ( 2,      CNFINE )
     C
     C     Store the time bounds of our search interval in
     C     the confinement window.
     C
           CALL <a href="str2et.html">STR2ET</a> ( '2007 JAN 1', ET0 )
           CALL <a href="str2et.html">STR2ET</a> ( '2007 APR 1', ET1 )

           CALL <a href="wninsd.html">WNINSD</a> ( ET0, ET1, CNFINE )
     C
     C     Search using a step size of 1 day (in units of
     C     seconds). The reference value is 450000 km.
     C     We're not using the adjustment feature, so
     C     we set ADJUST to zero.
     C
           STEP   = <a href="spd.html">SPD</a>()
           REFVAL = 4.D5
           ADJUST = 0.D0

     C
     C     Perform the search. The set of times when the
     C     constraint is met will be stored in the SPICE
     C     window RESULT.
     C
           CALL <b>GFDIST</b> ( 'MOON', 'NONE', 'EARTH', '&gt;',
          .              REFVAL, ADJUST, STEP,    CNFINE,
          .              MAXWIN, NWDIST, WORK,    RESULT )
     C
     C     Display the results.
     C
           IF ( <a href="wncard.html">WNCARD</a>(RESULT) .EQ. 0 ) THEN
              WRITE (*, '(A)') 'Result window is empty.'
           ELSE
              DO I = 1, <a href="wncard.html">WNCARD</a>(RESULT)
     C
     C           Fetch the endpoints of the Ith interval
     C           of the result window.
     C
                 CALL <a href="wnfetd.html">WNFETD</a> ( RESULT, I, START, FINISH )
     C
     C           Check the distance at the start and stop times.
     C
                 CALL <a href="spkpos.html">SPKPOS</a> ( 'MOON',  START, 'J2000', 'NONE',
          .                    'EARTH', POS,   LT              )
                 DIST = <a href="vnorm.html">VNORM</a>(POS)

                 CALL <a href="timout.html">TIMOUT</a> ( START, 'YYYY-MON-DD HR:MN:SC.###',
          .                    TIMSTR                            )

                 WRITE (*, '(A,F16.9)' ) 'Start time, distance = '//
          .                              TIMSTR, DIST

                 CALL <a href="spkpos.html">SPKPOS</a> ( 'MOON',  FINISH, 'J2000', 'NONE',
          .                    'EARTH', POS,     LT              )
                 DIST = <a href="vnorm.html">VNORM</a>(POS)

                 CALL <a href="timout.html">TIMOUT</a> ( FINISH, 'YYYY-MON-DD HR:MN:SC.###',
          .                    TIMSTR                            )

                 WRITE (*, '(A,F16.9)' ) 'Stop time,  distance = '//
          .                              TIMSTR, DIST
              END DO

           END IF
           END



        When this program was executed on a PC/Linux/g77 platform, the
        output was:


    Start time, distance = 2007-JAN-08 00:10:02.439  399999.999999989
    Stop time,  distance = 2007-JAN-13 06:36:42.770  400000.000000010
    Start time, distance = 2007-FEB-04 07:01:30.094  399999.999999990
    Stop time,  distance = 2007-FEB-10 09:29:56.659  399999.999999998
    Start time, distance = 2007-MAR-03 00:19:19.998  400000.000000006
    Stop time,  distance = 2007-MAR-10 14:03:33.312  400000.000000007
    Start time, distance = 2007-MAR-29 22:52:52.961  399999.999999995
    Stop time,  distance = 2007-APR-01 00:00:00.000  404531.955232216

        Note that at the final solutions interval's stop time is not
        close to the reference value of 400000 km. This is because the
        interval's stop time was determined by the stop time of the
        confinement window.



     2) Extend the first example to demonstrate use of all supported
        relational operators. Find times when

           Earth-Moon distance is = 400000 km
           Earth-Moon distance is &lt; 400000 km
           Earth-Moon distance is &gt; 400000 km
           Earth-Moon distance is at a local minimum
           Earth-Moon distance is at a absolute minimum
           Earth-Moon distance is &gt; the absolute minimum + 100 km
           Earth-Moon distance is at a local maximum
           Earth-Moon distance is at a absolute maximum
           Earth-Moon distance is &gt; the absolute maximum - 100 km

        To shorten the search time and output, use the
        shorter search interval

           2007 JAN 15 00:00:00 UTC  to
           2007 MAR 15 00:00:00 UTC

        As before, use geometric (uncorrected) positions, so
        set the aberration correction flag to 'NONE'.

        Use the meta-kernel from the first example.


        Example code begins here.


           PROGRAM EX2
           IMPLICIT NONE
     C
     C     Include GF parameter declarations:
     C
           INCLUDE 'gf.inc'
     C
     C     SPICELIB functions
     C
           DOUBLE PRECISION      <a href="spd.html">SPD</a>
           DOUBLE PRECISION      <a href="vnorm.html">VNORM</a>
           INTEGER               <a href="wncard.html">WNCARD</a>
     C
     C     Local parameters
     C
           INTEGER               LBCELL
           PARAMETER           ( LBCELL = -5 )
     C
     C     Use the parameter MAXWIN for both
     C     the result window size and the workspace
     C     size.
     C
           INTEGER               MAXWIN
           PARAMETER           ( MAXWIN = 20000 )
     C
     C     Length of output time string:
     C
           INTEGER               TIMLEN
           PARAMETER           ( TIMLEN = 26 )

     C
     C     Number of relational operators:
     C
           INTEGER               NRELOP
           PARAMETER           ( NRELOP = 9 )

     C
     C     Operator name length:
     C
           INTEGER               OPNMLN
           PARAMETER           ( OPNMLN = 6 )

     C
     C     Output line length:
     C
           INTEGER               LNSIZE
           PARAMETER           ( LNSIZE = 80 )

     C
     C     Local variables
     C
           CHARACTER*(OPNMLN)    RELATE ( NRELOP )
           CHARACTER*(LNSIZE)    TEMPLT ( NRELOP )
           CHARACTER*(TIMLEN)    TIMSTR
           CHARACTER*(LNSIZE)    TITLE

           DOUBLE PRECISION      ADJUST ( NRELOP )
           DOUBLE PRECISION      CNFINE ( LBCELL : 2 )
           DOUBLE PRECISION      DIST
           DOUBLE PRECISION      ET0
           DOUBLE PRECISION      ET1
           DOUBLE PRECISION      FINISH
           DOUBLE PRECISION      LT
           DOUBLE PRECISION      POS    ( 3 )
           DOUBLE PRECISION      REFVAL
           DOUBLE PRECISION      RESULT ( LBCELL : MAXWIN )
           DOUBLE PRECISION      START
           DOUBLE PRECISION      STEP
           DOUBLE PRECISION      WORK   ( LBCELL : MAXWIN, NWDIST )

           INTEGER               I
           INTEGER               J

     C
     C     Saved variables
     C
           SAVE                  ADJUST
           SAVE                  RELATE
           SAVE                  TEMPLT

     C
     C     Initial values
     C
           DATA                  ADJUST / 0.D0,
          .                               0.D0,
          .                               0.D0,
          .                               0.D0,
          .                               0.D0,
          .                               100.D0,
          .                               0.D0,
          .                               0.D0,
          .                               100.D0 /

           DATA                  RELATE / '=',
          .                               '&lt;',
          .                               '&gt;',
          .                               'LOCMIN',
          .                               'ABSMIN',
          .                               'ABSMIN',
          .                               'LOCMAX',
          .                               'ABSMAX',
          .                               'ABSMAX'  /

           DATA                  TEMPLT /
          .      'Condition: distance = # km',
          .      'Condition: distance &lt; # km',
          .      'Condition: distance &gt; # km',
          .      'Condition: distance is a local minimum',
          .      'Condition: distance is the absolute minimum',
          .      'Condition: distance &lt; the absolute minimum + * km',
          .      'Condition: distance is a local maximum',
          .      'Condition: distance is the absolute maximum',
          .      'Condition: distance &gt; the absolute maximum - * km' /

     C
     C     Load kernels.
     C
           CALL <a href="furnsh.html">FURNSH</a> ( '<a href= "standard.html">standard.tm</a>' )
     C
     C     Initialize windows.
     C
           CALL <a href="ssized.html">SSIZED</a> ( MAXWIN, RESULT )
           CALL <a href="ssized.html">SSIZED</a> ( 2,      CNFINE )
     C
     C     Store the time bounds of our search interval in
     C     the confinement window.
     C
           CALL <a href="str2et.html">STR2ET</a> ( '2007 JAN 15', ET0 )
           CALL <a href="str2et.html">STR2ET</a> ( '2007 MAR 15', ET1 )

           CALL <a href="wninsd.html">WNINSD</a> ( ET0, ET1, CNFINE )

     C
     C     Search using a step size of 1 day (in units of
     C     seconds). Use a reference value of 400000 km.
     C
           STEP   = <a href="spd.html">SPD</a>()
           REFVAL = 4.D5

           DO I = 1, NRELOP

              CALL <b>GFDIST</b> ( 'MOON', 'NONE',    'EARTH', RELATE(I),
          .                 REFVAL, ADJUST(I), STEP,    CNFINE,
          .                 MAXWIN, NWDIST,    WORK,    RESULT    )
     C
     C        Display the results.
     C
              WRITE (*,*) ' '

     C
     C        Substitute the reference and adjustment values,
     C        where applicable, into the title string:
     C
              CALL <a href="repmd.html">REPMD</a> ( TEMPLT(I), '#', REFVAL,    6, TITLE )
              CALL <a href="repmd.html">REPMD</a> ( TITLE,     '*', ADJUST(I), 6, TITLE )

              WRITE (*, '(A)' ) TITLE

              IF ( <a href="wncard.html">WNCARD</a>(RESULT) .EQ. 0 ) THEN
                 WRITE (*, '(A)' ) ' Result window is empty.'
              ELSE
                 WRITE (*, '(A)' ) ' Result window:'

                 DO J = 1, <a href="wncard.html">WNCARD</a>(RESULT)
     C
     C              Fetch the endpoints of the Jth interval
     C              of the result window.
     C
                    CALL <a href="wnfetd.html">WNFETD</a> ( RESULT, J, START, FINISH )
     C
     C              Check the distance at the start and stop times.
     C
                    CALL <a href="spkpos.html">SPKPOS</a> ( 'MOON',  START, 'J2000', 'NONE',
          .                       'EARTH', POS,   LT              )
                    DIST = <a href="vnorm.html">VNORM</a>(POS)

                    CALL <a href="timout.html">TIMOUT</a> ( START, 'YYYY-MON-DD HR:MN:SC.###',
          .                       TIMSTR                            )

                    WRITE (*, '(A,F16.9)' ) '  Start time, distance = '
          .         //                      TIMSTR, DIST

                    CALL <a href="spkpos.html">SPKPOS</a> ( 'MOON',  FINISH, 'J2000', 'NONE',
          .                       'EARTH', POS,     LT              )
                    DIST = <a href="vnorm.html">VNORM</a>(POS)

                    CALL <a href="timout.html">TIMOUT</a> ( FINISH, 'YYYY-MON-DD HR:MN:SC.###',
          .                       TIMSTR                            )

                    WRITE (*, '(A,F16.9)' ) '  Stop time,  distance = '
          .         //                      TIMSTR, DIST
                 END DO

              END IF

           END DO

           WRITE (*,*) ' '

           END


        When this program was executed on a PC/Linux/g77 platform, the
        output was:


    Condition: distance = 4.00000E+05 km
     Result window:
      Start time, distance = 2007-FEB-04 07:01:30.094  399999.999999998
      Stop time,  distance = 2007-FEB-04 07:01:30.094  399999.999999998
      Start time, distance = 2007-FEB-10 09:29:56.659  399999.999999989
      Stop time,  distance = 2007-FEB-10 09:29:56.659  399999.999999989
      Start time, distance = 2007-MAR-03 00:19:19.998  399999.999999994
      Stop time,  distance = 2007-MAR-03 00:19:19.998  399999.999999994
      Start time, distance = 2007-MAR-10 14:03:33.312  400000.000000000
      Stop time,  distance = 2007-MAR-10 14:03:33.312  400000.000000000

    Condition: distance &lt; 4.00000E+05 km
     Result window:
      Start time, distance = 2007-JAN-15 00:00:00.000  393018.609906208
      Stop time,  distance = 2007-FEB-04 07:01:30.094  399999.999999990
      Start time, distance = 2007-FEB-10 09:29:56.659  399999.999999998
      Stop time,  distance = 2007-MAR-03 00:19:19.998  400000.000000006
      Start time, distance = 2007-MAR-10 14:03:33.312  400000.000000010
      Stop time,  distance = 2007-MAR-15 00:00:00.000  376255.453934464

    Condition: distance &gt; 4.00000E+05 km
     Result window:
      Start time, distance = 2007-FEB-04 07:01:30.094  399999.999999990
      Stop time,  distance = 2007-FEB-10 09:29:56.659  399999.999999998
      Start time, distance = 2007-MAR-03 00:19:19.998  400000.000000006
      Stop time,  distance = 2007-MAR-10 14:03:33.312  400000.000000010

    Condition: distance is a local minimum
     Result window:
      Start time, distance = 2007-JAN-22 12:30:49.458  366925.804109350
      Stop time,  distance = 2007-JAN-22 12:30:49.458  366925.804109350
      Start time, distance = 2007-FEB-19 09:36:29.968  361435.646812061
      Stop time,  distance = 2007-FEB-19 09:36:29.968  361435.646812061

    Condition: distance is the absolute minimum
     Result window:
      Start time, distance = 2007-FEB-19 09:36:29.968  361435.646812061
      Stop time,  distance = 2007-FEB-19 09:36:29.968  361435.646812061

    Condition: distance &lt; the absolute minimum + 1.00000E+02 km
     Result window:
      Start time, distance = 2007-FEB-19 01:09:52.706  361535.646812062
      Stop time,  distance = 2007-FEB-19 18:07:45.136  361535.646812061

    Condition: distance is a local maximum
     Result window:
      Start time, distance = 2007-FEB-07 12:38:29.870  404992.424288620
      Stop time,  distance = 2007-FEB-07 12:38:29.870  404992.424288620
      Start time, distance = 2007-MAR-07 03:37:02.122  405853.452130754
      Stop time,  distance = 2007-MAR-07 03:37:02.122  405853.452130754

    Condition: distance is the absolute maximum
     Result window:
      Start time, distance = 2007-MAR-07 03:37:02.122  405853.452130754
      Stop time,  distance = 2007-MAR-07 03:37:02.122  405853.452130754

    Condition: distance &gt; the absolute maximum - 1.00000E+02 km
     Result window:
      Start time, distance = 2007-MAR-06 15:56:00.957  405753.452130753
      Stop time,  distance = 2007-MAR-07 15:00:38.674  405753.452130753
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     1) The kernel files to be used by this routine must be loaded
        (normally via the SPICELIB routine <a href="furnsh.html">FURNSH</a>) before this routine
        is called.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman   (JPL)
     E.D. Wright    (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.1.0, 05-SEP-2012 (EDW)

        Edit to comments to correct search description.

        Implemented use of ZZHOLDD to allow user to alter convergence
        tolerance.

        Removed the STEP &gt; 0 error check. The <a href="gfsstp.html">GFSSTP</a> call includes
        the check.

    SPICELIB Version 1.0.0, 15-APR-2009 (NJB) (EDW)</PRE>
<h4>Link to routine GFDIST source file <a href='../../../src/spicelib/gfdist.f'>gfdist.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Tue Jul 15 14:24:24 2014</pre>

</body>
</html>

