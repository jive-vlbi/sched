
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>inrypl</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>inrypl</b> </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">

<small><div align="center">
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div></small>
       <br>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
            <small>
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Examples">Examples<br></a>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
             </small>
            </td>
          </tr>
        </tbody>
</table>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
      INRYPL ( Intersection of ray and plane )
 
      SUBROUTINE INRYPL ( VERTEX, DIR, PLANE, NXPTS, XPT )
 
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Find the intersection of a ray and a plane.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/planes.html">PLANES</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     GEOMETRY
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
 
      INTEGER               UBPL
      PARAMETER           ( UBPL    =   4 )
 
      DOUBLE PRECISION      VERTEX (    3 )
      DOUBLE PRECISION      DIR    (    3 )
      DOUBLE PRECISION      PLANE  ( UBPL )
      INTEGER               NXPTS
      DOUBLE PRECISION      XPT    (    3 )
 
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     Variable  I/O  Description
     --------  ---  --------------------------------------------------
     VERTEX,
     DIR        I   Vertex and direction vector of ray.
     PLANE      I   A SPICELIB plane.
     NXPTS      O   Number of intersection points of ray and plane.
     XPT        O   Intersection point, if NXPTS = 1.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     VERTEX,
     DIR            are a point and direction vector that define a
                    ray in three-dimensional space.

     PLANE          is a SPICELIB plane.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     NXPTS          is the number of points of intersection of the
                    input ray and plane.  Values and meanings of
                    NXPTS are:

                       0     No intersection.

                       1     One point of intersection.  Note that
                             this case may occur when the ray's
                             vertex is in the plane.

                      -1     An infinite number of points of
                             intersection; the ray lies in the plane.


     XPT            is the point of intersection of the input ray
                    and plane, when there is exactly one point of
                    intersection.  Otherwise, XPT is the zero vector.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  If the ray's direction vector is the zero vector, the error
         SPICE(ZEROVECTOR) is signaled.  NXPTS and XPT are not
         modified.


     2)  If the ray's vertex is further than DPMAX() / 3 from the
         origin, the error SPICE(VECTORTOOBIG) is signaled.  NXPTS
         and XPT are not modified.


     3)  If the input plane is s further than DPMAX() / 3 from the
         origin, the error SPICE(VECTORTOOBIG) is signaled.  NXPTS
         and XPT are not modified.


     4)  The input plane should be created by one of the SPICELIB
         routines

            <a href="nvc2pl.html">NVC2PL</a>
            <a href="nvp2pl.html">NVP2PL</a>
            <a href="psv2pl.html">PSV2PL</a>

         Invalid input planes will cause unpredictable results.


     5)  In the interest of good numerical behavior, in the case
         where the ray's vertex is not in the plane, this routine
         considers that an intersection of the ray and plane occurs
         only if the distance between the ray's vertex and the
         intersection point is less than DPMAX() / 3.

         If VERTEX is not in the plane and this condition is not
         met, then NXPTS is set to 0 and XPT is set to the zero
         vector.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     The intersection of a ray and plane in three-dimensional space
     can be a the empty set, a single point, or the ray itself.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     1)  Find the camera projection of the center of an extended
         body.  For simplicity, we assume:

            -- The camera has no distortion;  the image of a point
               is determined by the intersection of the focal plane
               and the line determined by the point and the camera's
               focal point.

            -- The camera's pointing matrix (C-matrix) is available
               in a C-kernel.


            C
            C     Load Leapseconds and SCLK kernels to support time
            C     conversion.
            C
                  CALL <a href="furnsh.html">FURNSH</a> ( 'LEAP.KER' )
                  CALL <a href="furnsh.html">FURNSH</a> ( 'SCLK.KER' )

            C
            C     Load an SPK file containing ephemeris data for
            C     observer (a spacecraft, whose NAIF integer code
            C     is SC) and target at the UTC epoch of observation.
            C
                  CALL <a href="furnsh.html">FURNSH</a> ( 'SPK.BSP' )

            C
            C     Load a C-kernel containing camera pointing for
            C     the UTC epoch of observation.
            C
                  CALL <a href="furnsh.html">FURNSH</a> ( 'CK.BC' )

            C
            C     Find the ephemeris time (barycentric dynamical time)
            C     and encoded spacecraft clock times corresponding to
            C     the UTC epoch of observation.
            C
                  CALL <a href="utc2et.html">UTC2ET</a> ( UTC, ET          )
                  CALL <a href="sce2c.html">SCE2C</a>  ( SC,  ET,  SCLKDP )

            C
            C     Encode the pointing lookup tolerance.
            C
                  CALL <a href="sctiks.html">SCTIKS</a> ( SC, TOLCH,  TOLDP  )

            C
            C     Find the observer-target vector at the observation
            C     epoch.  In this example, we'll use a light-time
            C     corrected state vector.
            C
                  CALL <a href="spkez.html">SPKEZ</a> ( TARGET,  ET,  'J2000',  'LT',  SC,
                 .             STATE,   LT                        )

            C
            C     Look up camera pointing.
            C
                  CALL <a href="ckgp.html">CKGP</a>  ( CAMERA, SCLKDP, TOLDP, 'J2000', CMAT,
                 .             CLKOUT, FOUND                        )
            
                  IF ( .NOT. FOUND ) THEN

                     [Handle this case...]
 
                  END IF

            C
            C     Negate the spacecraft-to-target body vector and
            C     convert it to camera coordinates.
            C
                  CALL <a href="vminus.html">VMINUS</a> ( STATE, DIR       )
                  CALL <a href="mxv.html">MXV</a>    ( CMAT,  DIR,  DIR )

            C
            C     If FL is the camera's focal length, the effective
            C     focal point is
            C
            C        FL * ( 0, 0, 1 )
            C
                  CALL <a href="vscl.html">VSCL</a> ( FL, ZVEC, FOCUS )

            C
            C     The camera's focal plane contains the origin in
            C     camera coordinates, and the z-vector is orthogonal
            C     to the plane.  Make a SPICELIB plane representing
            C     the focal plane.
            C
                  CALL <a href="nvc2pl.html">NVC2PL</a> ( ZVEC, 0.D0, FPLANE )

            C
            C     The image of the target body's center in the focal
            C     plane is defined by the intersection with the focal
            C     plane of the ray whose vertex is the focal point and
            C     whose direction is DIR.
            C
                  CALL <b>INRYPL</b> ( FOCUS, DIR, FPLANE, NXPTS, IMAGE )

                  IF ( NXPTS .EQ. 1 ) THEN
            C
            C        The body center does project to the focal plane.
            C        Check whether the image is actually in the
            C        camera's field of view...
            C
                               .
                               .
                               .
                  ELSE

            C
            C        The body center does not map to the focal plane.
            C        Handle this case...
            C
                               .
                               .
                               .
                  END IF



     2)  Find the Saturn ring plane intercept of a spacecraft-mounted
         instrument's boresight vector.  We want the find the point
         in the ring plane that will be observed by an instrument
         with a give boresight direction at a specified time.  We
         must account for light time and stellar aberration in order
         to find this point.  The intercept point will be expressed
         in Saturn body-fixed coordinates.
          
         In this example, we assume

            -- The ring plane is equatorial.

            -- Light travels in a straight line.

            -- The light time correction for the ring plane intercept
               can be obtained by performing three light-time
               correction iterations.  If this assumption does not
               lead to a sufficiently accurate result, additional
               iterations can be performed.

            -- A Newtonian approximation of stellar aberration
               suffices.

            -- The boresight vector is given in J2000 coordinates.

            -- The observation epoch is ET ephemeris seconds past
               J2000.

            -- The boresight vector, spacecraft and planetary
               ephemerides, and ring plane orientation are all known
               with sufficient accuracy for the application.

            -- All necessary kernels are loaded by the caller of
               this example routine.


            SUBROUTINE RING_XPT ( SC, ET, BORVEC, SBFXPT, FOUND )
            IMPLICIT NONE

            CHARACTER*(*)         SC
            DOUBLE PRECISION      ET
            DOUBLE PRECISION      BORVEC ( 3 )
            DOUBLE PRECISION      SBFXPT ( 3 )
            LOGICAL               FOUND

      C
      C     SPICELIB functions
      C
            DOUBLE PRECISION      <a href="clight.html">CLIGHT</a>
            DOUBLE PRECISION      <a href="vdist.html">VDIST</a>

      C
      C     Local parameters
      C
            INTEGER               UBPL
            PARAMETER           ( UBPL = 4 )

            INTEGER               SATURN
            PARAMETER           ( SATURN = 699 )

      C
      C     Local variables
      C
            DOUBLE PRECISION      BORV2  ( 3 )
            DOUBLE PRECISION      CORVEC ( 3 )
            DOUBLE PRECISION      LT
            DOUBLE PRECISION      PLANE  ( UBPL )
            DOUBLE PRECISION      SATSSB ( 6 )
            DOUBLE PRECISION      SCPOS  ( 3 )
            DOUBLE PRECISION      SCSSB  ( 6 )
            DOUBLE PRECISION      STATE  ( 6 )
            DOUBLE PRECISION      STCORR ( 3 )
            DOUBLE PRECISION      TAU
            DOUBLE PRECISION      TPMI   ( 3,  3 )
            DOUBLE PRECISION      XPT    ( 3 )
            DOUBLE PRECISION      ZVEC   ( 3 )

            INTEGER               I
            INTEGER               NXPTS
            INTEGER               SCID

            LOGICAL               FND

      C
      C     First step:  account for stellar aberration.  Since the
      C     instrument pointing is given, we need to find the intercept
      C     point such that, when the stellar aberration correction is
      C     applied to the vector from the spacecraft to that point,
      C     the resulting vector is parallel to BORVEC.  An easy 
      C     solution is to apply the inverse of the normal stellar 
      C     aberration correction to BORVEC, and then solve the 
      C     intercept problem with this corrected boresight vector.
      C
      C     Find the position of the observer relative
      C     to the solar system barycenter at ET.
      C
            CALL <a href="bodn2c.html">BODN2C</a> ( SC, SCID, FND )

            IF ( .NOT. FND ) THEN

               CALL <a href="setmsg.html">SETMSG</a> ( 'ID code for body # was not found.' )
               CALL <a href="errch.html">ERRCH</a>  ( '#',  SC                            )
               CALL <a href="sigerr.html">SIGERR</a> ( 'SPICE(NOTRANSLATION'               )
               RETURN

            END IF

            CALL <a href="spkssb.html">SPKSSB</a> ( SCID, ET, 'J2000', SCSSB )

      C
      C     We now wish to find the vector CORVEC that, when 
      C     corrected for stellar aberration, yields BORVEC.  
      C     A good first approximation is obtained by applying 
      C     the stellar aberration correction for transmission 
      C     to BORVEC.
      C
            CALL <a href="stlabx.html">STLABX</a> ( BORVEC, SCSSB(4), CORVEC )

      C
      C     The inverse of the stellar aberration correction
      C     applicable to CORVEC should be a very good estimate of
      C     the correction we need to apply to BORVEC.  Apply
      C     this correction to BORVEC to obtain an improved estimate
      C     of CORVEC.
      C
            CALL <a href="stelab.html">STELAB</a> ( CORVEC, SCSSB(4), BORV2  )
            CALL <a href="vsub.html">VSUB</a>   ( BORV2,  CORVEC,   STCORR )
            CALL <a href="vsub.html">VSUB</a>   ( BORVEC, STCORR,   CORVEC )

      C
      C     Because the ring plane intercept may be quite far from
      C     Saturn's center, we cannot assume light time from the 
      C     intercept to the observer is well approximated by 
      C     light time from Saturn's center to the observer.  
      C     We compute the light time explicitly using an iterative 
      C     approach.
      C
      C     We can however use the light time from Saturn's center to
      C     the observer to obtain a first estimate of the actual light
      C     time.
      C
            CALL <a href="spkezr.html">SPKEZR</a> ( 'SATURN', ET, 'J2000', 'LT', SC,
           .               STATE,   LT                       )
            TAU = LT

      C
      C     Find the ring plane intercept and calculate the
      C     light time from it to the spacecraft.
      C     Perform three iterations.
      C
            I     = 1
            FOUND = .TRUE.

            DO WHILE (  ( I .LE. 3 )  .AND.  ( FOUND )  )
      C
      C        Find the position of Saturn relative
      C        to the solar system barycenter at ET-TAU.
      C
               CALL <a href="spkssb.html">SPKSSB</a> ( SATURN, ET-TAU, 'J2000', SATSSB )

      C
      C        Find the Saturn-to-observer vector defined by these
      C        two position vectors.
      C
               CALL <a href="vsub.html">VSUB</a> ( SCSSB, SATSSB, SCPOS )

      C
      C        Look up Saturn's pole at ET-TAU; this is the third
      C        column of the matrix that transforms Saturn body-fixed
      C        coordinates to J2000 coordinates.
      C
               CALL <a href="pxform.html">PXFORM</a> ( 'IAU_SATURN', 'J2000', ET-TAU, TPMI )

               CALL MOVED  ( TPMI(1,3), 3, ZVEC )

      C
      C        Make a SPICELIB plane representing the ring plane.
      C        We're treating Saturn's center as the origin, so
      C        the plane constant is 0.
      C
               CALL <a href="nvc2pl.html">NVC2PL</a> ( ZVEC, 0.D0, PLANE )

      C
      C        Find the intersection of the ring plane and the
      C        ray having vertex SCPOS and direction vector
      C        CORVEC.
      C
               CALL <b>INRYPL</b> ( SCPOS, CORVEC, PLANE, NXPTS, XPT )

      C
      C        If the number of intersection points is 1,
      C        find the next light time estimate.
      C
               IF ( NXPTS .EQ. 1 ) THEN
      C
      C           Find the light time (zero-order) from the
      C           intercept point to the spacecraft.
      C
                  TAU  =  <a href="vdist.html">VDIST</a> ( SCPOS, XPT )  /  <a href="clight.html">CLIGHT</a>()
                  I    =  I + 1

               ELSE

                  FOUND = .FALSE.

               END IF

            END DO

      C
      C     At this point, if FOUND is .TRUE., we iterated
      C     3 times, and XPT is our estimate of the
      C     position of the ring plane intercept point
      C     relative to Saturn in the J2000 frame.  This is the
      C     point observed by an instrument pointed in direction
      C     BORVEC at ET at mounted on the spacecraft SC.
      C
      C     If FOUND is .FALSE., the boresight ray does not
      C     intersect the ring plane.
      C
      C     As a final step, transform XPT to Saturn body-fixed
      C     coordinates.
      C
            IF ( FOUND ) THEN

               CALL <a href="mtxv.html">MTXV</a> ( TPMI, XPT, SBFXPT )

            END IF

            END
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman   (JPL)
     W.L. Taber     (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.1.1, 07-FEB-2008 (BVS)

        Fixed a few typos in the header.

    SPICELIB Version 1.1.0, 02-SEP-2005 (NJB)

        Updated to remove non-standard use of duplicate arguments
        in <a href="vscl.html">VSCL</a> call.

    SPICELIB Version 1.0.3, 12-DEC-2002 (NJB)

        Header fix:  ring plane intercept algorithm was corrected. 
        Now light time is computed accurately, and stellar aberration 
        is accounted for.  Example was turned into a complete
        subroutine.

    SPICELIB Version 1.0.2, 09-MAR-1999 (NJB)

        Reference to <a href="sce2t.html">SCE2T</a> replaced by reference to <a href="sce2c.html">SCE2C</a>.  An 
        occurrence of ENDIF was replaced by END IF.

    SPICELIB Version 1.0.1, 10-MAR-1992 (WLT)

        Comment section for permuted index source lines was added
        following the header.

    SPICELIB Version 1.0.0, 01-APR-1991 (NJB) (WLT)</PRE>
<h4>Link to routine INRYPL source file <a href='../../../src/spicelib/inrypl.f'>inrypl.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Tue Jul 15 14:24:28 2014</pre>

</body>
</html>

