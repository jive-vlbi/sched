
**********************  Get PLFLOD into Franco's system!
  Copy in src as plflod.f.rcw
 I sent it to him


Instructions for making a release of SCHED

Before a release:

1.  Get the latest versions of the Vex and plot code from 
    Cormac and Franco.

2.  Make sure VERSION and VERNUM in versched.f are up to date.
    Make sure the version on the manual first page are current.

    Set the NEWVER in the window where this work is being done so
    that script segments below can be used with a cut-and-paste
    Also check a couple of places below (other machines) where the
    version number is also needed.

setenv NEWVER 6.05
setenv DIST /users/cwalker/files/sched_{$NEWVER}
setenv SCHTEST /users/cwalker/files/sched_test

3.  Compile and link SCHED on the development machine.

    Use one of the scripts to invoke make with the premade makefiles.
    MakeSpice to include satellite stuff.  Leaves Makefile pointing
          to the non-satellite version.
    MakeLinux omits satellite stuff
    MakeSun makes the sun version
    MakeMacOSX makes the OSX version.
    
    Do not use the form "make -f Makefile.linux.spice".  During 
    execution of make, make is again invoked without -f and you 
    will get whatever "Makefile" points to for the final link.

4.  Update the manual and the web version:

5.  Write a release note.  This will be mainly a link to the manual
    update section.

6.  Check the README and README.ftp files in $SCHED.



Prepare the manual:

1.  Update the examples embedded in the manual.  You can use the 
    following lines as a script.
    inserttex is in $SCHED/RELATED_CODE/INSERTTEX if it is not in path.

cd $SCHED/doc
/bin/rm sched.tex.tmp
mv sched.tex sched.tex.tmp
inserttex 
sched.tex.tmp
sched.tex
 
2.  Process the manual.  latex will probably need to be run up to
    3 times to get all the links right.
    The local icons switch keeps users from having to go to
    NRAO for the up etc buttons.
    The -link option controls how deep the automatic contents pages
    go at each level.  Without it, the contents on the top level
    page are long enought to frighten off users.

latex sched.tex
latex2html -local_icons -link 2 sched.tex



Update the setup files:

cd $SCHED/setups
makesetup



Update the catalogs from the masters.
Update updates the stations, freq, and messages files for which
the masters are in subdirectories.

cd $SCHED/catalogs
Update

Hand update source and locations files if there has been an
update to the correlator data base.  Update the VERSIONs in 
those catalogs.



Update the examples and clean up the area.
   Check that testruns.out shows a clean comparison after Verify.

cd $SCHED/examples
Verify
Newstd
schclean "*"



Test the plot functions on egplan.key.  Verify does not make plots.
    Do this at some point on a different machine (like a Sun).
    For 2002Jul02, there was a bug in plotxy and plotuv that 
    only showed up on a Sun.



Make the tar files.

1.  First, move any files from TARFILES that should be archived to 
    $SCHED/ARCHIVE.

2.  Run "package" and "package2" for the current version using the
    lines below.
      The use of "source" seems to be needed on the Mac to get the 
      right SCHED environment variable.

source ./package {$NEWVER}
source ./package2 Linux {$NEWVER}





Test the release.

   This will not use the spice stuff so it will not be the internal release.
   Unpack the source distribution into /users/cwalker/sched_test and
   test the compilation without the satellite stuff (clean out 
   sched_test first if needed).
   Use the makefile that does not use the spice package
   Check testruns.out at the end.

mkdir $SCHTEST
cd $SCHTEST
# ----  If the directory existed:
chmod u+w $SCHTEST/catalogs/*
/bin/rm -r *
# ----
tar -xvf $SCHED/TARFILES/sched.aux.{$NEWVER}.tar.gz --gunzip
tar -xvf $SCHED/TARFILES/sched.src.{$NEWVER}.tar.gz --gunzip
tar -xvf $SCHED/TARFILES/sched.stdout.{$NEWVER}.tar.gz --gunzip
cd src
MakeLinux
cd ../examples
setenv SCHEDSAVE $SCHED
setenv SCHED $SCHTEST
Verify
setenv SCHED $SCHEDSAVE



#  Make the release directory using the binary tar file.

mkdir /users/cwalker/files/sched_{$NEWVER}
cd /users/cwalker/files/sched_{$NEWVER}
tar -xvf $SCHED/TARFILES/sched.Linux.{$NEWVER}.tar.gz --gunzip
mkdir bin/LINUX
mv bin/* bin/LINUX

#  Later copy in the SUN and MacOSX versions of the binaries with
#  the sun version in /bin for historical reasons.  The analysts might
#  get tripped up if I do anything diffent



#  Copy documentation to the web server master files on noatak.
#  My cron jobs will move them to the main web server or run 
#  /home/eolus/cwalker/backups/rsync_mach_cwalker afterwards.
#  Careful with the big delete (rm) below (that's why the cd ~ first)
#  The initial removal of the catalogs etc directories is because the
#  cp -r copied too much into those places.

setenv WEBDIR /home/noatak/cwalker/webnrao

#  Clean out any previous attempts and make the directory.

cd ~
chmod u+w $WEBDIR/sched_{$NEWVER}/sched/catalogs/*
/bin/rm -r $WEBDIR/sched_{$NEWVER}
mkdir $WEBDIR/sched_$NEWVER

#  Copy the manual, catalogs, examples, and setups to the web directory.

cd $SCHED
cp -r doc/sched $WEBDIR/sched_{$NEWVER}
/bin/rm $WEBDIR/sched_{$NEWVER}/sched/catalogs
/bin/rm $WEBDIR/sched_{$NEWVER}/sched/examples
/bin/rm $WEBDIR/sched_{$NEWVER}/sched/setups
mkdir $WEBDIR/sched_{$NEWVER}/sched/catalogs
cp catalogs/sources.vlba  $WEBDIR/sched_{$NEWVER}/sched/catalogs
cp catalogs/freq.dat      $WEBDIR/sched_{$NEWVER}/sched/catalogs
cp catalogs/stations.dat  $WEBDIR/sched_{$NEWVER}/sched/catalogs
cp catalogs/locations.dat $WEBDIR/sched_{$NEWVER}/sched/catalogs
cp catalogs/peak.cmd      $WEBDIR/sched_{$NEWVER}/sched/catalogs
cp catalogs/linefreqs.dat $WEBDIR/sched_{$NEWVER}/sched/catalogs
mkdir $WEBDIR/sched_{$NEWVER}/sched/examples
cp examples/*.key $WEBDIR/sched_{$NEWVER}/sched/examples
cp examples/*.com $WEBDIR/sched_{$NEWVER}/sched/examples
cp examples/*.set $WEBDIR/sched_{$NEWVER}/sched/examples
mkdir $WEBDIR/sched_{$NEWVER}/sched/setups
cp setups/*.set  $WEBDIR/sched_{$NEWVER}/sched/setups

# Point to this new version.  Consider cleaning up old ones.

cd $WEBDIR
/bin/rm sched
ln -s sched_{$NEWVER} sched
cd $SCHED

#  Copy to ftp  (FTP=/var/spool/ftp/pub)
#  No longer update skedconv or uptime.  In fact get rid of any seen.

cd $SCHED
/bin/rm $FTP/sched/README
/bin/rm $FTP/sched/*{$NEWVER}.tar.gz
/bin/rm $FTP/staff/cwalker/Sched/*{$NEWVER}.tar.gz

cp $SCHED/README.ftp $FTP/sched/README
cp $SCHED/TARFILES/*{$NEWVER}.tar.gz     $FTP/sched
cp $FTP/sched/rcwsrc.{$NEWVER}.tar.gz $FTP/staff/cwalker/Sched




Other architectures:

There will need to be executables for 32 and 64 bit machines in
the release directory.  See bin/LINUX and bin/LINUX64
The 32 bit binary from a RHEL5.2 machine seems to work in the older
RHEL so hopefully we don't need a third.


#  Install the release in /users/cwalker/sched_sun
#  and compile using one of the sun machines.  Then distribute

cd ~/files
mkdir sched_sun_{$NEWVER}
cd sched_sun_{$NEWVER}
tar -xvf $SCHED/TARFILES/sched.aux.{$NEWVER}.tar.gz --gunzip
tar -xvf $SCHED/TARFILES/sched.src.{$NEWVER}.tar.gz --gunzip
tar -xvf $SCHED/TARFILES/sched.stdout.{$NEWVER}.tar.gz --gunzip

#  Log into a Solaris box and run:

slogin paso  (or shire, which might be faster)

setenv NEWVER 6.05
setenv SCHED ~/files/sched_sun_{$NEWVER}
cd ~/files/sched_sun_{$NEWVER}/src
MakeSun
cd ../examples
Verify

#  Check testruns.out, then exit from the Sun.

less testruns.out
exit

#  Make the binary Sun distribution and put the executable where
#  it is needed on the Linux distribution.
#  Keep $SCHED pointing at the Linux version.

cd ~/files/sched_sun_{$NEWVER}
source ./package2 Sun $NEWVER
mv TARFILES/sched.Sun.{$NEWVER}.tar.gz $SCHED/TARFILES
cp $SCHED/TARFILES/sched.Sun.{$NEWVER}.tar.gz $FTP/sched
cp bin/sched ~/files/sched_{$NEWVER}/bin
cp bin/schclean ~/files/sched_{$NEWVER}/bin



#  Install the release on a Mac and compile.  Then distribute.
  
cd $SCHED
scp TARFILES/sched.aux.{$NEWVER}.tar.gz \
    horton:/Users/cwalker/code/sched_MacOSX_{$NEWVER}
scp TARFILES/sched.src.{$NEWVER}.tar.gz \
    horton:/Users/cwalker/code/sched_MacOSX_{$NEWVER}
scp TARFILES/sched.stdout.{$NEWVER}.tar.gz \
    horton:/Users/cwalker/code/sched_MacOSX_{$NEWVER}

# Go to horton
# Note will need to approve deletion of Makefile when running MakeMacOSX.
# This can be done from pingora if horton is on the net.

slogin horton

setenv NEWVER 6.02
setenv SCHED /Users/cwalker/code/sched_MacOSX_{$NEWVER}
cd $SCHED
tar -xvf sched.aux.{$NEWVER}.tar.gz --gunzip
tar -xvf sched.src.{$NEWVER}.tar.gz --gunzip
tar -xvf sched.stdout.{$NEWVER}.tar.gz --gunzip
cd src
MakeMacOSX
cd ../examples
Verify
cd ..
mkdir TARFILES
mv *.tar.gz TARFILES
source ./package2 MacOSX $NEWVER
exit

scp horton:/Users/cwalker/code/sched_MacOSX_{$NEWVER}/TARFILES/sched.MacOSX.{$NEWVER}.tar.gz \
    TARFILES
cp TARFILES/sched.MacOSX.{$NEWVER}.tar.gz $FTP/sched


#  Activate the new version.
#  Be sure the webversion link was also changed as per above.

cd /users/cwalker
/bin/rm sched
ln -s files/sched_{$NEWVER} sched
/bin/rm $WEBDIR/sched
ln -s sched_{$NEWVER} $WEBDIR/sched
Then distribute the web version.  The easy way is to run
the /home/eolus/cwalker/backups/rsync_mach_cwalker cron job.
Then fix the logical for sched in public_html if needed.


#  Send the email announcement to:
#  vlbi@nrao.edu,scistaff,analysts,pperley,vlbaops.

#  I think that is all.  It's still too much.


