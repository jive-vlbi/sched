Instructions for making a release of SCHED

Before a release:

1.  Get the latest versions of the Vex and plot code from 
    Antonios and Franco (and maybe Cormac)

2.  Make sure VERSION and VERNUM in versched.f are up to date.
    Make sure the version on the manual first page are current.

    Set the NEWVER in the window where this work is being done so
    that script segments below can be used with a cut-and-paste
    Also check a couple of places below (other machines) where the
    version number is also needed.

setenv NEWVER 8.0
setenv DIST /users/cwalker/files/sched_{$NEWVER}
setenv SCHTEST /users/cwalker/files/sched_test
setenv TARDIR /users/cwalker/files/sched_ARCHIVE_nonSVN/TARFILES

3.  Compile and link SCHED for each target architecture.
    Architectures are (with local usable machines):
      LINUX     32 bit Intel linux machine without satellite tracking. (falcon)
      LINUX64   64 bit Intel linux machine without satellite tracking. (noatak)
      LINUX64SPICE  Like LINUX64 but with satellite tracking (noatak)
      OSXPPC    PowerPC Mac. (horton)
      SUN       Sun Solaris machine  (shire)
    Go to sched_work while logged into a machine of the right type.
      invoke the appropriate configure file
      run make
      move the binary to the right subdirectory in bin.

4.  Update the manual and the web version:

5.  Write a release note.  This will be mainly a link to the manual
    update section.

6.  Check the README and README.ftp files in $SCHED.



Prepare the manual:

1.  Update the examples embedded in the manual.  You can use the 
    following lines as a script.
    inserttex is in $SCHED/RELATED_CODE/INSERTTEX if it is not in path.

cd $SCHED/doc
/bin/rm sched.tex.tmp
mv sched.tex sched.tex.tmp
inserttex 
sched.tex.tmp
sched.tex
 
2.  Process the manual.  latex will probably need to be run up to
    3 times to get all the links right.
    The local icons switch keeps users from having to go to
    NRAO for the up etc buttons.
    The -link option controls how deep the automatic contents pages
    go at each level.  Without it, the contents on the top level
    page are long enought to frighten off users.

latex sched.tex
latex2html -local_icons -link 2 sched.tex



Update the setup files:

cd $SCHED/setups
makesetup



Update the catalogs from the masters.
Update updates the stations, freq, and messages files for which
the masters are in subdirectories.

cd $SCHED/catalogs
Update

Hand update source and locations files if there has been an
update to the correlator data base.  Update the VERSIONs in 
those catalogs.



Update the examples and clean up the area.
   Check that testruns.out shows a clean comparison after Verify.

cd $SCHED/examples
Verify
Newstd
schclean "*"



Test the plot functions on egplan.key.  Verify does not make plots.
    Do this at some point on a different machine (like a Sun).
    For 2002Jul02, there was a bug in plotxy and plotuv that 
    only showed up on a Sun.



Make the release directory and tar file.
Run package3 with the version number.  That should do all of the above.
First it runs rsync to the release, creating it if it is not already 
there.  Then it tar the whole thing.  The tar file ends up in $TARDIR

source ./package3 {NEWVER}



Test the release.

   This will not use the spice stuff so it will not be the internal release.
   Unpack the source distribution into /users/cwalker/sched_test and
   test the compilation without the satellite stuff (clean out 
   sched_test first if needed).
   Use the makefile that does not use the spice package
   Check testruns.out at the end.

mkdir $SCHTEST
cd $SCHTEST
# ----  If the directory existed:
chmod u+w $SCHTEST/catalogs/*
/bin/rm -r *
# ----
tar -xvf $TARDIR/sched.{$NEWVER}.tar.gz --gunzip
cd src
configureLinux
make
cd ../examples
setenv SCHEDSAVE $SCHED
setenv SCHED $SCHTEST
Verify
setenv SCHED $SCHEDSAVE



#  Copy documentation to the web server master files on noatak.
#  My cron jobs will move them to the main web server or run 
#  /home/eolus/cwalker/backups/rsync_mach_cwalker afterwards.
#  Careful with the big delete (rm) below (that's why the cd ~ first)
#  The initial removal of the catalogs etc directories is because the
#  cp -r copied too much into those places.

setenv WEBDIR /home/noatak/cwalker/webnrao

#  Clean out any previous attempts and make the directory.

cd ~
chmod u+w $WEBDIR/sched_{$NEWVER}/sched/catalogs/*
/bin/rm -r $WEBDIR/sched_{$NEWVER}
mkdir $WEBDIR/sched_$NEWVER
cd $WEBDIR/sched_$NEWVER

#  Check you are where you want to be

pwd

#  Copy the manual, catalogs, examples, and setups to the web directory.
#  First need to delete the symlinks in left in the doc/sched area.

cp -r $SCHED/doc/sched .
/bin/rm sched/catalogs
/bin/rm sched/examples
/bin/rm sched/setups
mkdir sched/catalogs
cp $SCHED/catalogs/sources.vlba  sched/catalogs
cp $SCHED/catalogs/freq.dat      sched/catalogs
cp $SCHED/catalogs/stations.dat  sched/catalogs
cp $SCHED/catalogs/locations.dat sched/catalogs
cp $SCHED/catalogs/peak.cmd      sched/catalogs
cp $SCHED/catalogs/linefreqs.dat sched/catalogs
mkdir sched/examples
cp $SCHED/examples/*.key sched/examples
cp $SCHED/examples/*.com sched/examples
cp $SCHED/examples/*.set sched/examples
mkdir sched/setups
cp $SCHED/setups/*.set  sched/setups

# Remake the sched link at the top level web directory to point to 
# the new version.  Consider cleaning out some old versions.

cd $WEBDIR
/bin/rm sched
ln -s sched_{$NEWVER} sched
cd $SCHED



#  Copy to ftp  (FTP=/var/spool/ftp/pub)

cd $SCHED
/bin/rm $FTP/sched/README
/bin/rm $FTP/sched/*{$NEWVER}.tar.gz
/bin/rm $FTP/staff/cwalker/Sched/*{$NEWVER}.tar.gz

cp $SCHED/README.ftp $FTP/sched/README
cp $TARDIR/sched_{$NEWVER}.tar.gz     $FTP/sched


Other architectures:

All that is needed was done back at the compilation step.



#  Send the email announcement to:
#  vlbi@nrao.edu,scistaff,analysts,pperley,vlbaops.

#  I think that is all.  It's still too much.


