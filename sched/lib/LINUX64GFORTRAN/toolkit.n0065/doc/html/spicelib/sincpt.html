
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>sincpt</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>sincpt</b> </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">

<small><div align="center">
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div></small>
       <br>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
            <small>
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Examples">Examples<br></a>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
             </small>
            </td>
          </tr>
        </tbody>
</table>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
 SINCPT ( Surface intercept )
 
      SUBROUTINE SINCPT ( METHOD,  TARGET,  ET,      FIXREF, 
     .                    ABCORR,  OBSRVR,  DREF,    DVEC,    
     .                    SPOINT,  TRGEPC,  SRFVEC,  FOUND  )
      
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Given an observer and a direction vector defining a ray, compute
     the surface intercept of the ray on a target body at a specified
     epoch, optionally corrected for light time and stellar
     aberration.

     This routine supersedes <a href="srfxpt.html">SRFXPT</a>.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/frames.html">FRAMES</a>
     <a href="../req/naif_ids.html">NAIF_IDS</a>
     <a href="../req/pck.html">PCK</a>
     <a href="../req/spk.html">SPK</a>
     <a href="../req/time.html">TIME</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     GEOMETRY
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
      IMPLICIT NONE

      INCLUDE               'frmtyp.inc'
      INCLUDE               'zzabcorr.inc'
      INCLUDE               'zzctr.inc'
      
      CHARACTER*(*)         METHOD
      CHARACTER*(*)         TARGET
      DOUBLE PRECISION      ET
      CHARACTER*(*)         FIXREF
      CHARACTER*(*)         ABCORR
      CHARACTER*(*)         OBSRVR
      CHARACTER*(*)         DREF
      DOUBLE PRECISION      DVEC   ( 3 )
      DOUBLE PRECISION      SPOINT ( 3 )
      DOUBLE PRECISION      TRGEPC
      DOUBLE PRECISION      SRFVEC ( 3 )
      LOGICAL               FOUND
 
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     Variable  I/O  Description
     --------  ---  --------------------------------------------------
     METHOD     I   Computation method.
     TARGET     I   Name of target body.
     ET         I   Epoch in ephemeris seconds past J2000 TDB.
     FIXREF     I   Body-fixed, body-centered target body frame.
     ABCORR     I   Aberration correction.
     OBSRVR     I   Name of observing body.
     DREF       I   Reference frame of ray's direction vector.
     DVEC       I   Ray's direction vector.
     SPOINT     O   Surface intercept point on the target body.
     TRGEPC     O   Intercept epoch.
     SRFVEC     O   Vector from observer to intercept point.
     FOUND      O   Flag indicating whether intercept was found.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     METHOD      is a short string providing parameters defining
                 the computation method to be used. 

                 The only choice currently supported is

                    'Ellipsoid'        The intercept computation uses
                                       a triaxial ellipsoid to model
                                       the surface of the target body.
                                       The ellipsoid's radii must be
                                       available in the kernel pool.

                 Neither case nor white space are significant in 
                 METHOD. For example, the string ' eLLipsoid ' is 
                 valid.                 

                 
     TARGET      is the name of the target body. TARGET is
                 case-insensitive, and leading and trailing blanks in
                 TARGET are not significant. Optionally, you may
                 supply a string containing the integer ID code 
                 for the object. For example both 'MOON' and '301'
                 are legitimate strings that indicate the Moon is the
                 target body.

                 When the target body's surface is represented by a
                 tri-axial ellipsoid, this routine assumes that a
                 kernel variable representing the ellipsoid's radii is
                 present in the kernel pool. Normally the kernel
                 variable would be defined by loading a PCK file.


     ET          is the epoch of participation of the observer,
                 expressed as ephemeris seconds past J2000 TDB: ET is
                 the epoch at which the observer's state is computed.

                 When aberration corrections are not used, ET is also
                 the epoch at which the state and orientation of the
                 target body are computed.

                 When aberration corrections are used, the position
                 and orientation of the target body are computed at
                 ET-LT or ET+LT, where LT is the one-way light time
                 between the intercept point and the observer, and the
                 sign applied to LT depends on the selected
                 correction. See the description of ABCORR below for
                 details.

                                  
     FIXREF      is the name of the body-fixed, body-centered
                 reference frame associated with the target body. The
                 output intercept point SPOINT and the observer to
                 intercept vector SRFVEC will be expressed relative to
                 this reference frame. The string FIXREF is
                 case-insensitive, and leading and trailing blanks in
                 FIXREF are not significant.


     ABCORR      indicates the aberration corrections to be applied
                 when computing the target's position and orientation.

                 For remote sensing applications, where the apparent
                 surface intercept point seen by the observer is
                 desired, normally the correction
              
                    'CN+S'
     
                 should be used. This and the other supported options
                 are described below. ABCORR may be any of the 
                 following:

                    'NONE'     Apply no correction. Return the 
                               geometric surface intercept point on the
                               target body.

                 Let LT represent the one-way light time between the
                 observer and the surface intercept point (note: NOT
                 between the observer and the target body's center).
                 The following values of ABCORR apply to the
                 &quot;reception&quot; case in which photons depart from the
                 intercept point's location at the light-time
                 corrected epoch ET-LT and *arrive* at the observer's
                 location at ET:

                    'LT'       Correct for one-way light time (also
                               called &quot;planetary aberration&quot;) using a
                               Newtonian formulation. This correction
                               yields the location of the surface
                               intercept point at the moment it
                               emitted photons arriving at the
                               observer at ET.
 
                               The light time correction uses an
                               iterative solution of the light time
                               equation. The solution invoked by the
                               'LT' option uses one iteration.

                               Both the target position as seen by the
                               observer, and rotation of the target
                               body, are corrected for light time.

                    'LT+S'     Correct for one-way light time and
                               stellar aberration using a Newtonian
                               formulation. This option modifies the
                               surface intercept obtained with the
                               'LT' option to account for the
                               observer's velocity relative to the
                               solar system barycenter. These
                               computations yield the apparent surface
                               intercept point.

                    'CN'       Converged Newtonian light time
                               correction. In solving the light time
                               equation, the 'CN' correction iterates
                               until the solution converges. Both the
                               position and rotation of the target
                               body are corrected for light time.

                    'CN+S'     Converged Newtonian light time and
                               stellar aberration corrections. This
                               option produces a solution that is at
                               least as accurate at that obtainable
                               with the 'LT+S' option. Whether the
                               'CN+S' solution is substantially more
                               accurate depends on the geometry of the
                               participating objects and on the
                               accuracy of the input data. In all
                               cases this routine will execute more
                               slowly when a converged solution is
                               computed.

                               For reception-case applications
                               involving intercepts near the target
                               body limb, this option should be used.

                 The following values of ABCORR apply to the
                 &quot;transmission&quot; case in which photons *depart* from
                 the observer's location at ET and arrive at the
                 intercept point at the light-time corrected epoch
                 ET+LT:

                    'XLT'      &quot;Transmission&quot; case: correct for
                               one-way light time using a Newtonian
                               formulation. This correction yields the
                               intercept location at the moment it
                               receives photons emitted from the
                               observer's location at ET. 

                               The light time correction uses an
                               iterative solution of the light time
                               equation. The solution invoked by the
                               'XLT' option uses one iteration.

                               Both the target position as seen by the
                               observer, and rotation of the target
                               body, are corrected for light time.

                    'XLT+S'    &quot;Transmission&quot; case: correct for
                               one-way light time and stellar
                               aberration using a Newtonian
                               formulation  This option modifies the
                               intercept obtained with the 'XLT'
                               option to account for the observer's
                               velocity relative to the solar system
                               barycenter.

                    'XCN'      Converged Newtonian light time
                               correction. This is the same as XLT
                               correction but with further iterations
                               to a converged Newtonian light time
                               solution. 

                    'XCN+S'    &quot;Transmission&quot; case: converged
                               Newtonian light time and stellar
                               aberration corrections. This option
                               produces a solution that is at least as
                               accurate at that obtainable with the
                               'XLT+S' option. Whether the 'XCN+S'
                               solution is substantially more accurate
                               depends on the geometry of the
                               participating objects and on the
                               accuracy of the input data. In all
                               cases this routine will execute more
                               slowly when a converged solution is
                               computed.

                               For transmission-case applications
                               involving intercepts near the target
                               body limb, this option should be used.

                Case and embedded blanks are not significant in
                ABCORR. For example, the string

                   'Cn + s'

                 is valid.


     OBSRVR      is the name of the observing body. This is typically
                 a spacecraft, the earth, or a surface point on the
                 earth. OBSRVR is case-insensitive, and leading and
                 trailing blanks in OBSRVR are not significant.
                 Optionally, you may supply a string containing the
                 integer ID code for the object. For example both
                 'MOON' and '301' are legitimate strings that indicate
                 the Moon is the observer.


     DREF        is the name of the reference frame relative to which
                 the ray's direction vector is expressed. This may be
                 any frame supported by the SPICE system, including
                 built-in frames (documented in the Frames Required
                 Reading) and frames defined by a loaded frame kernel
                 (FK). The string DREF is case-insensitive, and
                 leading and trailing blanks in DREF are not
                 significant.

                 When DREF designates a non-inertial frame, the
                 orientation of the frame is evaluated at an epoch
                 dependent on the frame's center and, if the center is
                 not the observer, on the selected aberration
                 correction. See the description of the direction
                 vector DVEC for details.


     DVEC        Ray direction vector emanating from the observer. The
                 intercept with the target body's surface of the ray
                 defined by the observer and DVEC is sought.

                 DVEC is specified relative to the reference frame
                 designated by DREF.

                 Non-inertial reference frames are treated as follows:
                 if the center of the frame is at the observer's
                 location, the frame is evaluated at ET. If the
                 frame's center is located elsewhere, then letting
                 LTCENT be the one-way light time between the observer
                 and the central body associated with the frame, the
                 orientation of the frame is evaluated at ET-LTCENT,
                 ET+LTCENT, or ET depending on whether the requested
                 aberration correction is, respectively, for received
                 radiation, transmitted radiation, or is omitted.
                 LTCENT is computed using the method indicated by
                 ABCORR.
                 
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     SPOINT      is the surface intercept point on the target body of
                 the ray defined by the observer and the direction
                 vector. If the ray intersects the target body in
                 multiple points, the selected intersection point is
                 the one closest to the observer. The output argument
                 FOUND (see below) indicates whether an intercept was
                 found.

                 SPOINT is expressed in Cartesian coordinates,
                 relative to the target body-fixed frame designated by
                 FIXREF. The body-fixed target frame is evaluated at
                 the intercept epoch TRGEPC (see description below).

                 When light time correction is used, the duration of
                 light travel between SPOINT to the observer is
                 considered to be the one way light time. When both
                 light time and stellar aberration corrections are
                 used, SPOINT is selected such that, when SPOINT is
                 corrected for light time and stellar aberration, the
                 resulting vector is parallel to SPOINT lies on the
                 ray defined by the observer's location and DVEC.

                 The components of SPOINT are given in units of km.


     TRGEPC      is the &quot;intercept epoch.&quot; TRGEPC is defined as
                 follows: letting LT be the one-way light time between
                 the observer and the intercept point, TRGEPC is the
                 epoch ET-LT, ET+LT, or ET depending on whether the
                 requested aberration correction is, respectively, for
                 received radiation, transmitted radiation, or
                 omitted. LT is computed using the method indicated by
                 ABCORR.

                 TRGEPC is expressed as seconds past J2000 TDB.


     SRFVEC      is the vector from the observer's position at ET to
                 the aberration-corrected (or optionally, geometric)
                 position of SPOINT, where the aberration corrections
                 are specified by ABCORR. SRFVEC is expressed in the
                 target body-fixed reference frame designated by
                 FIXREF, evaluated at TRGEPC.
  
                 The components of SRFVEC are given in units of km.

                 One can use the SPICELIB function <a href="vnorm.html">VNORM</a> to obtain the
                 distance between the observer and SPOINT:

                    DIST = <a href="vnorm.html">VNORM</a> ( SRFVEC )

                 The observer's position OBSPOS, relative to the
                 target body's center, where the center's position is
                 corrected for aberration effects as indicated by
                 ABCORR, can be computed via the call:

                    CALL <a href="vsub.html">VSUB</a> ( SPOINT, SRFVEC, OBSPOS )

                 To transform the vector SRFVEC from a reference frame
                 FIXREF at time TRGEPC to a time-dependent reference
                 frame REF at time ET, the routine <a href="pxfrm2.html">PXFRM2</a> should be
                 called. Let XFORM be the 3x3 matrix representing the
                 rotation from the reference frame FIXREF at time
                 TRGEPC to the reference frame REF at time ET. Then
                 SRFVEC can be transformed to the result REFVEC as
                 follows:

                     CALL <a href="pxfrm2.html">PXFRM2</a> ( FIXREF, REF,    TRGEPC, ET, XFORM )
                     CALL <a href="mxv.html">MXV</a>    ( XFORM,  SRFVEC, REFVEC )

                 The second example in the Examples header section
                 below presents a complete program that demonstrates
                 this procedure.
     

     FOUND       A logical flag indicating whether or not the ray
                 intersects the target. If an intersection exists
                 FOUND will be returned as .TRUE. If the ray misses
                 the target, FOUND will be returned as .FALSE.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
 

     1)  If the specified aberration correction is unrecognized, the
         error will be diagnosed and signaled by a routine in the call
         tree of this routine.

     2)  If either the target or observer input strings cannot be
         converted to an integer ID code, the error
         SPICE(IDCODENOTFOUND) is signaled.

     3)  If OBSRVR and TARGET map to the same NAIF integer ID code,
         the error SPICE(BODIESNOTDISTINCT) is signaled.

     4)  If the input target body-fixed frame FIXREF is not
         recognized, the error SPICE(NOFRAME) is signaled. A frame
         name may fail to be recognized because a required frame
         specification kernel has not been loaded; another cause is a
         misspelling of the frame name.

     5)  If the input frame FIXREF is not centered at the target body,
         the error SPICE(INVALIDFRAME) is signaled.

     6)  If the input argument METHOD is not recognized, the error
         SPICE(INVALIDMETHOD) is signaled.

     7)  If the target and observer have distinct identities but are
         at the same location (for example, the target is Mars and the
         observer is the Mars barycenter), the error
         SPICE(NOSEPARATION) is signaled.

     8)  If insufficient ephemeris data have been loaded prior to
         calling <b>SINCPT</b>, the error will be diagnosed and signaled by a
         routine in the call tree of this routine. Note that when
         light time correction is used, sufficient ephemeris data must
         be available to propagate the states of both observer and
         target to the solar system barycenter.

     9)  If the computation method specifies an ellipsoidal target
         shape and triaxial radii of the target body have not been
         loaded into the kernel pool prior to calling <b>SINCPT</b>, the
         error will be diagnosed and signaled by a routine in the call
         tree of this routine.

     10) The target must be an extended body: if any of the radii of
         the target body are non-positive, the error will be
         diagnosed and signaled by routines in the call tree of this
         routine.

     11) If PCK data specifying the target body-fixed frame
         orientation have not been loaded prior to calling <b>SINCPT</b>,
         the error will be diagnosed and signaled by a routine in the
         call tree of this routine.

     12) If the reference frame designated by DREF is not recognized
         by the SPICE frame subsystem, the error SPICE(NOFRAME)
         will be signaled.

     13) If the direction vector DVEC is the zero vector, the error
         SPICE(ZEROVECTOR) will be signaled.
         
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     Appropriate kernels must be loaded by the calling program before
     this routine is called.

     The following data are required:

        - SPK data: ephemeris data for target and observer must be
          loaded. If aberration corrections are used, the states of
          target and observer relative to the solar system barycenter
          must be calculable from the available ephemeris data.
          Typically ephemeris data are made available by loading one
          or more SPK files via <a href="furnsh.html">FURNSH</a>.

        - PCK data: if the computation method is specified as
          &quot;Ellipsoid,&quot; triaxial radii for the target body must be 
          loaded into the kernel pool. Typically this is done by
          loading a text PCK file via <a href="furnsh.html">FURNSH</a>.

        - Further PCK data: rotation data for the target body must
          be loaded. These may be provided in a text or binary PCK
          file. 

     The following data may be required:

        - Frame data: if a frame definition is required to convert
          the observer and target states to the body-fixed frame of
          the target, that definition must be available in the kernel
          pool. Similarly, the frame definition required to map
          between the frame designated by DREF and the target
          body-fixed frame must be available. Typically the
          definitions of frames not already built-in to SPICE are
          supplied by loading a frame kernel.

        - CK data: if the frame to which DREF refers is fixed to a
          spacecraft instrument or structure, at least one CK file
          will be needed to permit transformation of vectors between
          that frame and both the J2000 and the target body-fixed
          frames.

        - SCLK data: if a CK file is needed, an associated SCLK
          kernel is required to enable conversion between encoded SCLK
          (used to time-tag CK data) and barycentric dynamical time
          (TDB).

     In all cases, kernel data are normally loaded once per program
     run, NOT every time this routine is called.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     Given a ray defined by a direction vector and the location of an
     observer, <b>SINCPT</b> computes the surface intercept point of the ray
     on a specified target body. <b>SINCPT</b> also determines the vector
     from the observer to the surface intercept point.

     When aberration corrections are used, this routine finds the
     value of SPOINT such that, if SPOINT is regarded as an ephemeris
     object, after the selected aberration corrections are applied to
     the vector from the observer to SPOINT, the resulting vector is
     parallel to the direction vector DVEC.

     This routine computes light time corrections using light time
     between the observer and the surface intercept point, as opposed
     to the center of the target. Similarly, stellar aberration
     corrections done by this routine are based on the direction of
     the vector from the observer to the light-time corrected
     intercept point, not to the target center. This technique avoids
     errors due to the differential between aberration corrections
     across the target body. Therefore it's valid to use aberration
     corrections with this routine even when the observer is very
     close to the intercept point, in particular when the
     observer-intercept point distance is much less than the
     observer-target center distance. It's also valid to use stellar
     aberration corrections even when the intercept point is near or
     on the limb (as may occur in occultation computations using a
     point target).

     When comparing surface intercept point computations with results
     from sources other than SPICE, it's essential to make sure the
     same geometric definitions are used.
     
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for this example may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine 
     specific arithmetic implementation. 


     1) The following program computes surface intercept points on Mars
        for the boresight and FOV boundary vectors of the MGS MOC
        narrow angle camera. The intercepts are computed for a single
        observation epoch. Light time and stellar aberration
        corrections are used. For simplicity, camera distortion is
        ignored.

        Use the meta-kernel shown below to load the required SPICE
        kernels.


           KPL/MK

           File: mgs_example2.tm

           This meta-kernel is intended to support operation of SPICE
           example programs. The kernels shown here should not be
           assumed to contain adequate or correct versions of data
           required by SPICE-based user applications.

           In order for an application to use this meta-kernel, the
           kernels referenced here must be present in the user's
           current working directory.

           The names and contents of the kernels referenced
           by this meta-kernel are as follows:

              File name                     Contents
              ---------                     --------
              de418.bsp                     Planetary ephemeris
              pck00008.tpc                  Planet orientation and
                                            radii
              naif0008.tls                  Leapseconds
              mgs_moc_v20.ti                MGS MOC instrument
                                            parameters
              mgs_sclkscet_00061.tsc        MGS SCLK coefficients
              mgs_sc_ext12.bc               MGS s/c bus attitude
              mgs_ext12_ipng_mgs95j.bsp     MGS ephemeris

           \begindata

              KERNELS_TO_LOAD = ( 'de418.bsp',
                                  'pck00008.tpc',
                                  'naif0008.tls',
                                  'mgs_moc_v20.ti',
                                  'mgs_sclkscet_00061.tsc',
                                  'mgs_sc_ext12.bc',
                                  'mgs_ext12_ipng_mgs95j.bsp' )
           \begintext


        Example code begins here.

          PROGRAM EX1
          IMPLICIT NONE
    C
    C     SPICELIB functions
    C
          DOUBLE PRECISION      <a href="vnorm.html">VNORM</a>

    C
    C     Local parameters
    C
          CHARACTER*(*)         META
          PARAMETER           ( META   = 'mgs_example2.tm' )

          INTEGER               ABCLEN
          PARAMETER           ( ABCLEN = 20 )

          INTEGER               LNSIZE
          PARAMETER           ( LNSIZE = 78 )

          INTEGER               METLEN
          PARAMETER           ( METLEN = 40 )

          INTEGER               NAMLEN
          PARAMETER           ( NAMLEN = 32 )

          INTEGER               TIMLEN
          PARAMETER           ( TIMLEN = 50 )

          INTEGER               SHPLEN
          PARAMETER           ( SHPLEN = 80 )

          INTEGER               NCORNR
          PARAMETER           ( NCORNR = 4 )

    C
    C     Local variables
    C
          CHARACTER*(ABCLEN)    ABCORR
          CHARACTER*(NAMLEN)    CAMERA
          CHARACTER*(NAMLEN)    DREF
          CHARACTER*(METLEN)    METHOD
          CHARACTER*(NAMLEN)    OBSRVR
          CHARACTER*(SHPLEN)    SHAPE
          CHARACTER*(NAMLEN)    TARGET
          CHARACTER*(LNSIZE)    TITLE
          CHARACTER*(TIMLEN)    UTC

          DOUBLE PRECISION      BOUNDS ( 3, NCORNR )
          DOUBLE PRECISION      BSIGHT ( 3 )
          DOUBLE PRECISION      DIST
          DOUBLE PRECISION      <a href="dpr.html">DPR</a>
          DOUBLE PRECISION      DVEC   ( 3 )
          DOUBLE PRECISION      ET
          DOUBLE PRECISION      LAT
          DOUBLE PRECISION      LON
          DOUBLE PRECISION      RADIUS
          DOUBLE PRECISION      SPOINT ( 3 )
          DOUBLE PRECISION      SRFVEC ( 3 )
          DOUBLE PRECISION      TRGEPC

          INTEGER               CAMID
          INTEGER               I
          INTEGER               J
          INTEGER               N

          LOGICAL               FOUND

          DATA                  ABCORR / 'CN+S'      /
          DATA                  CAMERA / 'MGS_MOC_NA'/
          DATA                  METHOD / 'Ellipsoid' /
          DATA                  OBSRVR / 'MGS'       /
          DATA                  TARGET / 'Mars'      /
          DATA                  UTC    / '2003 OCT 13 06:00:00 UTC' /

    C
    C     Load kernel files:
    C
          CALL <a href="furnsh.html">FURNSH</a> ( META )

    C
    C     Convert the UTC request time to ET (seconds past
    C     J2000, TDB).
    C
          CALL <a href="str2et.html">STR2ET</a> ( UTC, ET )

    C
    C     Get the MGS MOC Narrow angle camera (MGS_MOC_NA)
    C     ID code. Then look up the field of view (FOV)
    C     parameters by calling <a href="getfov.html">GETFOV</a>.
    C
          CALL <a href="bodn2c.html">BODN2C</a> ( CAMERA, CAMID, FOUND )

          IF ( .NOT. FOUND ) THEN
             CALL <a href="setmsg.html">SETMSG</a> ( 'Could not find ID code for ' //
         .                 'instrument #.'               )
             CALL <a href="errch.html">ERRCH</a>  ( '#', CAMERA                   )
             CALL <a href="sigerr.html">SIGERR</a> ( 'SPICE(NOTRANSLATION)'        )
          END IF

    C
    C     <a href="getfov.html">GETFOV</a> will return the name of the camera-fixed frame
    C     in the string DREF, the camera boresight vector in
    C     the array BSIGHT, and the FOV corner vectors in the
    C     array BOUNDS.
    C
          CALL <a href="getfov.html">GETFOV</a> ( CAMID,  NCORNR, SHAPE,  DREF,
         .              BSIGHT, N,      BOUNDS       )


          WRITE (*,*) ' '
          WRITE (*,*) 'Surface Intercept Locations for Camera'
          WRITE (*,*) 'FOV Boundary and Boresight Vectors'
          WRITE (*,*) ' '
          WRITE (*,*) '   Instrument:            ', CAMERA
          WRITE (*,*) '   Epoch:                 ', UTC
          WRITE (*,*) '   Aberration correction: ', ABCORR
          WRITE (*,*) ' '

    C
    C     Now compute and display the surface intercepts for the
    C     boresight and all of the FOV boundary vectors.
    C
          DO I = 1, NCORNR+1

             IF ( I .LE. NCORNR ) THEN

                TITLE = 'Corner vector #'
                CALL <a href="repmi.html">REPMI</a> ( TITLE, '#', I, TITLE )

                CALL <a href="vequ.html">VEQU</a> ( BOUNDS(1,I), DVEC )

             ELSE

                TITLE = 'Boresight vector'
                CALL <a href="vequ.html">VEQU</a> ( BSIGHT, DVEC )

             END IF

    C
    C        Compute the surface intercept point using
    C        the specified aberration corrections.
    C
             CALL <b>SINCPT</b> ( METHOD, TARGET, ET,     'IAU_MARS',
         .                 ABCORR, OBSRVR, DREF,   DVEC,
         .                 SPOINT, TRGEPC, SRFVEC, FOUND      )

             IF ( FOUND ) THEN
    C
    C           Compute range from observer to apparent intercept.
    C
                DIST = <a href="vnorm.html">VNORM</a> ( SRFVEC )
    C
    C           Convert rectangular coordinates to planetocentric
    C           latitude and longitude. Convert radians to degrees.
    C
                CALL <a href="reclat.html">RECLAT</a> ( SPOINT, RADIUS, LON, LAT )

                LON = LON * <a href="dpr.html">DPR</a> ()
                LAT = LAT * <a href="dpr.html">DPR</a> ()
    C
    C           Display the results.
    C
                WRITE (*,*) ' '
                WRITE (*,*) TITLE

                TITLE = '  Vector in # frame = '
                CALL <a href="repmc.html">REPMC</a> ( TITLE, '#', DREF, TITLE )

                WRITE (*,*) ' '
                WRITE (*,*) TITLE

                IF ( I .LE. NCORNR ) THEN
                   WRITE (*,*) '  ', ( BOUNDS(J,I), J = 1, 3 )
                ELSE
                   WRITE (*,*) '  ', BSIGHT
                END IF

                WRITE (*,*) ' '
                WRITE (*,*) '  Intercept:'
                WRITE (*,*)
         .      '     Radius                   (km)  = ', RADIUS
                WRITE (*,*)
         .      '     Planetocentric Latitude  (deg) = ', LAT
                WRITE (*,*)
         .      '     Planetocentric Longitude (deg) = ', LON
                WRITE (*,*)
         .      '     Range                    (km)  = ', DIST
                WRITE (*,*) ' '

             ELSE

                WRITE (*,*) ' '
                WRITE (*,*) 'Intercept not found.'
                WRITE (*,*) ' '

             END IF

          END DO

          END


     When this program was executed on a PC/Linux/g77 platform, the
     output was:

        Surface Intercept Locations for Camera
        FOV Boundary and Boresight Vectors

           Instrument:            MGS_MOC_NA
           Epoch:                 2003 OCT 13 06:00:00 UTC
           Aberration correction: CN+S


        Corner vector 1

          Vector in MGS_MOC_NA frame =
            1.85713838E-06 -0.00380156227  0.999992774

          Intercept:
             Radius                   (km)  =   3384.94114
             Planetocentric Latitude  (deg) =  -48.4774819
             Planetocentric Longitude (deg) =  -123.474079
             Range                    (km)  =   388.983104


        Corner vector 2

          Vector in MGS_MOC_NA frame =
            1.85713838E-06  0.00380156227  0.999992774

          Intercept:
             Radius                   (km)  =   3384.9397
             Planetocentric Latitude  (deg) =  -48.4816363
             Planetocentric Longitude (deg) =  -123.398823
             Range                    (km)  =   388.975121


        Corner vector 3

          Vector in MGS_MOC_NA frame =
           -1.85713838E-06  0.00380156227  0.999992774

          Intercept:
             Radius                   (km)  =   3384.93969
             Planetocentric Latitude  (deg) =  -48.4816619
             Planetocentric Longitude (deg) =  -123.398826
             Range                    (km)  =   388.974662


        Corner vector 4

          Vector in MGS_MOC_NA frame =
           -1.85713838E-06 -0.00380156227  0.999992774

          Intercept:
             Radius                   (km)  =   3384.94113
             Planetocentric Latitude  (deg) =  -48.4775075
             Planetocentric Longitude (deg) =  -123.474082
             Range                    (km)  =   388.982645


        Boresight vector

          Vector in MGS_MOC_NA frame =
            0.  0.  1.

          Intercept:
             Radius                   (km)  =   3384.94041
             Planetocentric Latitude  (deg) =  -48.4795798
             Planetocentric Longitude (deg) =  -123.436454
             Range                    (km)  =   388.975736


 
     2) Use <a href="subpnt.html">SUBPNT</a> to find the sub-spacecraft point on Mars for the
        Mars Reconnaissance Orbiter spacecraft (MRO) at a specified
        time, using the &quot;near point: ellipsoid&quot; computation method.
        Use both LT+S and CN+S aberration corrections to illustrate
        the differences.

        Convert the spacecraft to sub-observer point vector obtained
        from <a href="subpnt.html">SUBPNT</a> into the MRO_HIRISE_LOOK_DIRECTION reference frame
        at the observation time. Perform a consistency check with this
        vector: compare the Mars surface intercept of the ray
        emanating from the spacecraft and pointed along this vector
        with the sub-observer point.

        Use the meta-kernel shown below to load the required SPICE
        kernels.


           KPL/MK

           File: mro_example.tm

           This meta-kernel is intended to support operation of SPICE
           example programs. The kernels shown here should not be
           assumed to contain adequate or correct versions of data
           required by SPICE-based user applications.

           In order for an application to use this meta-kernel, the
           kernels referenced here must be present in the user's
           current working directory.

           The names and contents of the kernels referenced
           by this meta-kernel are as follows:

              File name                     Contents
              ---------                     --------
              de418.bsp                     Planetary ephemeris
              pck00008.tpc                  Planet orientation and
                                                 radii
              naif0008.tls                  Leapseconds
              mro_psp4_ssd_mro95a.bsp       MRO ephemeris
              mro_v11.tf                    MRO frame specifications
              mro_sclkscet_00022_65536.tsc  MRO SCLK coefficients and
                                                 parameters
              mro_sc_psp_070925_071001.bc   MRO attitude


           \begindata

              KERNELS_TO_LOAD = ( 'de418.bsp',
                                  'pck00008.tpc',
                                  'naif0008.tls',
                                  'mro_psp4_ssd_mro95a.bsp',
                                  'mro_v11.tf',
                                  'mro_sclkscet_00022_65536.tsc',
                                  'mro_sc_psp_070925_071001.bc'  )
           \begintext


       Example code begins here.


          PROGRAM EX2
          IMPLICIT NONE
    C
    C     SPICELIB functions
    C
          DOUBLE PRECISION      <a href="dpr.html">DPR</a>
          DOUBLE PRECISION      <a href="vdist.html">VDIST</a>
          DOUBLE PRECISION      <a href="vnorm.html">VNORM</a>

    C
    C     Local parameters
    C
          CHARACTER*(*)         META
          PARAMETER           ( META   = 'mro_example.tm' )

          CHARACTER*(*)         F1
          PARAMETER           ( F1     = '(A,F21.9)' )

          CHARACTER*(*)         F2
          PARAMETER           ( F2     = '(A)' )

          INTEGER               FRNMLN
          PARAMETER           ( FRNMLN = 32 )

          INTEGER               MTHLEN
          PARAMETER           ( MTHLEN = 50 )

          INTEGER               CORLEN
          PARAMETER           ( CORLEN = 5 )

          INTEGER               NCORR
          PARAMETER           ( NCORR  = 2 )

    C
    C     Local variables
    C
          CHARACTER*(CORLEN)    ABCORR ( NCORR )
          CHARACTER*(FRNMLN)    HIREF
          CHARACTER*(MTHLEN)    METHOD

          DOUBLE PRECISION      ALT
          DOUBLE PRECISION      ET
          DOUBLE PRECISION      LAT
          DOUBLE PRECISION      LON
          DOUBLE PRECISION      MROVEC ( 3 )
          DOUBLE PRECISION      R1     ( 3, 3 )
          DOUBLE PRECISION      R2     ( 3, 3 )
          DOUBLE PRECISION      RADIUS
          DOUBLE PRECISION      SPOINT ( 3 )
          DOUBLE PRECISION      SRFVEC ( 3 )
          DOUBLE PRECISION      TRGEPC
          DOUBLE PRECISION      XFORM  ( 3, 3 )
          DOUBLE PRECISION      XEPOCH
          DOUBLE PRECISION      XPOINT ( 3 )
          DOUBLE PRECISION      XVEC   ( 3 )

          INTEGER               I

          LOGICAL               FOUND

    C
    C     Initial values
    C
          DATA                  ABCORR / 'LT+S', 'CN+S' /
    C
    C     Load kernel files via the meta-kernel.
    C
          CALL <a href="furnsh.html">FURNSH</a> ( META )

    C
    C     Convert the TDB request time string to seconds past
    C     J2000, TDB.
    C
          CALL <a href="str2et.html">STR2ET</a> ( '2007 SEP 30 00:00:00 TDB', ET )

    C
    C     Compute the sub-spacecraft point using the
    C     &quot;NEAR POINT: ELLIPSOID&quot; definition.
    C     Compute the results using both LT+S and CN+S
    C     aberration corrections.
    C
          METHOD = 'Near point: ellipsoid'

          WRITE(*,F2) ' '
          WRITE(*,F2) 'Computation method = '//METHOD

          DO I = 1, NCORR

             CALL <a href="subpnt.html">SUBPNT</a> ( METHOD,
         .                 'Mars', ET,     'IAU_MARS', ABCORR(I),
         .                 'MRO',  SPOINT, TRGEPC,     SRFVEC    )
    C
    C        Compute the observer's altitude above SPOINT.
    C
             ALT = <a href="vnorm.html">VNORM</a> ( SRFVEC )
    C
    C        Express SRFVEC in the MRO_HIRISE_LOOK_DIRECTION
    C        reference frame at epoch ET. Since SRFVEC is expressed
    C        relative to the IAU_MARS frame at TRGEPC, we must
    C        call <a href="pxfrm2.html">PXFRM2</a> to compute the position transformation matrix
    C        from IAU_MARS at TRGEPC to the MRO_HIRISE_LOOK_DIRECTION 
    C        frame at time ET.
    C
    C        To make code formatting a little easier, we'll store
    C        the long MRO reference frame name in a variable:
    C
             HIREF = 'MRO_HIRISE_LOOK_DIRECTION'

             CALL <a href="pxfrm2.html">PXFRM2</a> ( 'IAU_MARS', HIREF,  TRGEPC, ET, XFORM )
             CALL <a href="mxv.html">MXV</a>    (  XFORM,     SRFVEC, MROVEC )

    C
    C        Convert rectangular coordinates to planetocentric
    C        latitude and longitude. Convert radians to degrees.
    C
             CALL <a href="reclat.html">RECLAT</a> ( SPOINT, RADIUS, LON, LAT  )

             LON = LON * <a href="dpr.html">DPR</a> ()
             LAT = LAT * <a href="dpr.html">DPR</a> ()
    C
    C        Write the results.
    C
             WRITE(*,F2) ' '
             WRITE(*,F2) 'Aberration correction = '//ABCORR(I)
             WRITE(*,F1) ' '
             WRITE(*,F2) '  MRO-to-sub-observer vector in'
             WRITE(*,F2) '  MRO HIRISE look direction frame'
             WRITE(*,F1) '     X-component             (km) = ',
         .               MROVEC(1)
             WRITE(*,F1) '     Y-component             (km) = ',
         .               MROVEC(2)
             WRITE(*,F1) '     Z-component             (km) = ',
         .               MROVEC(3)
             WRITE(*,F1) '  Sub-observer point radius  (km) = ', RADIUS
             WRITE(*,F1) '  Planetocentric latitude   (deg) = ', LAT
             WRITE(*,F1) '  Planetocentric longitude  (deg) = ', LON
             WRITE(*,F1) '  Observer altitude          (km) = ', ALT

    C
    C        Consistency check: find the surface intercept on
    C        Mars of the ray emanating from the spacecraft and having
    C        direction vector MROVEC in the MRO HIRISE look direction
    C        reference frame at ET. Call the intercept point
    C        XPOINT. XPOINT should coincide with SPOINT, up to a
    C        small round-off error.
    C
             CALL <b>SINCPT</b> ( 'Ellipsoid', 'Mars', ET,    'IAU_MARS',
         .                 ABCORR(I),   'MRO',  HIREF, MROVEC,
         .                 XPOINT,      XEPOCH, XVEC,  FOUND  )

             IF ( .NOT. FOUND ) THEN
                WRITE (*,F1) 'Bug: no intercept'
             ELSE
    C
    C           Report the distance between XPOINT and SPOINT.
    C
                WRITE (*,F1) '  Intercept comparison error (km) = ',
         .                   <a href="vdist.html">VDIST</a>( XPOINT, SPOINT )
             END IF

             WRITE(*,F1) ' '

          END DO

          END


     When this program was executed on a PC/Linux/gfortran platform,
     the output was:


        Computation method = Near point: ellipsoid

        Aberration correction = LT+S

          MRO-to-sub-observer vector in
          MRO HIRISE look direction frame
             X-component             (km) =           0.286931987
             Y-component             (km) =          -0.260417167
             Z-component             (km) =         253.816284981
          Sub-observer point radius  (km) =        3388.299078207
          Planetocentric latitude   (deg) =         -38.799836879
          Planetocentric longitude  (deg) =        -114.995294746
          Observer altitude          (km) =         253.816580760
          Intercept comparison error (km) =           0.000002144


        Aberration correction = CN+S

          MRO-to-sub-observer vector in
          MRO HIRISE look direction frame
             X-component             (km) =           0.286931866
             Y-component             (km) =          -0.260417914
             Z-component             (km) =         253.816274506
          Sub-observer point radius  (km) =        3388.299078205
          Planetocentric latitude   (deg) =         -38.799836883
          Planetocentric longitude  (deg) =        -114.995294968
          Observer altitude          (km) =         253.816570285
          Intercept comparison error (km) =           0.000000001
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     A cautionary note: if aberration corrections are used, and 
     if DREF is the target body-fixed frame, the epoch at which that
     frame is evaluated is offset from ET by the light time between
     the observer and the *center* of the target body. This light time
     normally will differ from the light time between the observer and
     intercept point. Consequently the orientation of the target
     body-fixed frame at TRGEPC will not match that of the target
     body-fixed frame at the epoch associated with DREF. As a result,
     various derived quantities may not be as expected: for example,
     SRFVEC would not be parallel to DVEC.

     In many applications the errors arising from this frame
     discrepancy may be insignificant; however a safe approach is to
     always use as DREF a frame other than the target body-fixed
     frame.
     
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman   (JPL)
     S.C. Krening   (JPL)
     B.V. Semenov   (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 2.0.0, 31-MAR-2014 (NJB) (SCK) (BVS)

        Bug fix: FIRST is now set to .FALSE. at the completion
        of a successful initialization pass. This does not affect
        the routine's outputs but improves efficiency.

        Bug fix: redundant call to <a href="spkssb.html">SPKSSB</a> was removed. This does not
        affect the routine's outputs but improves efficiency.

        References to the new <a href="pxfrm2.html">PXFRM2</a> routine were added, which changed
        the Detailed Output section and the second example. Some header
        comment corrections were made.

        Upgrade: this routine now uses ZZVALCOR rather than
        ZZPRSCOR, simplifying the implementation.

        Upgrade: this routine now saves the input body names and
        ZZBODTRN state counters and does name-ID conversions only if
        the counters have changed.

        Upgrade: this routine now saves the input frame names and <a href="pool.html">POOL</a>
        state counters and does frame name-ID conversions only if the
        counters have changed.

    SPICELIB Version 1.2.0, 07-APR-2010 (NJB)

        Code style improvement: re-use of variables in 
        <a href="frinfo.html">FRINFO</a> calls has been eliminated. There is no impact 
        of the behavior of the routine.

    SPICELIB Version 1.1.0, 17-MAR-2009 (NJB)(EDW) 

        Bug fix: quick test for non-intersection is
        no longer performed when observer-target distance
        is less than target's maximum radius.

        Typos in the Detailed Input section's description of DREF
        were corrected.

        In the header examples, meta-kernel names were updated to use
        the suffix 

           &quot;.tm&quot;

        Incorrect frame name FIXFRM was changed to FIXREF in
        documentation.

        Typo correction in Required_Reading, changed FRAME 
        to FRAMES.

    SPICELIB Version 1.0.0, 02-MAR-2008 (NJB) </PRE>
<h4>Link to routine SINCPT source file <a href='../../../src/spicelib/sincpt.f'>sincpt.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Tue Jul 15 14:24:59 2014</pre>

</body>
</html>

