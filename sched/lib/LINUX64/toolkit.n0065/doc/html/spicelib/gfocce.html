
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>gfocce</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>gfocce</b> </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">

<small><div align="center">
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div></small>
       <br>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
            <small>
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Examples">Examples<br></a>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
             </small>
            </td>
          </tr>
        </tbody>
</table>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
      GFOCCE ( GF, occultation event )
 
      SUBROUTINE GFOCCE ( OCCTYP,  FRONT,   FSHAPE,  FFRAME,
     .                    BACK,    BSHAPE,  BFRAME,  ABCORR, 
     .                    OBSRVR,  TOL,     UDSTEP,  UDREFN,  
     .                    RPT,     UDREPI,  UDREPU,  UDREPF,  
     .                    BAIL,    UDBAIL,  CNFINE,  RESULT )
      
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Determine time intervals when an observer sees one target
     occulted by another. Report progress and handle interrupts
     if so commanded.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/frames.html">FRAMES</a>
     <a href="../req/gf.html">GF</a>
     <a href="../req/kernel.html">KERNEL</a>
     <a href="../req/naif_ids.html">NAIF_IDS</a>
     <a href="../req/spk.html">SPK</a>
     <a href="../req/time.html">TIME</a>
     <a href="../req/windows.html">WINDOWS</a>  
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     EVENT
     GEOMETRY
     SEARCH
     WINDOW
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
      IMPLICIT NONE

      INCLUDE 'gf.inc'

      INTEGER               LBCELL
      PARAMETER           ( LBCELL = -5 )

      CHARACTER*(*)         OCCTYP
      CHARACTER*(*)         FRONT
      CHARACTER*(*)         FSHAPE
      CHARACTER*(*)         FFRAME
      CHARACTER*(*)         BACK
      CHARACTER*(*)         BSHAPE
      CHARACTER*(*)         BFRAME
      CHARACTER*(*)         ABCORR
      CHARACTER*(*)         OBSRVR
      DOUBLE PRECISION      TOL
      EXTERNAL              UDSTEP
      EXTERNAL              UDREFN
      LOGICAL               RPT
      EXTERNAL              UDREPI
      EXTERNAL              UDREPU
      EXTERNAL              UDREPF
      LOGICAL               BAIL
      LOGICAL               UDBAIL
      EXTERNAL              UDBAIL
      DOUBLE PRECISION      CNFINE ( LBCELL : * )
      DOUBLE PRECISION      RESULT ( LBCELL : * )
 
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     VARIABLE  I/O  DESCRIPTION
     --------  ---  --------------------------------------------------
     LBCELL     P   SPICE Cell lower bound.
     OCCTYP     I   Type of occultation.
     FRONT      I   Name of body occulting the other.
     FSHAPE     I   Type of shape model used for front body.
     FFRAME     I   Body-fixed, body-centered frame for front body.
     BACK       I   Name of body occulted by the other.
     BSHAPE     I   Type of shape model used for back body.
     BFRAME     I   Body-fixed, body-centered frame for back body.
     ABCORR     I   Aberration correction flag.
     OBSRVR     I   Name of the observing body.
     TOL        I   Convergence tolerance in seconds.
     UDSTEP     I   Name of the routine that returns a time step.
     UDREFN     I   Name of the routine that computes a refined time.
     RPT        I   Progress report flag.
     UDREPI     I   Function that initializes progress reporting.
     UDREPU     I   Function that updates the progress report.
     UDREPF     I   Function that finalizes progress reporting.
     BAIL       I   Logical indicating program interrupt monitoring.
     UDBAIL     I   Name of a routine that signals a program interrupt.
     CNFINE     I   SPICE window to which the search is restricted.
     RESULT     O   SPICE window containing results.     
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     OCCTYP     indicates the type of occultation that is to be found.
                Supported values and corresponding definitions are:

                   'FULL'               denotes the full occultation
                                        of the body designated by 
                                        BACK by the body designated
                                        by FRONT, as seen from
                                        the location of the observer.
                                        In other words, the occulted
                                        body is completely invisible
                                        as seen from the observer's
                                        location.

                   'ANNULAR'            denotes an annular
                                        occultation: the body
                                        designated by FRONT blocks
                                        part of, but not the limb of,
                                        the body designated by BACK,
                                        as seen from the location of
                                        the observer.

                   'PARTIAL'            denotes an partial,
                                        non-annular occultation: the
                                        body designated by FRONT
                                        blocks part, but not all, of
                                        the limb of the body
                                        designated by BACK, as seen
                                        from the location of the
                                        observer.

                   'ANY'                denotes any of the above three
                                        types of occultations:
                                        'PARTIAL', 'ANNULAR', or
                                        'FULL'.

                                        'ANY' should be used to search
                                        for times when the body 
                                        designated by FRONT blocks
                                        any part of the body designated
                                        by BACK.

                                        The option 'ANY' must be used
                                        if either the front or back
                                        target body is modeled as
                                        a point.

                Case and leading or trailing blanks are not
                significant in the string OCCTYP.


     FRONT      is the name of the target body that occults---that is,
                passes in front of---the other. Optionally, you may
                supply the integer NAIF ID code for the body as a
                string. For example both 'MOON' and '301' are
                legitimate strings that designate the Moon.

                Case and leading or trailing blanks are not
                significant in the string FRONT.


     FSHAPE     is a string indicating the geometric model used
                to represent the shape of the front body. The
                supported options are:

                   'ELLIPSOID'     Use a triaxial ellipsoid model,
                                   with radius values provided via the
                                   kernel pool. A kernel variable 
                                   having a name of the form

                                      'BODYnnn_RADII' 

                                   where nnn represents the NAIF
                                   integer code associated with the
                                   body, must be present in the kernel
                                   pool. This variable must be
                                   associated with three numeric
                                   values giving the lengths of the
                                   ellipsoid's X, Y, and Z semi-axes.

                   'POINT'         Treat the body as a single point.
                                   When a point target is specified,
                                   the occultation type must be
                                   set to 'ANY'.
                                   
                At least one of the target bodies FRONT and BACK must
                be modeled as an ellipsoid.

                Case and leading or trailing blanks are not
                significant in the string FSHAPE.


     FFRAME     is the name of the body-fixed, body-centered reference
                frame associated with the front target body. Examples
                of such names are 'IAU_SATURN' (for Saturn) and
                'ITRF93' (for the Earth).

                If the front target body is modeled as a point, FFRAME
                should be left blank.

                Case and leading or trailing blanks are not
                significant in the string FFRAME.


     BACK       is the name of the target body that is occulted
                by---that is, passes in back of---the other.
                Optionally, you may supply the integer NAIF ID code
                for the body as a string. For example both 'MOON' and
                '301' are legitimate strings that designate the Moon.

                Case and leading or trailing blanks are not
                significant in the string BACK.


     BSHAPE     is the shape specification for the body designated
                by BACK. The supported options are those for
                FSHAPE. See the description of FSHAPE above for
                details.
                

     BFRAME     is the name of the body-fixed, body-centered reference
                frame associated with the ``back'' target body.  See
                the description of FFRAME above for details.
                Examples of such names are 'IAU_SATURN' (for Saturn)
                and 'ITRF93' (for the Earth).

                If the back target body is modeled as a point, BFRAME
                should be left blank.

                Case and leading or trailing blanks bracketing a
                non-blank frame name are not significant in the string
                BFRAME.


     ABCORR     indicates the aberration corrections to be applied to
                the state of the target body to account for one-way
                light time.  Stellar aberration corrections are
                ignored if specified, since these corrections don't
                improve the accuracy of the occultation determination.

                See the header of the SPICE routine <a href="spkezr.html">SPKEZR</a> for a
                detailed description of the aberration correction
                options. For convenience, the options supported by
                this routine are listed below:

                   'NONE'     Apply no correction.   

                   'LT'       &quot;Reception&quot; case:  correct for
                              one-way light time using a Newtonian
                              formulation.

                   'CN'       &quot;Reception&quot; case:  converged
                              Newtonian light time correction.

                   'XLT'      &quot;Transmission&quot; case:  correct for
                              one-way light time using a Newtonian
                              formulation.

                   'XCN'      &quot;Transmission&quot; case:  converged
                              Newtonian light time correction.

                Case and blanks are not significant in the string
                ABCORR.


     OBSRVR     is the name of the body from which the occultation is
                observed. Optionally, you may supply the integer NAIF
                ID code for the body as a string.
                
                Case and leading or trailing blanks are not
                significant in the string OBSRVR.


     TOL        is a tolerance value used to determine convergence of
                root-finding operations. TOL is measured in TDB seconds
                and must be greater than zero.


     UDSTEP     is an externally specified routine that computes a
                time step used to find transitions of the state being
                considered. A state transition occurs where the state
                changes from being &quot;in occultation&quot; to being &quot;not in
                occultation&quot; or vice versa.

                This routine relies on UDSTEP returning step sizes
                small enough so that state transitions within the
                confinement window are not overlooked.

                The calling sequence for UDSTEP is:

                   CALL UDSTEP ( ET, STEP )

                where:

                   ET      is the input start time from which the
                           algorithm is to search forward for a state
                           transition. ET is expressed as seconds past
                           J2000 TDB. ET is a DOUBLE PRECISION number.

                   STEP    is the output step size.  STEP indicates
                           how far to advance ET so that ET and
                           ET+STEP may bracket a state transition and
                           definitely do not bracket more than one
                           state transition. STEP is a DOUBLE
                           PRECISION number. Units are TDB seconds.

                If a constant step size is desired, the routine <a href="gfstep.html">GFSTEP</a>
                may be used. If <a href="gfstep.html">GFSTEP</a> is used, the step size must be
                set by calling <a href="gfsstp.html">GFSSTP</a> prior to calling this routine.


     UDREFN     is the name of the externally specified routine that
                refines the times that bracket a transition point. In
                other words, once a pair of times, T1 and T2, that
                bracket a state transition have been found, UDREFN
                computes an intermediate time T such that either 
                [T1, T] or [T, T2] contains the time of the state
                transition. The calling sequence for UDREFN is:

                   CALL UDREFN ( T1, T2, S1, S2, T )

                where the inputs are:

                   T1    is a time when the visibility state is S1. T1
                         is expressed as seconds past J2000 TDB.

                   T2    is a time when the visibility state is S2. T2
                         is expressed as seconds past J2000 TDB. and
                         is assumed to be larger than T1.

                   S1    is the visibility state at time T1. S1 is a
                         LOGICAL value.

                   S2    is the visibility state at time T2. S2 is a
                         LOGICAL value.

                The output is:

                   T     is the next time to check for a state
                         transition. T is expressed as seconds past
                         J2000 TDB and is between T1 and T2.

                If a simple bisection method is desired, the routine
                <a href="gfrefn.html">GFREFN</a> may be used.   


     RPT        is a logical variable which controls whether
                progress reporting is enabled. When RPT is .TRUE.,
                progress reporting is enabled and the routines
                UDREPI, UDREPU, and UDPREF (see descriptions below)
                are used to report progress. 
 

     UDREPI     is a user-defined subroutine that initializes a
                progress report. When progress reporting is 
                enabled, UDREPI is called at the start
                of a search. The calling sequence of UDREPI is
 
                   UDREPI ( CNFINE, SRCPRE, SRCSUF )

                   DOUBLE PRECISION    CNFINE ( LBCELL : * )
                   CHARACTER*(*)       SRCPRE
                   CHARACTER*(*)       SRCSUF

                where

                   CNFINE 

                is the confinement window and
 
                   SRCPRE
                   SRCSUF

                are prefix and suffix strings used in the progress
                report: these strings are intended to bracket a
                representation of the fraction of work done.  For
                example, when the CSPICE progress reporting functions
                are used, if srcpre and srcsuf are, respectively,

                   &quot;Occultation search&quot;
                   &quot;done.&quot;

                the progress report display at the end of the
                search will be:

                   FOV search 100.00% done.

                The SPICELIB routine <a href="gfrepi.html">GFREPI</a> may be used as the 
                actual argument corresponding to UDREPI. If so,
                the SPICELIB routines <a href="gfrepu.html">GFREPU</a> and <a href="gfrepf.html">GFREPF</a> must be
                the actual arguments corresponding to UDREPU and
                UDREPF.

              
     UDREPU     is a user-defined subroutine that updates the 
                progress report for a search.  The calling sequence 
                of UDREPU is
 
                   UDREPU ( IVBEG, IVEND, ET )

                   DOUBLE PRECISION      IVBEG
                   DOUBLE PRECISION      IVEND
                   DOUBLE PRECISION      ET  

                Here IVBEG, IVEND are the bounds of an interval that
                is contained in some interval belonging to the
                confinement window. The confinement window is
                associated with some root finding activity. It is used
                to determine how much total time is being searched in
                order to find the events of interest.

                ET is an epoch belonging to the interval 
                [IVBEG, IVEND].

                In order for a meaningful progress report to be
                displayed, IVBEG and IVEND must satisfy the following
                constraints:

                 - IVBEG must be less than or equal to IVEND.

                 - The interval [ IVBEG, IVEND ] must be contained in
                   some interval of the confinement window. It can be
                   a proper subset of the containing interval; that
                   is, it can be smaller than the interval of the
                   confinement window that contains it.

                 - Over a search, the sum of the differences

                      IVEND - IVBEG

                   for all calls to this routine made during the search
                   must equal the measure of the confinement window.

                The SPICELIB routine <a href="gfrepu.html">GFREPU</a> may be used as the 
                actual argument corresponding to UDREPU. If so,
                the SPICELIB routines <a href="gfrepi.html">GFREPI</a> and <a href="gfrepf.html">GFREPF</a> must be
                the actual arguments corresponding to UDREPI and
                UDREPF.


     UDREPF     is a user-defined subroutine that finalizes a
                progress report. UDREPF has no arguments.

                The SPICELIB routine <a href="gfrepf.html">GFREPF</a> may be used as the 
                actual argument corresponding to UDREPF. If so,
                the SPICELIB routines <a href="gfrepi.html">GFREPI</a> and <a href="gfrepu.html">GFREPU</a> must be
                the actual arguments corresponding to UDREPI and
                UDREPU. 


     BAIL       is a logical variable indicating whether or not
                interrupt handling is enabled. When BAIL is
                set to .TRUE., the input function UDBAIL (see
                description below) is used to determine whether
                an interrupt has been issued.


     UDBAIL     is the name of a user defined logical function that
                indicates whether an interrupt signal has been 
                issued (for example, from the keyboard).  UDBAIL
                has no arguments and returns a LOGICAL value.
                The return value is .TRUE. if an interrupt has
                been issued; otherwise the value is .FALSE.

                <b>GFOCCE</b> uses UDBAIL only when BAIL (see above) is set
                to .TRUE., indicating that interrupt handling is
                enabled. When interrupt handling is enabled, <b>GFOCCE</b>
                and routines in its call tree will call UDBAIL to
                determine whether to terminate processing and return
                immediately.
                
                If interrupt handing is not enabled, a logical
                function must still be passed to <b>GFOCCE</b> as
                an input argument. The SPICE function 

                   <a href="gfbail.html">GFBAIL</a>
        
                may be used for this purpose.


     CNFINE     is a SPICE window that confines the time period over
                which the specified search is conducted. CNFINE may
                consist of a single interval or a collection of 
                intervals. 

                The endpoints of the time intervals comprising CNFINE
                are interpreted as seconds past J2000 TDB..
                
                See the Examples section below for a code example 
                that shows how to create a confinement window.
                
                CNFINE must be initialized by the caller via the
                SPICELIB routine <a href="ssized.html">SSIZED</a>.

       
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     RESULT     is a SPICE window representing the set of time
                intervals, within the confinement period, when the
                specified occultation occurs. 

                The endpoints of the time intervals comprising RESULT
                are interpreted as seconds past J2000 TDB.

                If RESULT is non-empty on input, its contents
                will be discarded before <b>GFOCCE</b> conducts its
                search.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     LBCELL     is the SPICELIB cell lower bound.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  In order for this routine to produce correct results,
         the step size must be appropriate for the problem at hand.
         Step sizes that are too large may cause this routine to miss
         roots; step sizes that are too small may cause this routine
         to run unacceptably slowly and in some cases, find spurious
         roots.

         This routine does not diagnose invalid step sizes, except
         that if the step size is non-positive, the error
         SPICE(INVALIDSTEP) will be signaled.

     2)  Due to numerical errors, in particular,

            - Truncation error in time values
            - Finite tolerance value
            - Errors in computed geometric quantities

         it is *normal* for the condition of interest to not always be
         satisfied near the endpoints of the intervals comprising the
         result window.

         The result window may need to be contracted slightly by the
         caller to achieve desired results. The SPICE window routine
         <a href="wncond.html">WNCOND</a> can be used to contract the result window.

     3)  If name of either target or the observer cannot be translated
         to a NAIF ID code, the error SPICE(IDCODENOTFOUND) is
         signaled.
         
     4)  If the radii of a target body modeled as an ellipsoid cannot
         be determined by searching the kernel pool for a kernel
         variable having a name of the form

            'BODYnnn_RADII' 

         where nnn represents the NAIF integer code associated with
         the body, the error will be diagnosed by a routine in the
         call tree of this routine.

     5)  If either of the target bodies FRONT or BACK coincides with
         the observer body OBSRVR, the error SPICE(BODIESNOTDISTINCT)
         will be signaled.

     6)  If the body designated by FRONT coincides with that
         designated by BACK, the error SPICE(BODIESNOTDISTINCT) will
         be signaled.
         
     7)  If either of the body model specifiers FSHAPE or BSHAPE
         is not recognized, the error SPICE(INVALIDSHAPE) will be
         signaled.

     8)  If both of the body model specifiers FSHAPE and BSHAPE
         specify point targets, the error SPICE(INVALIDSHAPECOMBO)
         will be signaled.

     9)  If a target body-fixed reference frame associated with a 
         non-point target is not recognized, the error will be
         diagnosed by a routine in the call tree of this routine.

     10) If a target body-fixed reference frame is not centered at
         the corresponding target body,  the error will be
         diagnosed by a routine in the call tree of this routine.

     11) If the loaded kernels provide insufficient data to 
         compute the requested state vector, the deficiency will
         be diagnosed by a routine in the call tree of this routine.

     12) If an error occurs while reading an SPK or other kernel file,
         the error will be diagnosed by a routine in the call tree 
         of this routine.

     13) If a point target is specified and the occultation
         type is set to a valid value other than 'ANY', the
         error SPICE(BADTYPESHAPECOMBO) will be signaled.

     14) If the output SPICE window RESULT has insufficient capacity
         to contain the number of intervals on which the specified
         visibility condition is met, the error will be diagnosed
         by a routine in the call tree of this routine. If the result
         window has size less than 2, the error SPICE(WINDOWTOOSMALL)
         will be signaled by this routine.
 
     15) Invalid occultation types will be diagnosed by a routine in
         the call tree of this routine.

     16) Invalid aberration correction specifications will be
         diagnosed by a routine in the call tree of this routine.

     17) If the convergence tolerance size is non-positive, the error
         SPICE(INVALIDTOLERANCE) will be signaled.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     Appropriate kernels must be loaded by the calling program before
     this routine is called.

     The following data are required:

        - SPK data: the calling application must load ephemeris data
          for the target, source and observer that cover the time
          period specified by the window CNFINE. If aberration
          corrections are used, the states of target and observer
          relative to the solar system barycenter must be calculable
          from the available ephemeris data. Typically ephemeris data
          are made available by loading one or more SPK files via
          <a href="furnsh.html">FURNSH</a>.

        - PCK data: bodies modeled as triaxial ellipsoids must have
          semi-axis lengths provided by variables in the kernel pool.
          Typically these data are made available by loading a text
          PCK file via <a href="furnsh.html">FURNSH</a>.

        - FK data: if either of the reference frames designated by
          BFRAME or FFRAME are not built in to the SPICE system,
          one or more FKs specifying these frames must be loaded. 

     Kernel data are normally loaded once per program run, NOT every
     time this routine is called.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine provides the SPICE GF system's most flexible
     interface for searching for occultation events.
   
     Applications that require do not require support for progress
     reporting, interrupt handling, non-default step or refinement
     functions, or non-default convergence tolerance normally should
     call <a href="gfoclt.html">GFOCLT</a> rather than this routine.

     This routine determines a set of one or more time intervals
     within the confinement window when a specified type of
     occultation occurs. The resulting set of intervals is returned as
     a SPICE window.

     Below we discuss in greater detail aspects of this routine's
     solution process that are relevant to correct and efficient
     use of this routine in user applications.
     

     The Search Process
     ==================

     The search for occultations is treated as a search for state
     transitions: times are sought when the state of the BACK body
     changes from &quot;not occulted&quot; to &quot;occulted&quot; or vice versa.

     Step Size
     =========

     Each interval of the confinement window is searched as follows:
     first, the input step size is used to determine the time
     separation at which the occultation state will be sampled.
     Starting at the left endpoint of an interval, samples will be
     taken at each step. If a state change is detected, a root has
     been bracketed; at that point, the &quot;root&quot;--the time at which the
     state change occurs---is found by a refinement process, for
     example, via binary search.

     Note that the optimal choice of step size depends on the lengths
     of the intervals over which the occultation state is constant:
     the step size should be shorter than the shortest occultation
     duration and the shortest period between occultations, within
     the confinement window.

     Having some knowledge of the relative geometry of the targets and
     observer can be a valuable aid in picking a reasonable step size.
     In general, the user can compensate for lack of such knowledge by
     picking a very short step size; the cost is increased computation
     time.

     Note that the step size is not related to the precision with which
     the endpoints of the intervals of the result window are computed.
     That precision level is controlled by the convergence tolerance.


     Convergence Tolerance
     =====================

     Once a root has been bracketed, a refinement process is used to
     narrow down the time interval within which the root must lie.
     This refinement process terminates when the location of the root
     has been determined to within an error margin called the
     &quot;convergence tolerance.&quot; 

     The convergence tolerance used by high-level GF routines that
     call this routine is set via the parameter CNVTOL, which is
     declared in the INCLUDE file gf.inc. The value of CNVTOL is set
     to a &quot;tight&quot; value so that the tolerance doesn't become the
     limiting factor in the accuracy of solutions found by this
     routine. In general the accuracy of input data will be the
     limiting factor.

     Setting the input tolerance TOL tighter than CNVTOL is unlikely
     to be useful, since the results are unlikely to be more accurate.
     Making the tolerance looser will speed up searches somewhat,
     since a few convergence steps will be omitted. However, in most
     cases, the step size is likely to have a much greater effect on
     processing time than would the convergence tolerance.


     The Confinement Window
     ======================

     The simplest use of the confinement window is to specify a time
     interval within which a solution is sought. However, the
     confinement window can, in some cases, be used to make searches
     more efficient. Sometimes it's possible to do an efficient search
     to reduce the size of the time period over which a relatively
     slow search of interest must be performed. For an example, see
     the program CASCADE in the GF Example Programs chapter of the GF
     Required Reading, gf.req.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for these examples may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine 
     specific arithmetic implementation. 

     1) Conduct a search using the default GF progress reporting 
        capability.

        The program will use console I/O to display a simple
        ASCII-based progress report.

        The program will find occultations of the Sun by the Moon as
        seen from the center of the Earth over the month December,
        2001.

        We use light time corrections to model apparent positions of
        Sun and Moon. Stellar aberration corrections are not specified
        because they don't affect occultation computations.

        Use the meta-kernel shown below to load the required SPICE
        kernels.

           KPL/MK

           File name: <a href= "standard.html">standard.tm</a>

           This meta-kernel is intended to support operation of SPICE
           example programs. The kernels shown here should not be
           assumed to contain adequate or correct versions of data
           required by SPICE-based user applications.

           In order for an application to use this meta-kernel, the
           kernels referenced here must be present in the user's
           current working directory.


           \begindata

              KERNELS_TO_LOAD = ( 'de421.bsp',
                                  'pck00008.tpc',
                                  'naif0009.tls'  )

           \begintext


       Example code begins here.


              PROGRAM EX1

              IMPLICIT NONE

              EXTERNAL              <a href="gfstep.html">GFSTEP</a>
              EXTERNAL              <a href="gfrefn.html">GFREFN</a>
              EXTERNAL              <a href="gfrepi.html">GFREPI</a>
              EXTERNAL              <a href="gfrepu.html">GFREPU</a>
              EXTERNAL              <a href="gfrepf.html">GFREPF</a>

              INTEGER               <a href="wncard.html">WNCARD</a>
              LOGICAL               <a href="gfbail.html">GFBAIL</a>
              EXTERNAL              <a href="gfbail.html">GFBAIL</a>


              CHARACTER*(*)         TIMFMT
              PARAMETER           ( TIMFMT =
             .   'YYYY MON DD HR:MN:SC.###### ::TDB (TDB)' )

              DOUBLE PRECISION      CNVTOL
              PARAMETER           ( CNVTOL = 1.D-6 )

              INTEGER               MAXWIN
              PARAMETER           ( MAXWIN = 2 * 100 )

              INTEGER               TIMLEN
              PARAMETER           ( TIMLEN = 40 )

              INTEGER               LBCELL
              PARAMETER           ( LBCELL = -5 )

              CHARACTER*(TIMLEN)    WIN0
              CHARACTER*(TIMLEN)    WIN1
              CHARACTER*(TIMLEN)    BEGSTR
              CHARACTER*(TIMLEN)    ENDSTR

              DOUBLE PRECISION      CNFINE ( LBCELL : MAXWIN )
              DOUBLE PRECISION      ET0
              DOUBLE PRECISION      ET1
              DOUBLE PRECISION      LEFT
              DOUBLE PRECISION      RESULT ( LBCELL : MAXWIN )
              DOUBLE PRECISION      RIGHT

              INTEGER               I

              LOGICAL               BAIL
              LOGICAL               RPT

        C
        C     Load kernels.
        C
              CALL <a href="furnsh.html">FURNSH</a> ( '<a href= "standard.html">standard.tm</a>' )

        C
        C     Initialize the confinement and result windows.
        C
              CALL <a href="ssized.html">SSIZED</a> ( MAXWIN, CNFINE )
              CALL <a href="ssized.html">SSIZED</a> ( MAXWIN, RESULT )

        C
        C     Obtain the TDB time bounds of the confinement
        C     window, which is a single interval in this case.
        C
              WIN0 = '2001 DEC 01 00:00:00 TDB'
              WIN1 = '2002 JAN 01 00:00:00 TDB'

              CALL <a href="str2et.html">STR2ET</a> ( WIN0, ET0 )
              CALL <a href="str2et.html">STR2ET</a> ( WIN1, ET1 )

        C
        C     Insert the time bounds into the confinement
        C     window.
        C
              CALL <a href="wninsd.html">WNINSD</a> ( ET0, ET1, CNFINE )

        C
        C     Select a 20 second step. We'll ignore any occultations
        C     lasting less than 20 seconds.
        C
              CALL <a href="gfsstp.html">GFSSTP</a> ( 20.D0 )

        C
        C     Turn on progress reporting; turn off interrupt
        C     handling.
        C
              RPT  = .TRUE.
              BAIL = .FALSE.

        C
        C     Perform the search.
        C
              CALL <b>GFOCCE</b> ( 'ANY',
             .              'MOON',   'ellipsoid',  'IAU_MOON',
             .              'SUN',    'ellipsoid',  'IAU_SUN',
             .              'LT',     'EARTH',      CNVTOL,
             .              <a href="gfstep.html">GFSTEP</a>,   <a href="gfrefn.html">GFREFN</a>,       RPT,
             .              <a href="gfrepi.html">GFREPI</a>,   <a href="gfrepu.html">GFREPU</a>,       <a href="gfrepf.html">GFREPF</a>,
             .              BAIL,     <a href="gfbail.html">GFBAIL</a>,       CNFINE,  RESULT )


              IF ( <a href="wncard.html">WNCARD</a>(RESULT) .EQ. 0 ) THEN

                 WRITE (*,*) 'No occultation was found.'

              ELSE

                 DO I = 1, <a href="wncard.html">WNCARD</a>(RESULT)
        C
        C           Fetch and display each occultation interval.
        C
                    CALL <a href="wnfetd.html">WNFETD</a> ( RESULT, I, LEFT, RIGHT )

                    CALL <a href="timout.html">TIMOUT</a> ( LEFT,  TIMFMT, BEGSTR )
                    CALL <a href="timout.html">TIMOUT</a> ( RIGHT, TIMFMT, ENDSTR )

                    WRITE (*,*) 'Interval ', I
                    WRITE (*,*) '   Start time: '//BEGSTR
                    WRITE (*,*) '   Stop time:  '//ENDSTR

                 END DO

              END IF

              END


     When this program was executed on a PC/Linux/g77 platform, the
     progress report had the format shown below:

        Occultation/transit search   6.02% done.

     The completion percentage was updated approximately once per
     second.

     When this program completed execution, the output was:

        Occultation/transit search 100.00% done.
         Interval  1
            Start time: 2001 DEC 14 20:10:14.195952  (TDB)
            Stop time:  2001 DEC 14 21:35:50.317994  (TDB)
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     1) If the caller passes in the default, constant step 
        size routine, <a href="gfstep.html">GFSTEP</a>, the caller must set the step
        size by calling the entry point <a href="gfsstp.html">GFSSTP</a> before
        calling <b>GFOCCE</b>. The call syntax for <a href="gfsstp.html">GFSSTP</a> is

           CALL <a href="gfsstp.html">GFSSTP</a> ( STEP )
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman   (JPL)
     L.S. Elson     (JPL)
     W.L. Taber     (JPL)
     I.M. Underwood (JPL)
     E.D. Wright    (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.0.0 15-APR-2009 (NJB) (LSE) (WLT) (IMU) (EDW) </PRE>
<h4>Link to routine GFOCCE source file <a href='../../../src/spicelib/gfocce.f'>gfocce.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Tue Jul 15 14:24:24 2014</pre>

</body>
</html>

