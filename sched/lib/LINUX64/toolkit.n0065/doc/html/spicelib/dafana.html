
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>dafana</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>dafana</b> </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">

<small><div align="center">
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div></small>
       <br>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
            <small>
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </small>
              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">
              <small>               <a href="#Examples">Examples<br></a>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
             </small>
            </td>
          </tr>
        </tbody>
</table>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
 DAFANA ( DAF, add new array )
 
      SUBROUTINE DAFANA ( HANDLE, SUM, NAME, DATA, N )
 
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Add a new array to an existing DAF.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/daf.html">DAF</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     FILES
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
 
      INCLUDE              'zzddhman.inc'
 
      INTEGER               HANDLE
      DOUBLE PRECISION      SUM      ( * )
      CHARACTER*(*)         NAME
      DOUBLE PRECISION      DATA     ( * )
      INTEGER               N
 
      INTEGER               TBSIZE
      PARAMETER           ( TBSIZE =   20  )
 
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     Variable  I/O  Entry
     --------  ---  --------------------------------------------------
     HANDLE     I   <a href="dafbna.html">DAFBNA</a>, <a href="dafcad.html">DAFCAD</a>
     SUM        I   <a href="dafbna.html">DAFBNA</a>
     NAME       I   <a href="dafbna.html">DAFBNA</a>
     DATA       I   <a href="dafada.html">DAFADA</a>
     N          I   <a href="dafada.html">DAFADA</a>
     TBSIZE     P   <b>DAFANA</b>
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     HANDLE      is the handle of a DAF opened for write access
                 by a previous call to <a href="dafopw.html">DAFOPW</a> or <a href="dafopn.html">DAFOPN</a>.

     SUM         is the summary for the array being added.

     NAME        is the name of the array being added.

     DATA        contains all or part of the data in the array.

     N           is the number of elements in DATA.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     TBSIZE      is the size of the file table maintained internally
                 by <b>DAFANA</b>,  TBSIZE is the maximum number of DAFs
                 that can be in use simultaneously by this routine.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1) If <b>DAFANA</b> is called directly, the error SPICE(BOGUSENTRY)
        is signalled.

     2) See entry points <a href="dafbna.html">DAFBNA</a>, <a href="dafada.html">DAFADA</a>, <a href="dafena.html">DAFENA</a>, and <a href="dafcad.html">DAFCAD</a>
        for exceptions specific to those entry points.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     See argument HANDLE, above.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     <b>DAFANA</b> serves as an umbrella, allowing data to be shared by its
     entry points:

        <a href="dafbna.html">DAFBNA</a>         Begin new array.
        <a href="dafada.html">DAFADA</a>         Add data to array.
        <a href="dafcad.html">DAFCAD</a>         Continue adding data.
        <a href="dafena.html">DAFENA</a>         End new array.

     The main function of these entry points is to simplify the
     addition of new arrays to existing DAFs.

     An application can add data to a single DAF, or to multiple DAFs,
     simultaneously.  In the case of writing to a single DAF, the
     creation of a new array requires four steps:

        1) Open a DAF for write access, using either <a href="dafopw.html">DAFOPW</a>
           (if the file already exists) or <a href="dafopn.html">DAFOPN</a> (if it does not).

              CALL <a href="dafopw.html">DAFOPW</a> ( FNAME, HANDLE )

        2) Begin the new DAF by calling <a href="dafbna.html">DAFBNA</a>,

              CALL <a href="dafbna.html">DAFBNA</a> ( HANDLE, SUM, NAME )

        3) Add data to the array by calling <a href="dafada.html">DAFADA</a> as many times
           as necessary,

              CALL GET_DATA ( DATA, N, FOUND )

              DO WHILE ( FOUND )
                 CALL <a href="dafada.html">DAFADA</a>   ( DATA, N        )
                 CALL GET_DATA ( DATA, N, FOUND )
              END DO

        4) End the array by calling <a href="dafena.html">DAFENA</a>,

              CALL <a href="dafena.html">DAFENA</a>

     Note that the data can be added in chunks of any size, so long
     as the chunks are ordered correctly.

     In applications that add data to multiple DAFs simultaneously, it
     is necessary to specify which DAF to add data to.  The <b>DAFANA</b>
     entry points that allow specification of a DAF via a file handle
     argument are <a href="dafbna.html">DAFBNA</a> (DAF, begin new array) and <a href="dafcad.html">DAFCAD</a> (DAF,
     continue adding data).  As in the single-DAF case, arrays are
     started by calls to <a href="dafbna.html">DAFBNA</a>, and data is added to arrays by calls
     to <a href="dafada.html">DAFADA</a>.  The last DAF designated by the input file handle
     supplied to <a href="dafbna.html">DAFBNA</a> or <a href="dafcad.html">DAFCAD</a> is the `current DAF'.  If a
     DAF contains an array started by a call to <a href="dafbna.html">DAFBNA</a> but not yet
     completed by a call to <a href="dafena.html">DAFENA</a>, we call this array the `current
     array' for that DAF.  Each call to <a href="dafada.html">DAFADA</a> will add data to the
     current array in the current DAF.  A call to <a href="dafena.html">DAFENA</a> will make the
     current array in the current DAF a permanent addition to that DAF.

     The notion of `current DAF' as discussed here applies only to
     DAFs acted upon by entry points of <b>DAFANA</b>.  In <a href="daffa.html">DAFFA</a>, there is a
     DAF that is treated as the `current DAF' for searching; there is
     no connection between the DAFs regarded as current by <b>DAFANA</b> and
     <a href="daffa.html">DAFFA</a>.

     In the following example, we write data obtained from the routine
     GET_DATA into two separate DAFs.  The first N/2 elements of the
     array DATA will be written to the first DAF; the rest of the
     array will be written to the second DAF.


        1) Open the DAFs for write access, using either <a href="dafopw.html">DAFOPW</a>
           (if the files already exist) or <a href="dafopn.html">DAFOPN</a> (if they do not).

              CALL <a href="dafopw.html">DAFOPW</a> ( FNAME1, HANDL1 )
              CALL <a href="dafopw.html">DAFOPW</a> ( FNAME2, HANDL2 )

        2) Begin the new DAFs by calling <a href="dafbna.html">DAFBNA</a>,

              CALL <a href="dafbna.html">DAFBNA</a> ( HANDL1, SUM1, NAME1 )
              CALL <a href="dafbna.html">DAFBNA</a> ( HANDL2, SUM2, NAME2 )

        3) Add data to the arrays by calling <a href="dafcad.html">DAFCAD</a> and <a href="dafada.html">DAFADA</a> as many
           times as necessary, selecting the file to add data to by
           calling <a href="dafcad.html">DAFCAD</a>:

              CALL GET_DATA ( DATA, N, FOUND )

              DO WHILE ( FOUND )

                 CALL <a href="dafcad.html">DAFCAD</a>   ( HANDL1                          )
                 CALL <a href="dafada.html">DAFADA</a>   ( DATA,               N/2         )

                 CALL <a href="dafcad.html">DAFCAD</a>   ( HANDL2                          )
                 CALL <a href="dafada.html">DAFADA</a>   ( DATA( N/2 + 1 ),    N - N/2     )

                 CALL GET_DATA ( DATA, N, FOUND )

              END DO

        4) End each array by calling <a href="dafena.html">DAFENA</a>, selecting the file
           in which to end the array by calling <a href="dafcad.html">DAFCAD</a>:

              CALL <a href="dafcad.html">DAFCAD</a> ( HANDL1 )
              CALL <a href="dafena.html">DAFENA</a>

              CALL <a href="dafcad.html">DAFCAD</a> ( HANDL2 )
              CALL <a href="dafena.html">DAFENA</a>
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     1)  The following code fragment illustrates one possible way
         to copy an array from one DAF (with handle ORIGIN) to another
         (with handle COPY), SIZE words at a time.

            CALL <a href="dafgs.html">DAFGS</a>  ( SUM  )
            CALL <a href="dafgn.html">DAFGN</a>  ( NAME )
            CALL <a href="dafhsf.html">DAFHSF</a> ( ORIGIN, ND, NI )
            CALL <a href="dafus.html">DAFUS</a>  ( SUM,    ND, NI, DC, IC )

            BEGIN = IC(NI-1)
            END   = IC(NI  )

            CALL <a href="dafbna.html">DAFBNA</a> ( COPY, SUM, NAME )

            DO WHILE ( BEGIN .LE. END )
               CHUNK = MIN ( BEGIN + SIZE - 1, END )

               CALL <a href="dafrda.html">DAFRDA</a> ( ORIGIN, BEGIN, CHUNK, DATA )
               CALL <a href="dafada.html">DAFADA</a> ( DATA,   SIZE )

               BEGIN = BEGIN + SIZE
            END DO

            CALL <a href="dafena.html">DAFENA</a>


     2)  A simple example demonstrating simultaneous addition
         of data to multiple DAFs.  We read data from a text
         file containing three columns of numbers, and we write
         the data from each column out to a separate DAF.  The
         format of the input text file is as follows:

            +-                   -+
            |  n11    n12    n13  |
            |  n21    n22    n23  |
            |   .      .      .   |
            |   .      .      .   |
            |   .      .      .   |
            +-                   -+

         Here the symbol nij indicates the jth number on the ith line
         of the file.

         The delimiters between the numbers in each column may be
         commas or blanks.

         The input file is called NUMBERS.TXT.  The output files are
         called

            COLUMN1.DAF
            COLUMN2.DAF
            COLUMN3.DAF

         To confirm that the DAFs created by this program contain the
         correct contents, we will read the data from each DAF and
         combine it to create a new text file call RESULT.TXT.  This
         file should contain the same data as NUMBERS.TXT.  If
         RESULT.TXT is copied as NUMBERS.TXT and used as the input for
         a second run of this program, the output file RESULT.TXT
         from the second program run should match, up to round-off
         error in the numbers, the input file NUMBERS.TXT containing
         the output of the first program run.  If the numbers in
         NUMBERS.TXT are integers, the match should be exact.


                  PROGRAM WRTDAF
            C
            C     Read columns of d.p. numbers from a text file
            C     and write the data from each column into a
            C     separate DAF.  Read these DAFs and create a
            C     second text file containing the same data as
            C     the input text file.
            C
            C     Since we do not need to retain any descriptive
            C     information about the DAFs inside of the files
            C     themselves, we'll use a summary format having
            C     two integer components (the minimum--these are
            C     reserved for use by the DAF routines) and zero
            C     double precision components.
            C
            C     The internal file names and array names will
            C     simply indicate the data sources.
            C

            C
            C     Local parameters
            C
                  INTEGER               FNMLEN
                  PARAMETER           ( FNMLEN = 20 )

                  INTEGER               LINLEN
                  PARAMETER           ( LINLEN = 80 )

                  INTEGER               MAXCOL
                  PARAMETER           ( MAXCOL =  3 )

                  INTEGER               ND
                  PARAMETER           ( ND     =  0 )

                  INTEGER               NDAF
                  PARAMETER           ( NDAF   =  3 )

                  INTEGER               NI
                  PARAMETER           ( NI     =  2 )

                  INTEGER               NUMLEN
                  PARAMETER           ( NUMLEN = 30 )

                  INTEGER               SIG
                  PARAMETER           ( SIG    = 14 )

            C
            C     Local variables
            C
                  CHARACTER*(FNMLEN)    DAF    ( NDAF   )
                  CHARACTER*(FNMLEN)    INFILE
                  CHARACTER*(LINLEN)    LINE
                  CHARACTER*(NUMLEN)    NUMCH  ( MAXCOL )
                  CHARACTER*(LINLEN)    PRSERR
                  CHARACTER*(FNMLEN)    RESULT

                  DOUBLE PRECISION      DC     ( 1      )
                  DOUBLE PRECISION      NUMBER ( MAXCOL )
                  DOUBLE PRECISION      SUMMRY ( 1      )

                  INTEGER               FA
                  INTEGER               HAN    ( NDAF   )
                  INTEGER               I
                  INTEGER               IA
                  INTEGER               IC     ( NI     )
                  INTEGER               J
                  INTEGER               LENGTH
                  INTEGER               NCOLS
                  INTEGER               PTR

                  LOGICAL               EOF
                  LOGICAL               FOUND

            C
            C     Initial values
            C
                  DATA   DAF     /  'COLUMN1.DAF',
                 .                  'COLUMN2.DAF',
                 .                  'COLUMN3.DAF'  /

                  DATA   INFILE  /  'NUMBERS.TXT'  /
                  DATA   RESULT  /  'RESULT.TXT'   /


            C
            C     Use SPICELIB call tracing.
            C
                  CALL CHKIN ( 'WRTDAF' )

            C
            C     Create the new DAFs, and start a new array in each
            C     one.  Just use the file name for the internal file
            C     name and array name, for each DAF.  No assignments
            C     are required for the array summaries.
            C
                  DO I = 1, 3
                     CALL <a href="dafopn.html">DAFOPN</a> ( DAF(I), ND, NI, DAF(I), 0, HAN(I) )
                     CALL <a href="dafbna.html">DAFBNA</a> ( HAN(I), SUMMRY, DAF(I)            )
                  END DO

            C
            C     Now read numbers from the text file, line by line,
            C     and add the numbers from each column to the
            C     corresponding DAF.
            C
                  CALL RDTEXT ( INFILE, LINE, EOF )

                  DO WHILE ( .NOT. EOF )
            C
            C        Parse the numbers in the input line.  They
            C        may be separated by commas or blanks (the second
            C        argument of <a href="lparsm.html">LPARSM</a> is a list of allowed
            C        delimiters).  Parse the strings found by <a href="lparsm.html">LPARSM</a>.
            C
            C        For brevity, we won't check the number of columns
            C        found, or the parse error flag.
            C
                     CALL <a href="lparsm.html">LPARSM</a> ( LINE, ' ,', MAXCOL, NCOLS, NUMCH )

                     DO I = 1, NCOLS
                        CALL <a href="nparsd.html">NPARSD</a> ( NUMCH(I), NUMBER(I), PRSERR, PTR)
                     END DO

            C
            C        Add the number from the ith column to the array
            C        in the ith DAF.  We'll use <a href="dafcad.html">DAFCAD</a> to select
            C        the correct DAF to add data to.
            C
                     DO I = 1, NDAF
                        CALL <a href="dafcad.html">DAFCAD</a> ( HAN(I)       )
                        CALL <a href="dafada.html">DAFADA</a> ( NUMBER(I), 1 )
                     END DO

            C
            C        Get the next line.
            C
                     CALL RDTEXT ( INFILE, LINE, EOF )

                  END DO

            C
            C     Finish (`end') the arrays.  Again, we'll use <a href="dafcad.html">DAFCAD</a>
            C     to select the DAFs in which the arrays are to be
            C     finished.  After finishing each array, close the DAF
            C     containing it.
            C
                  DO I = 1, NDAF
                     CALL <a href="dafcad.html">DAFCAD</a> ( HAN(I) )
                     CALL <a href="dafena.html">DAFENA</a>
                     CALL <a href="dafcls.html">DAFCLS</a> ( HAN(I) )
                  END DO

            C
            C     Now for the verification step.  We'll try to
            C     build a text file containing the same data as
            C     the orginal input file.  The format of the numbers,
            C     the delimiters separating the numbers, spacing, and
            C     non-printing characters may differ.  However, if this
            C     file is used as the input file, and if the numbers
            C     used in the file are integers, WRTDAF will create an
            C     exact copy of it.
            C

            C
            C     Open the DAFs for reading.
            C
                  DO I = 1, NDAF
                     CALL <a href="dafopr.html">DAFOPR</a> ( DAF(I), HAN(I) )
                  END DO

            C
            C     Obtain the start and end addresses of the
            C     data in each DAF.  To do this, we'll need to
            C     obtain and unpack the array summaries.
            C
            C     If all went well, the addresses should be the
            C     same for each DAF.  We'll assume that the initial
            C     and final addresses in the first DAF are correct
            C     for all three.
            C
                  CALL <a href="dafbfs.html">DAFBFS</a> ( HAN(1) )
                  CALL <a href="daffna.html">DAFFNA</a> ( FOUND  )
                  CALL <a href="dafgs.html">DAFGS</a>  ( SUMMRY )
                  CALL <a href="dafus.html">DAFUS</a>  ( SUMMRY, ND, NI, DC, IC )

                  IA      =  IC( NI-1 )
                  FA      =  IC( NI   )
                  LENGTH  =  FA - IA + 1

            C
            C     Now read numbers from the DAFs and build up
            C     lines of text.  Write these lines out to our
            C     output text file.
            C
                  DO I = 0,  LENGTH - 1

                     LINE = ' '

                     DO J = 1, NDAF
                        CALL <a href="dafrda.html">DAFRDA</a> ( HAN(J),    IA+I, IA+I, NUMBER(J))
                        CALL <a href="dpstr.html">DPSTR</a>  ( NUMBER(J), SIG,        NUMCH(J) )
                        CALL <a href="suffix.html">SUFFIX</a> ( NUMCH(J),  5,          LINE     )
                     END DO

                     CALL WRLINE ( RESULT, LINE )

                  END DO

            C
            C     Close the output text file and the DAFs.
            C
                  CALL CLLINE ( RESULT )

                  DO I = 1, NDAF
                     CALL <a href="dafcls.html">DAFCLS</a>( HAN(I) )
                  END DO

                  END
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     NAIF Document 167.0, &quot;Double Precision Array Files (DAF)
     Specification and User's Guide&quot;
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman    (JPL)
     W.L. Taber      (JPL)
     I.M. Underwood  (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 3.0.0, 16-NOV-2001 (FST)

        Updated the entry points of <b>DAFANA</b> to enable its
        internal state table size, TBSIZE, to be smaller
        than the file table maintained by <a href="dafah.html">DAFAH</a>: FTSIZE.

    SPICELIB Version 2.1.0, 11-JUL-1995 (KRG)

        Updated to remove potential compiler warnings from the
        truncation of double precision numbers to integers.

        Also changed was a numeric constant from 1.D0 to the
        equivalent, but more aesthetically pleasing 1.0D0.

    SPICELIB Version 2.0.1, 10-MAR-1992 (WLT)

        Comment section for permuted index source lines was added
        following the header.

    SPICELIB Version 2.0.0, 04-SEP-1991 (NJB) (WLT)

        Updated to support simultaneous writes to multiple DAFs.
        The $Examples section of this routine now illustrates
        usage of the routine <a href="dafcad.html">DAFCAD</a>.

    SPICELIB Version 1.0.1, 22-MAR-1990 (HAN)

        Literature references added to the header.

    SPICELIB Version 1.0.0, 31-JAN-1990 (IMU)</PRE>
<h4>Link to routine DAFANA source file <a href='../../../src/spicelib/dafana.f'>dafana.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Tue Jul 15 14:24:01 2014</pre>

</body>
</html>

