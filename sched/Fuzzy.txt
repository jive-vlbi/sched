A proposal for SCHED support of fuzzy schedule ends.
Craig Walker.  Jan. 25, 2013.


To help efficient scheduling, one idea is to get users to provide scans
at the beginning and/or end of their project that are optional.  They
could be observed, or not observed, depending on how the project meshes
with the preceeding or following project.

The idea would be that a schedule would have a core time range
assigned by the TAC.  The non-optional scans could only fall within
that time range.  That is the time range that would be used by the
dynamic scheduling software - Scenario in the current situation.  But
the user could, and even may be encouraged to, provide extra scans
before and after the core time that could be scheduled if there would
be a gap without them.  Perhaps the TAC could specifically authorize
such scans, or maybe (easier) we could have a blanket policy that 
any schedule could add, say, 2 hours of optional scans at the start 
and end.

In SCHED, the optional scans would be flagged as such.  The optional
times would be indicated in the OMS file, in several places in the 
.sum file, and in the sch files.  One thing I need to know
is if the addition of the optional times in the OMS file could be 
added to OMS, and if the proposed locations of other indications 
of the optional scans/times are adequate.

When the project is chosen and scheduled, either someone would have to
edit out the unwanted optional scans (complicated) or the schedule
could be queued to the telescopes just for the desired time.  The
latter is much simpler, I think.  Correct me if I'm wrong.

So here is my detailed proposal.  The programming for SCHED will take
on the order of a day or two as there are quite a few changes for
the .sum file, but they are simple.

Enhance the existing PREEMPT parameter for the purpose of indicating
the the optional scans.  This is a relatively new parameter that
indicates the scans that can be preempted for USNO observations and
those that should be protected.  The current arguments are 'NO' and
'OK' with obvious meanings.  I propose to add "EXTRA" as a valid
argument.  The user would put PREEMPT="EXTRA" at the start of the
optional scans, PREEMPT='NO' or PREEMPT='OK' at the start of the core
scans, and PREEMPT='EXTRA' at the start of the optional scans at the
end.  PREEMPT='EXTRA' would be assumed to imply PREEMPT='OK' as far as
the USNO project interruptions are concerned - after all, they are
optional scans.

In the OMS file, the first block is, for example (sorry Walter, this
is what you get for reporting a feature as a bug today - your files
are handy.) shown below.  The lines that would be added are
BEGIN_EXTRAS and END_EXTRAS (exact keywords negotiable).

BEGIN = PROJECT_INFO

    PROJECT_CODE       = tp028b  
    TITLE              = Personality Stress Test: pfb
    PI_NAME            = Walter Brisken
    PI_ADDRESS         = DSOC
    PI_PHONE           = 575-835-7133
    PI_OBS_PHONE       = 
    PI_EMAIL           = wbrisken@nrao.edu
    PI_FAX             = 
    BEGIN_EXTRAS       = 2013-028/18:10:00
    START              = 2013-028/20:10:00
    STOP               = 2013-028/20:14:48
    END_EXTRAS         = 2013-028/22:14:48
    CORRELATOR         = VLBADIFX

END = PROJECT_INFO


Later in the OMS file, there are station dependent segments which would
get similar additions, but determined for the station in case the
station is not used right at the extreme times.

BEGIN = STATION_INFO

    STATION_ID         = HN 
    STATION_NAME       = VLBA_HN 
    TAPES              =   0
    PASSES             =    0
    DISK               =    67.1
    BEGIN_EXTRAS       = 2013-028/18:10:00
    START              = 2013-028/20:10:00
    STOP               = 2013-028/20:14:48
    END_EXTRAS         = 2013-028/22:14:48

END = STATION_INFO


In the .sum file, there is now a segment based on PREEMPT
It is called "ALLOWED PREEMPTION TIMES"
I propose to change it as follows.
(Note to myself - change to appearing if the VLBA is there, not
just specifically if PT and MK are there).


----------- New text in .sum file: ----------
Also make this change to the .preempt file.

ALLOWED PREEMPTION TIMES:
 
 The schedule can have optional scans at the start and end designated
 by PREEMPT='EXTRA'.  These can be used or not used to help with
 efficient meshing with previous and following projects.  Only the core
 time range will be used for the initial dynamic project selection.

 The schedule can also designate which scans can be preempted at PT and
 MK for daily USNO EOP observations using PREEMPT='OK' or 'NO'.  For
 details, see the manual discussion of PREEMPT.

 Time ranges available for USNO daily EOP observations at PT and MK:
  1    (028) 20:08:00  to  (028) 22:00:00

 Project times summary:
 Extra scans at start:    (028) 20:08:00  to  (028) 20:10:00
 Core start and stop:     (028) 20:10:00  to  (028) 20:14:48
 Extra scans at end:      (028) 20:14:48  to  (028) 22:00:00
--------------------------------------------


Modify the  DERIVED INFORMATION FOR CORRELATION to:
(note the actual numbers shown in this example are random).


DERIVED INFORMATION FOR CORRELATION: 
                                                Core    With Extras
  Elapsed time for project (hours):              0.08      2.08
  Total hours in scheduled scans:                0.07      2.07
  Total hours in recording scans:                0.07      2.07
  Total baseline hours (recording scans):        3.67     25.68
  Projected max correlator data output rate:    901.1     901.1    kbytes/sec
  Projected correlator output data set size:    216.3     435.9    Mbytes
 NOTES:  Above numbers assume the same correlator parameters are used for all data.
          The correlator output data rate is for real-time processing.


More summary information to be enhanced:

EXPERIMENT SUMMARY:            Core   With Extras
  Number of input scans:          4       8
  Number of scans scheduled:      4       8  
  Number of stations:            10      10
  Number of sources input:        1       1
  Number of setup files used:     4       4


Old:
 Station summaries (disk stations): 
  Station  Control   Scans   Scan   Record  Record   Gbytes     Formatter       Sync 
                            Hours   Hours   Scans              Reconfigures    Hours  
  VLBA_BR    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_FD    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_HN    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_KP    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_LA    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_MK    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_NL    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_OV    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_PT    VLBA       4    0.07    0.07       4       67.            0        0.00
  VLBA_SC    VLBA       4    0.07    0.07       4       67.            0        0.00


New (Formatter reconfigures and sync times are not issues with the new systems).

 Station summaries (disk stations): 
                  |------------Core Scans-----------| |----------With Extras------------| 
  Station  Control Scans  Scan   Record Record Gbytes  Scans  Scan   Record Record Gbytes  
                          Hours   Hours  Scans                Hours   Hours  Scans          
  VLBA_BR    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_FD    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_HN    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_KP    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_LA    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_MK    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_NL    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_OV    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_PT    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67. 
  VLBA_SC    VLBA     4    0.07    0.07      4     67.    8    1.07    1.07     8     67.  



In the scan summaries, add 1 descriptive line at the top and a mark on
each scan.  Here I pretend scans 1 and 4 are the extras.  Scan 2 is 
preemptable for the USNO, scan 3 is not.

SUMMARY for experiment tp028b  Personality Stress Test: pfb                                            
     Symbol after SCAN number:  "+" => Extra scan.  "-" => preemptable for USNO.
     Flags: D=>Down, H=>Below Horizon, R=>Rises, S=>Sets, W=>Slew too long, t=>Tape Chg.
     Top item is:    Average elevation.
     Bottom item is: Seconds antenna is on source during scan. 0 shown if down, rise, or set
     TYPE top: -=> normal scan, P=>Pointing or Ta;  bottom: -=>recording, N=>not recording.
     Day  28 is Mon  28 Jan 2013   MJD  56320          

SCAN  DAY START UT  SOURCE     TYPE  STATIONS    t => tape change
           STOP UT                    Br    Fd    Hn    Kp    La    Mk    Nl    Ov    Pt    Sc

   1+  28 20:10:00 1357+769      -    44    24    31    27    29    25    33    33    28     5
       28 20:11:00 pfb1          -    60    60    60    60    60    60    60    60    60    60

   2-  28 20:11:16 1357+769      -    44    24    31    27    29    25    32    33    28     5
       28 20:12:16 pfb2          -    60    60    60    60    60    60    60    60    60    60

   3   28 20:12:32 1357+769      -    44    24    31    27    29    25    32    33    28     5
       28 20:13:32 pfb1          -    60    60    60    60    60    60    60    60    60    60

   4+  28 20:13:48 1357+769      -    44    24    31    26    29    25    32    33    28     5




Next summary:

 TIME RANGE OF RECORDINGS and TOTAL BYTES:

              Start extras   Core start time.   Core end time.    End extras       Core     Total  
 Station      Day    Time      Day    Time       Day    Time      Day    Time     GBytes    GBytes 
                 (UT)             (UT)               (UT)             (UT)    		            
  VLBA_BR     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_FD     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_HN     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_KP     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_LA     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_MK     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_NL     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_OV     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_PT     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 
  VLBA_SC     28  20:10:00     28  20:10:00      28  20:14:48     28  20:14:48      67.1      67.1 


Then for each source.

   Source                         Source position (RA/Dec)                        Error
                        (B1950)             (J2000)             (Date)            (mas)

   J1357+7643        13 57 42.117007   * 13 57 55.371538     13 57 58.612492       0.44
 * 1357+769          76 57 53.35418    * 76 43 21.05098      76 39 09.77718        0.10
   J1357+76          /Users/cwalker/code/sched_work/catalogs/sources.vlba
                     rfc_2012b Petrov, 2012, unpublished 217691 observations
                         Core hours     With extras    Frequency       Setup file.
                       Scan  Baseline  Scan  Baseline Sets (no dups) 
                       0.033   2.13    1.500   6.800   1                pfb1
                       0.033   1.00    1.000   5.800  11 23 35          pfb2


In the sch.pt etc files, add a column with the actual PREEMPT argument:

^LSchedule for VLBA_PT   (Code Pt )                                   Page   2
               Personality Stress Test: pfb
  UP:  D => Below limits;  H => Below horizon mask;  W => still slewing at end;  blank => Up.
  Early: Seconds between end of slew and start.   Dwell: On source seconds. 
  Disk: GBytes recorded to this point.
  TPStart:  Recording start time.  Frequencies are LO sum (band edge).
  SYNC: Time correlator is expected to sync up.
----------------------------------------------------------------------------------------
Start UT  Source               Start / Stop                 Early    Disk   TPStart Preempt
Stop UT                  LST      EL    AZ   HA  UP   ParA  Dwell   GBytes    SYNC
----------------------------------------------------------------------------------------

 --- Mon  28 Jan 2013   Day  28 ---

 Next scan frequencies:  8024.00  8024.00  8056.00  8056.00  8088.00  8088.00  8120.00  8120.00
                         8152.00  8152.00  8184.00  8184.00  8216.00  8216.00  8248.00  8248.00
 Next BBC frequencies:    624.00   624.00   656.00   656.00   688.00   688.00   720.00   720.00
                          752.00   752.00   784.00   784.00   816.00   816.00   848.00   848.00
 Next scan bandwidths:     32.00    32.00    32.00    32.00    32.00    32.00    32.00    32.00
                           32.00    32.00    32.00    32.00    32.00    32.00    32.00    32.00

20 10 00  1357+769     21 30 31  28.3 -13.9  7.5      59.6     0        0   20 09 55  Extra
20 11 00  ---          21 31 31  28.2 -13.9  7.6      59.4    60       17   20 09 55

 Next scan frequencies:  8120.00  8120.00  8152.00  8152.00  8184.00  8184.00  8216.00  8216.00
                         8248.00  8248.00  8280.00  8280.00  8312.00  8312.00  8344.00  8344.00
 Next BBC frequencies:    720.00   720.00   752.00   752.00   784.00   784.00   816.00   816.00
                          848.00   848.00   880.00   880.00   912.00   912.00   944.00   944.00

20 11 16  1357+769     21 31 47  28.2 -13.9  7.6      59.3     1       17   20 11 11  OK
20 12 16  ---          21 32 47  28.1 -13.9  7.6      59.1    60       34   20 11 11

 Next scan frequencies:  8024.00  8024.00  8056.00  8056.00  8088.00  8088.00  8120.00  8120.00
                         8152.00  8152.00  8184.00  8184.00  8216.00  8216.00  8248.00  8248.00
 Next BBC frequencies:    624.00   624.00   656.00   656.00   688.00   688.00   720.00   720.00
                          752.00   752.00   784.00   784.00   816.00   816.00   848.00   848.00

20 12 32  1357+769     21 33 03  28.1 -13.9  7.6      59.0    10       34   20 12 27  NO
20 13 32  ---          21 34 03  28.1 -13.8  7.6      58.8    60       50   20 12 27


I think that is what is needed.  Scenario needs to get the core time, and we need to be sure
that we have an easy path for selecting a subset of the schedule.  If the queuing can't do
it, I could have some sort of global start and stop that would be applied after the schedule
is made.  That might be fairly simple.

There are issues with such a scenario when reference pointing or array phasing is being used
as the pointing or phasing scans might be missed.  But I think a large majority of projects
that do those sorts of things used fixed scheduling (HSA, Global array, GMVA etc) so I don't
think we'd get into much trouble.

Reactions?
